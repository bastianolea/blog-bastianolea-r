---
title: Mapas y visualización de datos geoespaciales en R con {sf}
author: Bastián Olea Herrera
date: '2025-10-22'
draft: false
freeze: false
slug: []
categories:
  - tutoriales
tags:
  - mapas
  - visualización de datos
format:
  hugo-md:
    output-file: index
    output-ext: md
links:
  - icon: registered
    icon_pack: fas
    name: SF
    url: https://r-spatial.github.io/sf/
execute:
  eval: false
  cache: false
excerpt: "R cuenta con un muy amplio ecosistema de paquetes para datos geoespaciales. Uno de los paquetes más importantes es `{sf}`, que permite manipular datos espaciales a partir del estándar _simple features_ (características simples), ampliamente utilizado en sistemas de información geográfica (SIG/GIS). En esta guía iré guardando los comandos que uso frecuentemente para manipular y visualizar datos geoespaciales en R. En la medida que voy aprendiendo más sobre hacer mapitas, iré actualizando y complementando."
---

{{< imagen "mapa_rm_featured.png" >}}

{{< aviso "⚠️ Este tutorial se encuentra en construcción! ⚠️" >}}

R cuenta con un muy amplio [ecosistema](https://github.com/r-spatial/) de paquetes para datos geoespaciales. Uno de los [paquetes más importantes es `{sf}`](https://r-spatial.github.io/sf/), que permite manipular datos espaciales a partir del estándar _simple features_ (características simples), ampliamente utilizado en sistemas de información geográfica (SIG/GIS).

En esta guía iré guardando los comandos que uso frecuentemente para **manipular, transformar y visualizar datos geoespaciales** en R. En la medida que voy aprendiendo más sobre hacer mapitas, iré actualizando y complementando.

Lo inicial es instalar `{sf}`:


``` r
install.packages("sf")
```

Y cargarlo junto a `{dplyr}` para empezar a trabajar con datos geoespaciales.

``` r
library(sf)
library(dplyr)
```





**Nota:** para simplificar, en este tutorial voy a ocultar el código de los gráficos, pero siempre estará disponible bajo flechitas que despliegan el código, como la siguiente:

{{< detalles "**Ver código para los gráficos**" >}}


``` r
library(ggplot2)

# tema de colores
thematic::thematic_on(fg = "#553A74",
                      bg = "#EAD2FA",
                      accent = "#9069C0")

theme_set(
  # fondo transparente para mapas
  theme(plot.background = element_rect(fill = "transparent", color = "transparent")) +
    # borrar líneas feas
    theme(axis.ticks = element_blank())
)
```
{{< /detalles >}}

<br>

{{< indice >}}

----


## Carga de mapas

Una de las fuentes principales de datos geoespaciales son los _shapefiles_. Pero también existen **paquetes de R que contienen información geoespacial**, para mayor conveniencia. Exploraremos ambas opciones a continuación.


### Cargar mapas de cualquier país

Si no tenemos o no queremos descargar _shapes_, podemos **cargar mapas de cualquier país directo en R** gracias a [`{rnaturalearth}`](http://ropensci.github.io/rnaturalearth/). Con este paquete obtenemos directamente mapas de cualquier país del mundo, incluyendo sus estados o regiones internos, sin necesidad de descargas.

Instala `{rnaturalearth}` si no lo tienes:


``` r
install.packages("rnaturalearth")
```

Puedes insertar el nombre de tu país para seguir con este tutorial usando ejemplos de tu territorio.


``` r
# install.packages("rnaturalearth")
library(rnaturalearth)

pais <- ne_states("Argentina")
# pais <- ne_states("Mexico")
# pais <- ne_states("Colombia")

mapa <- pais |> 
  # seleccionar columnas
  select(pais = admin,
         region = name_es,
         geometry)

mapa
```

```
## Simple feature collection with 24 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -73.57274 ymin: -55.05202 xmax: -53.66155 ymax: -21.78694
## Geodetic CRS:  WGS 84
## First 10 features:
##           pais     region                       geometry
## 1    Argentina Entre Ríos MULTIPOLYGON (((-58.20011 -...
## 12   Argentina      Salta MULTIPOLYGON (((-68.49647 -...
## 13   Argentina      Jujuy MULTIPOLYGON (((-67.25133 -...
## 741  Argentina    Formosa MULTIPOLYGON (((-62.34136 -...
## 746  Argentina   Misiones MULTIPOLYGON (((-54.66497 -...
## 749  Argentina      Chaco MULTIPOLYGON (((-58.35127 -...
## 750  Argentina Corrientes MULTIPOLYGON (((-58.6042 -2...
## 1318 Argentina  Catamarca MULTIPOLYGON (((-68.33776 -...
## 1320 Argentina   La Rioja MULTIPOLYGON (((-69.65405 -...
## 1321 Argentina   San Juan MULTIPOLYGON (((-69.95766 -...
```


### Cargar _shapes_

Un _shapefile_ es un formato de archivo común para datos geoespaciales, que en realidad consiste en una **carpeta** con archivos relacionados (`.shp`, `.shx`, `.dbf`, entre otros) que juntos representan la geometría y atributos de los objetos geográficos.

Teniendo la carpeta, basta con cargarla con la función `read_sf()`.

{{< detalles "**Ejemplo de descarga y carga de un _shapefile_ de Chile**" >}}

Para aprender, podemos descargar un _shape_ y usarlo para practicar. Si no tienes uno a mano, en el siguiente botón podemos bajar un _shapefile_ de Chile por regiones, que proviene de la [Mapoteca de la Biblioteca del Congreso Nacional](https://www.bcn.cl/siit/mapas_vectoriales).

{{< boton "Division regional: polígonos de las regiones de Chile" "https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip" "fas fa-map">}}

También puedes descargarlo directamente desde R con `download.file()` y luego `unzip()`, [como se indica en este post](/blog/mapa_chile_triple/#descargar-mapas).


Una vez descargado, descomprimimos el archivo y obtenemos una **carpeta**. Esta carpeta es nuestro _shapefile_, así que la guardamos dentro de nuestro [proyecto de RStudio](/blog/r_introduccion/proyectos/), idealmente dentro de una carpeta donde guardemos nuestros mapas. 


``` r
# descargar
download.file("https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip",
              "Regiones.zip")

# descomprimir
unzip("Regiones.zip", exdir = "shapes/Regiones")
```

En el siguiente ejemplo, guardamos el _shapefile_ en una carpeta `shapes`, y lo cargamos con `read_sf()`.






``` r
mapa <- read_sf("shapes/Regiones") |> 
  janitor::clean_names()

mapa
```


```
## Simple feature collection with 17 features and 7 fields
## Geometry type: GEOMETRY
## Dimension:     XY
## Bounding box:  xmin: -12183900 ymin: -7554306 xmax: -7393644 ymax: -1978920
## Projected CRS: WGS 84 / Pseudo-Mercator
## # A tibble: 17 × 8
##    objectid cir_sena codregion area_km    st_area_sh st_length region           
##  *    <dbl>    <int>     <int>   <dbl>         <dbl>     <dbl> <chr>            
##  1     1084        1        15  16867.  18868687744.   750530. Región de Arica …
##  2     1085        2         1  42285.  48306372203.  1213713. Región de Tarapa…
##  3     1086        3         2 126071. 150845155633   2516112. Región de Antofa…
##  4     1087       15        12 133053. 358131609833  90498304. Región de Magall…
##  5     1088       14        11 106703. 224274263072  41444811. Región de Aysén …
##  6     1089        4         3  75661.  96439063562.  2401741. Región de Atacama
##  7     1090        5         4  40576.  54980818749.  2065933. Región de Coquim…
##  8     1091        6         5  16323.  23014748571.  1679609. Región de Valpar…
##  9     1092        7        13  15392.  22252038246.  1064253. Región Metropoli…
## 10     1093       13        10  48408.  87718341940.  7874158. Región de Los La…
## 11     1094       12        14  18245.  31086613540.  1844423. Región de Los Rí…
## 12     1095       11         9  31838.  52215073344.  1501025. Región de La Ara…
## 13     1096       10         8  24022.  38176117509.  2097147. Región del Bío-B…
## 14     1097       10        16  13104.  20376298459.  1074094. Región de Ñuble  
## 15     1098        9         7  30322.  45969426092.  1388328. Región del Maule 
## 16     1099        8         6  16349.  24090278437.   984853. Región del Liber…
## 17     1100        0         0   3937.   9306245194.   388722. Zona sin demarcar
## # ℹ 1 more variable: geometry <GEOMETRY [m]>
```

{{< /detalles >}}

{{< aviso "Puedes seguir este tutorial independientemente del mapa que hayas cargado (el _shape_ de Chile, con `rnaturalearth`, u otro _shape_ que tú elijas); lo importante es que cargues un objeto `mapa` que tenga columna `geometry` y `region`." >}}

<!--
### Cargar geoJSON


### Cargar KMZ






















































































































