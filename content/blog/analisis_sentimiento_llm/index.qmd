---
title: An√°lisis de sentimiento usando modelos de lenguaje (LLM) locales en R
author: Basti√°n Olea Herrera
date: '2024-11-18'
slug: []
categories: []
format: "hugo-md"
draft: true
tags:
  - an√°lisis de texto
  - inteligencia artificial
editor_options: 
  chunk_output_type: console
---

El an√°lisis de sentimientos es una t√©cnica de an√°lisis de texto que aplica distintos algoritmos para poder clasificar textos de distinta longitud y complejidad en un conjunto preestablecido de categor√≠as relacionadas al sentimiento de dichos textos. Con el sentimiento de los textos nos referimos a la informaci√≥n subjetiva que entregan estos textos, as√≠ como los afectos que producen. Las categor√≠as del an√°lisis del sentimiento suelen ser positivo, neutro y negativo, u otras m√°s complejas, como agrado (agradable/desagradable), activaci√≥n (activo/pasivo), y otros.

En otras palabras, la aplicaci√≥n de un an√°lisis de sentimiento un conjunto de textos nos permitir√≠a clasificar estos textos en categor√≠as como positivo, neutro y negativo, y a partir de eso poder realizar otros an√°lisis.

Algunos ejemplos son: 
- Correlacionar si los textos de distintos autores difieren en sus sentimientos,
- Analizar si textos sobre determinadas tem√°ticas se correlacionan con sentimientos espec√≠ficos,
- Estudiar si ciertos temas son tratados de una forma espec√≠fica por ciertos autores, y de una forma distinta por otros
- Comparar si textos sobre un mismo tema son expuestos de forma distinta por distintos autores o fuentes

Pensemos en el ejemplo de un conjunto de art√≠culos de prensa o noticias, cada uno con fecha y el medio de comunicaci√≥n del que proviene. Si hacemos una selecci√≥n de noticias sobre un tema espec√≠fico, podr√≠amos analizar c√≥mo cambia el sentimiento dominante con el que se plantea la tem√°tica en distintos momentos del tiempo, o si dos medios de comunicaci√≥n representan una misma tem√°tica bajo distinto sentimiento.

```{r}
library(dplyr)
library(readr)
```

```{r}
url_datos <- "https://raw.githubusercontent.com/bastianolea/prensa_chile/refs/heads/main/datos/prensa_datos_muestra.csv"

noticias <- read_csv2(url_datos)

noticias_muestra <- noticias |> 
  slice_sample(n = 20)

noticias_muestra
```


```{r}
noticias_muestra
```

```{r}
library(mall)
library(stringr)
library(beepr)
```

```{r}
llm_use("ollama", "llama3.1:8b")

noticias_sentimiento <- noticias_muestra |> 
  llm_sentiment(paste(titulo, cuerpo), 
                pred_name = "sentimiento",
                options = c("positivo", "neutro", "negativo"))
beep()
# 86 segundos

noticias_sentimiento
```






```{r}

noticias_muestra_resumen <- noticias_muestra |> 
  llm_summarize(paste(titulo, cuerpo) |> str_trunc(2000, side = "center"), 
                max_words = 30, pred_name = "resumen", 
                additional_prompt = "Redacta el resumen de la idea principal de la noticia en espa√±ol, y en un solo p√°rrafo.")

tictoc::tic()
noticias_resumen_sentimiento <- noticias_muestra_resumen |> 
  llm_sentiment(resumen, 
                pred_name = "sentimiento",
                options = c("positivo", "neutro", "negativo"))
tictoc::toc()
beep()
```

2 minutos en resumir
13 segundos en sentimiento


diferencias
```{r}
noticias_sentimiento |> 
  bind_cols(sentimiento_resumen = noticias_resumen_sentimiento$sentimiento) |> 
  mutate(diferencia = sentimiento != sentimiento_resumen) |> 
  select(titulo, sentimiento, sentimiento_resumen, diferencia) |> 
  filter(diferencia)
```




----


Si este tutorial te sirvi√≥, por favor considera hacerme una peque√±a donaci√≥n para poder tomarme un cafecito mientras escribo el siguiente tutorial ü•∫

```{=html}
<div style = "height: 18px;">
</div>
<div>
  <div style="display: flex;
  justify-content: center;
  align-items: center;">
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="bastimapache" data-color="#FFDD00" data-emoji="‚òï"  data-font="Cookie" data-text="Reg√°lame un cafecito" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
  </div>
```