---
title: Crear y conectarse a una base de datos Postgres en R
author: Basti치n Olea Herrera
date: '2025-11-06'
draft: false
freeze: true
slug: []
categories:
  - Tutoriales
tags:
  - datos
  - optimizaci칩n
  - dplyr
format:
  hugo-md:
    output-file: index
    output-ext: md
excerpt: "Coloquialmente se usa el t칠rmino _base de datos_ para referirse a datos que est치n en Excel. Pero en realidad una base de datos es algo distinto: un sistema de almacenamiento y procesamiento de datos que puede contener m칰ltiples tablas, alojado en un computador, servidor o en la nube, que puede entregar datos de forma r치pida y eficiente de acuerdo a las solicitudes que se le hagan. En este post veremos c칩mo crear una base de datos gratuita, c칩mo conectarnos a ella desde R, a leer y escribir tablas, y procesar datos desde la base de datos remota."
---


{{< indice >}}

## Qu칠 es una base de datos

Cuando se habla de datos, mucha gente (me incluyo) usa coloquialmente el t칠rmino _base de datos_ para referirse a datos que est치n en Excel o `csv` 游땪 Pero la realidad es que una base de datos es algo distinto: un **sistema de almacenamiento y procesamiento de datos** que puede contener m칰ltiples tablas, que est치 _hosteado_ en un computador, servidor o en la nube, y que entrega datos de acuerdo a las solicitudes que se le hagan. En este sentido **una base de datos es distinto a _leer_ un archivo**, porque la base de datos siempre tiene _cargados_ los datos, y est치 esperando que se los pidan para entregarlos de manera optimizada. 

Una de las diferencias principales al usar bases de datos es que **no necesitas _cargar_ los datos** en tu computador, porque se encuentran en la base de datos remota. En vez de cargarlos, los puedes **solicitar** para que la base los procese y te los entregue. Solamente cuando los necesitas en memoria, los cargas localmente.

Pero adem치s, una base de datos puede hacer m치s que simplemente almacenar los datos. Las solicitudes que hacemos a la base, usualmente hechas por medio del lenguaje SQL, son **procesadas de forma r치pida y eficiente**, entreg치ndote solamente lo necesario. De este modo puedes acceder a conjuntos de **muchos millones de observaciones** sin que tu computador explote 游눤


## Cu치ndo usar una base de datos

- Cuando la **cantidad de observaciones es muy grande**, y te encuentras con l칤mites de memoria
- Cuando necesitas **acceder a los datos desde varios equipos o aplicaciones**
- Cuando tus datos **ocupan mucho almacenamiento local** y preferir칤as que estuvieran en la nube
- Cuando tienes muchos datos, y solo los cargas para obtener subconjuntos o res칰menes de los mismos
- Cuando quieres **optimizar la velocidad** de acceso a los datos, sobre todo la velocidad de cargar archivos
- Cuando tienes un conjunto de datos complejos que requieren de **m칰ltiples tablas relacionadas entre s칤**
- Cuando no puedes mantener todos los datos en memoria

A continuaci칩n veremos c칩mo **crear** una base de datos gratuita, c칩mo **conectarnos** a ella desde R, y c칩mo subir y trabajar con los datos en la base de datos remota.

----

## Crear una base de datos en Supabase

Como una base de datos requiere estar instalada en un computador o servidor, necesitamos un proveedor que nos permita alojar la base de datos[^1]. Una opci칩n es [Supabase](https://supabase.com), una plataforma para bases de datos que se basa en c칩digo abierto, y que ofrece **bases de datos Postgres gratuitas** para proyectos peque침os.

[^1]: Tambi칠n se puede correr la base de datos en tu mismo computador, pero eso lo dejamos para otro post 游뱁

Para empezar, [crea una cuenta en Supabase](https://supabase.com/dashboard/sign-up).

Una vez en tu cuenta, en la secci칩n _**Projects**_, crea un nuevo proyecto:

{{< imagen "supabase_1.png" >}}

Un proyecto es una instancia en el servidor de Supabase con su propia **base de datos Postgres**[^2], donde podr치s escribir tus tablas de datos. Ponle un nombre y define una contrase침a segura. Con esta contrase침a podr치s acceder a tus datos.

[^2]: Postgres es un sistema de gesti칩n de bases de datos relacionales , uno de los m치s usados, pero existen muchos otros m치s, como SQLite, MariaDB, y m치s.

{{< imagen "supabase_2.png" >}}

Luego de crear el proyecto se abrir치 el panel principal, donde te indica que (por ahora) tienes cero tablas 游녩游낕


## Conectarse a la base de datos 

Con el proyecto creado, ahora podemos conectarnos a la base de datos. Pero necesitamos crear una conexi칩n con la misma, y para ello requerimos ciertas credenciales y datos para que tu computador conecte con el servidor donde est치 tu base de datos.

Presiona _**Connect**_ en la parte superior. para ver los par치metros de conexi칩n.

{{< imagen "supabase_3.png" >}}

Se abrir치 un panel donde se nos entregar치n los **par치metros de acceso** a la base de datos. Presiona _View parameters_ para desplegar la informaci칩n:

{{< imagen "supabase_5.png" >}}

Necesitamos los par치metros `host`, `port`, `database` y `user`. Ahora iremos a R para introducirlos y conectarnos.

### Credenciales de acceso

Para interactuar con bases de datos, necesitamos el paquete `{DBI}`, que gestiona las conexiones con bases de datos, y en nuestro caso el paquete `{RPostgres}`, que es el motor para trabajar con bases de datos Postgres.


``` r
install.packages("DBI")
install.packages("RPostgres")
```

Para conectarnos a una base de datos desde R usamos la funci칩n `dbConnect()`. Dentro de esta funci칩n explicitamos el _driver_ de la base de datos (en este caso `Postgres()`), y los par치metros de conexi칩n que obtuvimos en Supabase: `dbname`, `host`, `port`, `user` y `password`.


``` r
db_con <- DBI::dbConnect(
  RPostgres::Postgres(),
  dbname = "postgres",
  host = "host",
  port = 5432,
  user = "postgres",
  password = "contrase침a"
  )
```

丘멆잺 춰Pero espera! **No es seguro escribir credenciales privadas en un script.** As칤 que vamos a seguir las _buenas pr치cticas_ y vamos a **guardar las credenciales de forma segura**.

Una opci칩n es no escribir la contrase침a y en su lugar usar `rstudioapi::askForPassword()` para ingresar la contrase침a manualmente pero de forma segura. Sin embargo, no queremos estar escribiendo la contrase침a cada vez que necesitemos los datos!

### Variables de entorno
Vamos a crear un script donde podamos guardar **variables de entorno**, que son variables que R puede leer pero que **no quedan en el c칩digo**, y que adem치s **siempre se cargan cuando abrimos el proyecto**. Es decir, quedan disponibles para poder usarlas, pero estar치n ocultas. As칤 podemos compartir y respaldar nuestro c칩digo sin exponer informaci칩n sensible, y podemos conectarnos a la base de datos sin tener que volver a introducir las credenciales.

**Creamos un script de entorno** llamado `.Renviron` en la ra칤z de nuestro proyecto ejecutando una funci칩n que lo hace por nosotres:


``` r
usethis::edit_r_environ(scope = "project")
```

En el script que se abre **guardamos las credenciales** de la siguiente manera:

```
db_host=db.blablablabla.supabase.co
db_port=5432
db_user=postgres
db_pass=clavebasededatosprueba
```

Una vez guardadas las credenciales, **reiniciamos la sesi칩n de R** para que se lean las variables de entorno (siempre se leer치n al iniciar R), o podemos ejecutar `readRenviron(".Renviron")` para cargarlas.


{{< aviso "**丘멆잺 Importante:** Si usas [git](/tags/git/), no olvides agregar el archivo `.Renviron` a tu `.gitignore` para evitar subir a internet credenciales privadas!" >}}

### Conexi칩n a la base de datos

Procedemos a hacer la conexi칩n a la base de datos de forma segura, usando `Sys.getenv()` para obtener las variables de entorno que guardamos en `.Renviron`:




``` r
library(DBI)
library(RPostgres)

db_con <- DBI::dbConnect(
  RPostgres::Postgres(),
  dbname = "postgres",
  host = Sys.getenv("db_host"),
  port = Sys.getenv("db_port"),
  user = Sys.getenv("db_user"),
  password = Sys.getenv("db_pass")
)
```

Al conectarnos creamos un objeto que representa nuestra conexi칩n a la base de datos.


``` r
db_con
```

```
## <PqConnection> postgres@db.ybqnpazmjvictxbevqqk.supabase.co:5432
```

Usaremos este objeto para interactuar con la base de datos.

## Crear una tabla en la base de datos

Con la funci칩n `dbWriteTable()` creamos en la base de datos una tabla nueva a partir de un dataframe; por ejemplo, usando el conjunto de datos `iris` que viene por defecto en R.



























