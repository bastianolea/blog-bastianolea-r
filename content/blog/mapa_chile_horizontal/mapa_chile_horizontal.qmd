---
title: Rotar un mapa de Chile en R para que quede horizontal
author: Basti谩n Olea Herrera
format:
  hugo-md:
    output-file: "index"
    output-ext: "md"
date: '2025-03-04'
slug: []
categories: []
tags:
  - mapas
  - visualizaci贸n de datos
  - Chile
editor_options: 
  chunk_output_type: console
excerpt: Visualizar un mapa de Chile puede ser complicado debido a su largo. Muchas veces cuesta ubicar correctamente el mapa por el espacio vertical que requiere. Pero en ciertos casos puede ser conveniente visualizar a Chile _de lado_, para aprovechar el espacio horizontal. En esta gu铆a veremos c贸mo rotar un mapa de Chile 90掳 hacia la izquierda en R para que quede acostado.
links:
  - icon: file-code
    icon_pack: fas
    name: C贸digo
    url: https://gist.github.com/bastianolea/8e3dff701fb660ee7cb5091bd1195b5f
---

Visualizar un mapa de Chile puede ser complicado debido a su largo. Muchas veces cuesta ubicar correctamente el mapa por el espacio vertical que requiere. Pero en ciertos casos puede ser conveniente **visualizar a Chile _de lado_**, para aprovechar el espacio horizontal. 

En esta gu铆a veremos c贸mo rotar un mapa de Chile 90掳 hacia la izquierda en R para que quede acostado ゐ

{{< aviso "Si necesitas aprender en profundidad la visualizaci贸n de mapas con R, revisa mi [tutorial de mapas y datos espaciales con `{sf}`](/blog/mapas_sf/)." >}}

Primero cargamos los paquetes necesarios:

```{r}
#| message: false
library(sf) # manejo de datos espaciales
library(chilemapas) # mapas de Chile
library(ggplot2) # visualizaci贸n de datos
library(dplyr) # manejo de datos tabulares
library(readr) # cargar datos
```

Obtenemos un mapa de Chile [gracias al paquete `{chilemapas}`](https://github.com/pachadotdev/chilemapas); en este caso un mapa del pa铆s por regiones:
```{r}
# obtener mapa
mapa_region <- chilemapas::generar_regiones()

mapa_region

# visualizar
mapa_region |> 
  ggplot(aes()) +
  geom_sf() +
  # recortar coordenadas horizontales
  coord_sf(xlim = c(-80, -62))
```

Cargamos algunos datos regionales para ponerle al mapa, sacados de mi proyecto de [visualizaci贸n de datos econ贸micos de Chile](https://bastianoleah.shinyapps.io/economia_chile/):
```{r}
#| message: false
# obtener datos
datos <- read_csv2("https://github.com/bastianolea/economia_chile/raw/main/app/datos/pib_regional.csv")
# https://github.com/bastianolea/economia_chile

# limpiar datos
datos_2 <- datos |> 
  group_by(serie) |> 
  slice_max(a帽o) |> 
  slice_max(mes) |> 
  select(nombre_region = serie, valor, a帽o, trimestre, mes)

# crear tabla de regiones
regiones <- tribble(~codigo_region, ~nombre_region,
                    "01", "Regi贸n de Arica y Parinacota",
                    "02", "Regi贸n de Tarapac谩",
                    "03", "Regi贸n de Antofagasta",
                    "04", "Regi贸n de Atacama",
                    "05", "Regi贸n de Coquimbo",
                    "06", "Regi贸n de Valpara铆so",
                    "07", "Regi贸n Metropolitana de Santiago",
                    "08", "Regi贸n del Libertador General Bernardo OHiggins",
                    "09", "Regi贸n del Maule",
                    "10", "Regi贸n de uble",
                    "11", "Regi贸n del Biob铆o",
                    "12", "Regi贸n de La Araucan铆a",
                    "13", "Regi贸n de Los R铆os",
                    "14", "Regi贸n de Los Lagos",
                    "15", "Regi贸n de Ays茅n del General Carlos Ib谩帽ez del Campo",
                    "16", "Regi贸n de Magallanes y de la Ant谩rtica Chilena")
```

Ahora que tenemos los datos listos, los agregamos al mapa [usando un `left_join()`](/blog/left_join/):

```{r}
# agregar regiones y datos al mapa
mapa_datos <- mapa_region |> 
  left_join(regiones) |> 
  left_join(datos_2, by = join_by(nombre_region))
```

Finalmente, previsualizamos el mapa con los datos agregados:
```{r}
# visualizar mapa con datos
mapa_datos |> 
  ggplot() +
  aes(fill = valor) +
  geom_sf(linewidth = 0) +
  coord_sf(xlim = c(-80, -62)) +
  scale_fill_distiller(type = "seq", palette = 12,
                       labels = scales::label_comma(big.mark = ".")) +
  theme_classic() +
  theme(axis.text = element_blank(),
        axis.line = element_blank(),
        axis.ticks = element_blank())
```


Ahora que tenemos un mapa de Chile con datos regionales, procedemos a **rotar el mapa**. Para esto, necesitamos una _matriz de rotaci贸n_, respecto de la cual no hay mucho que entender, salvo que nos permitir谩 multiplicar la geometr铆a del mapa para obtener como resultado la misma geometr铆a, pero rotada. El 煤nico detalle que hay que considerar es que es necesario **cambiar la proyecci贸n del mapa** para que la zona sur del pa铆s no se vea deformada.

```{r}
# reprojectar a CRS EPSG:5361 para evitar deformaci贸n
mapa_proyectado <- st_transform(mapa_datos, 5361)

# matriz de rotaci贸n 90掳 izquierda
rotacion <- matrix(c(0, -1, 1, 0), 2, 2)

# aplicar rotaci贸n al mapa proyectado
mapa_rotado <- mapa_proyectado |> 
  mutate(geometry = geometry * rotacion)
```

Ahora visualizamos el **mapa reproyectado y rotado**:

```{r}
#| warning: false
mapa_rotado |> 
  ggplot() +
  aes(fill = valor) +
  geom_sf(linewidth = 0) +
  scale_y_continuous(labels = scales::label_number()) +
  coord_sf(ylim = c(800000, -100000)) +
  labs(title = "Mapa de Chile horizontal",
       subtitle = "A mimir") +
  scale_fill_distiller(type = "seq", palette = 12,
                       labels = scales::label_comma(big.mark = ".")) +
  guides(fill = guide_legend(position = "bottom")) +
  theme_classic() +
  theme(axis.text = element_blank(),
        axis.line = element_blank(),
        axis.ticks = element_blank())
```


Listo! Revisa el [c贸digo completo](https://gist.github.com/bastianolea/8e3dff701fb660ee7cb5091bd1195b5f) en el siguiente bot贸n para poder copiarlo y pegarlo en tu proyecto:

{{< boton "Ver c贸digo completo" "https://gist.github.com/bastianolea/8e3dff701fb660ee7cb5091bd1195b5f" "fas fa-file-code" >}}

### Fuentes
- [DeepSeek DeepThink (R1)](https://chat.deepseek.com)
- https://gist.github.com/ryanpeek/99c6935ae51429761f5f73cf3b027da2
- https://r-spatial.github.io/sf/articles/sf3.html#affine-transformations
- https://en.wikipedia.org/wiki/Rotation_matrix