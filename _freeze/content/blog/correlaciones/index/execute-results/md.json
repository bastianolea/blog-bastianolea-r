{
  "hash": "6e8d49d26ee1f76cc7fa14e402276a5a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: An√°lisis y visualizaci√≥n de correlaciones en R\nauthor: Basti√°n Olea Herrera\ndate: '2025-07-09'\ndraft: false\nfreeze: true\nformat:\n  hugo-md:\n    fig-format: \"jpeg\"\n    output-file: \"index\"\n    output-ext: \"md\"\nslug: []\ncategories: \n  - Tutoriales\ntags:\n  - estad√≠stica\n  - ggplot2\n  - gr√°ficos\n  - visualizaci√≥n de datos\neditor_options: \n  chunk_output_type: console\nexcerpt: El an√°lisis de correlaci√≥n es una t√©cnica estad√≠stica de an√°lisis exploratorio que nos permite identificar si existen relaciones lineales entre distintas variables. En este tutorial aprenderemos a realizar correlaciones entre m√∫ltiples variables, interpretarlas, y visualizarlas de varias maneras distintas. \n---\n\n\n\n\nEl an√°lisis de correlaci√≥n es una t√©cnica estad√≠stica que nos permite **identificar si existen relaciones lineales entre distintas variables.** \n\nLo que hace una correlaci√≥n es indicarnos si dos variables tienen una relaci√≥n entre s√≠, en el sentido de que el aumento o disminuci√≥n de una de las variables ocurra en concordancia con la otra variable, ya sea una **correlaci√≥n positiva** (si una variable aumenta, la otra tambi√©n) o **correlaci√≥n negativa** (si una variable aumenta, la otra disminuye).\n\nUn ejemplo de correlaci√≥n positiva ser√≠a: mientras m√°s solcito, m√°s calor. Una correlaci√≥n negativa ser√≠a: a mayor fr√≠o, menos ganas de levantarse üò¥\n\nEn R podemos realizar an√°lisis de correlaci√≥n en conjuntos de datos enteros, y de este modo podemos encontrar todas las correlaciones que existen entre las variables de los datos. Esto se lograr√≠a tomando todas las variables y cruz√°ndolas todas con todas, para luego identificar cu√°les se correlacionan, en qu√© direcci√≥n y con qu√© intensidad.\n\n## Cargar datos\n\nPara hacer m√°s interesante el tutorial, vamos a cargar dos conjuntos de datos sociales, obtenidos de mi [repositorio de datos sociales p√∫blicos](https://bastianolea.github.io/datos_sociales/). \n\nEn esta oportunidad cargaremos un conjunto de datos del [Sistema de Informaci√≥n Municipal (Sinim)](https://github.com/bastianolea/sinim_info_municipal), que es una base de datos sobre los municipios chilenos mantenida anualmente por la [Subsecretar√≠a de Desarrollo Regional y Administrativo (Subdere)](https://datos.sinim.gov.cl), y el conjunto de datos del [Sistema de Indicadores y Est√°ndares de Desarrollo Urbano](https://github.com/bastianolea/siedu_indicadores_urbanos/), conjunto desarrollado por el [Instituto Nacional de Estad√≠sticas de Chile](https://www.ine.gob.cl/herramientas/portal-de-mapas/siedu) que agrupa estad√≠sticas Sobre medio ambiente, planificaci√≥n de ciudades, desarrollo sostenible, acceso a servicios b√°sicos, y movilidad.\n\nGracias al [repositorio de datos sociales](https://bastianolea.github.io/datos_sociales/), tenemos enlaces directos a conjuntos de datos sociales listos para usar, y cargarlos a tu sesi√≥n de R es tan f√°cil como cargar el dato directamente desde internet:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(arrow)\n\n# cargar datos sinim\nsinim <- arrow::read_parquet(\"https://github.com/bastianolea/sinim_datos_comunales/raw/main/datos/sinim_2019-2023.parquet\")\n\n# cargar datos de siedu\nsiedu <- arrow::read_parquet(\"https://github.com/bastianolea/siedu_indicadores_urbanos/raw/main/datos/siedu_indicadores_desarrollo_urbano.parquet\")\n```\n:::\n\n\n\n\n\n## Limpieza de datos\n\nAntes que nada, vamos a cargar `{dplyr}` para el manejo y la limpieza de los datos. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n:::\n\n\n\n\nEch√©mosle un vistazo a los datos con `glimpse()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(sinim)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 842,510\nColumns: 11\n$ municipio     <chr> \"IQUIQUE\", \"ALTO HOSPICIO\", \"POZO ALMONTE\", \"CAMI√ëA\", \"C‚Ä¶\n$ cut_comuna    <chr> \"01101\", \"01107\", \"01401\", \"01402\", \"01403\", \"01404\", \"0‚Ä¶\n$ a√±o_id        <int> 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, ‚Ä¶\n$ a√±o           <int> 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 20‚Ä¶\n$ variable_id   <chr> \"879\", \"879\", \"879\", \"879\", \"879\", \"879\", \"879\", \"879\", ‚Ä¶\n$ variable      <chr> \"Ingresos Propios Permanentes (IPP)\", \"Ingresos Propios ‚Ä¶\n$ variable_desc <chr> \"Indicador Bep Ingresos (variable sistema antiguo)\", \"In‚Ä¶\n$ area          <chr> \"01.  ADMINISTRACION Y FINANZAS MUNICIPALES\", \"01.  ADMI‚Ä¶\n$ subarea       <chr> \"A. INGRESOS MUNICIPALES (M$)\", \"A. INGRESOS MUNICIPALES‚Ä¶\n$ unidad        <chr> \"M$\", \"M$\", \"M$\", \"M$\", \"M$\", \"M$\", \"M$\", \"M$\", \"M$\", \"M‚Ä¶\n$ valor         <dbl> 34745945, 4107522, 3776040, 108439, 160661, 1067476, 333‚Ä¶\n```\n\n\n:::\n\n```{.r .cell-code}\nglimpse(siedu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 6,701\nColumns: 12\n$ codigo_comuna    <dbl> 1107, 1107, 1107, 1107, 1107, 1107, 1107, 1107, 1107,‚Ä¶\n$ codigo_region    <chr> \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\", \"01\",‚Ä¶\n$ codigo_provincia <chr> \"011\", \"011\", \"011\", \"011\", \"011\", \"011\", \"011\", \"011‚Ä¶\n$ nombre_region    <chr> \"Tarapac√°\", \"Tarapac√°\", \"Tarapac√°\", \"Tarapac√°\", \"Tara‚Ä¶\n$ nombre_provincia <chr> \"Iquique\", \"Iquique\", \"Iquique\", \"Iquique\", \"Iquique\"‚Ä¶\n$ nombre_comuna    <chr> \"Alto Hospicio\", \"Alto Hospicio\", \"Alto Hospicio\", \"A‚Ä¶\n$ id               <chr> \"BPU_8\", \"BPU_17\", \"EA_34\", \"EA_22a\", \"EA_22\", \"EA_33‚Ä¶\n$ a√±o              <dbl> 2018, 2019, 2019, 2021, 2021, 2022, 2018, 2018, 2018,‚Ä¶\n$ variable         <chr> \"Cantidad de jornadas diarias completas de trabajo de‚Ä¶\n$ valor            <dbl> 32.750000, 0.580000, 1.220618, 168.223082, 484.296058‚Ä¶\n$ medida           <chr> \"Jornadas diarias / 10.000 habs\", \"Relaci√≥n (N√∫mero d‚Ä¶\n$ estandar         <chr> \"Sin est√°ndar\", \"Sin est√°ndar\", \"Hasta 1 kilogramo / ‚Ä¶\n```\n\n\n:::\n:::\n\n\n\nNotamos que ambos conjuntos de datos vienen en el [formato _largo_](https://r4ds.had.co.nz/tidy-data.html#longer), d√≥nde tenemos una columna con los nombres de las variables o indicadores, y otra columna con los valores correspondientes. As√≠ tenemos una tabla con menor cantidad de columnas,\ndonde cada fila es una observaci√≥n que corresponde a una comuna del pa√≠s, en un a√±o espec√≠fico, para una de las variables del conjunto de datos, con su valor correspondiente.\n\nHaremos tres cosas con los datos: \n\n1. Primero haremos una selecci√≥n de variables interesantes de cada conjunto de datos. \n2. Luego, como ambos conjuntos de datos poseen mediciones de distintos a√±os en cada una de sus indicadores o estad√≠sticos, realizaremos una agrupaci√≥n por comuna y variable para dejar las mediciones m√°s recientes en cada indicador y en cada comuna. \n3. Finalmente, dejaremos s√≥lo las columnas que nos interesan\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# filtrar variables\nsinim_2 <- sinim |> \n  filter(variable %in% c(\"Ingresos Propios Permanentes per C√°pita (IPPP)\",\n                         \"Disponibilidad Presupuestaria Municipal por Habitante (M$)\",\n                         \"Inversi√≥n Municipal\",\n                         \"Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total\",\n                         \"Participaci√≥n de Ingresos por Transferencias en el Ingreso Total\",\n                         \"Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal\",\n                         \"Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos Municipales de Educaci√≥n\",\n                         \"Metros Cuadrados (M2) de Areas Verdes con Mantenimiento por Habitante\",\n                         \"Porcentaje de mujeres funcionarias municipales\",\n                         \"Densidad de Poblaci√≥n por Km2\",\n                         \"Poblaci√≥n Comunal, Estimada por el INE\",\n                         \"Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)\"))\n\n# dejar s√≥lo la medici√≥n m√°s reciente de cada variable en cada comuna\nsinim_3 <- sinim_2 |> \n  group_by(cut_comuna, variable) |> \n  slice_max(a√±o) |> \n  ungroup() |> \n  mutate(cut_comuna = as.numeric(cut_comuna))\n  \n# seleccionar columnas\nsinim_4 <- sinim_3 |> \n  select(cut_comuna, variable, valor)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# filtrar variables\nsiedu_2 <- siedu |> \n  filter(variable %in% c(\n    \"Consumo de energ√≠a el√©ctrica per c√°pita residencial\",\n    \"Tiempo de viaje en hora punta ma√±ana\",\n    \"Superficie de √°reas verdes p√∫blicas por habitante\",\n    \"N√∫mero de microbasurales por cada 10.000 habitantes\",\n    \"Poblaci√≥n estimada de migrantes internacionales por comuna\",\n    \"Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional\",\n    \"Porcentaje de viviendas en situaci√≥n de hacinamiento\",\n    \"Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes\",\n    \"Tasa de conexiones residenciales fijas de internet por cada 100 habitantes\"))\n\n# dejar s√≥lo la medici√≥n m√°s reciente de cada variable en cada comuna\nsiedu_3 <- siedu_2 |> \n  group_by(codigo_comuna, variable) |> \n  slice_max(a√±o) |> \n  ungroup()\n\n# seleccionar columnas\nsiedu_4 <- siedu_3 |> \n  select(cut_comuna = codigo_comuna, variable, valor)\n```\n:::\n\n\n\n\nVeamos c√≥mo van quedando los datos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsinim_4\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3,806 √ó 3\n   cut_comuna variable                                                     valor\n        <dbl> <chr>                                                        <dbl>\n 1       1101 Densidad de Poblaci√≥n por Km2                               1.02e2\n 2       1101 Disponibilidad Presupuestaria Municipal por Habitante (M$)  4.27e2\n 3       1101 Ingresos Propios Permanentes per C√°pita (IPPP)              1.92e2\n 4       1101 Inversi√≥n Municipal                                         2.57e6\n 5       1101 Participaci√≥n de Ingresos por Transferencias en el Ingreso‚Ä¶ 4.38e1\n 6       1101 Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total 6.4 e0\n 7       1101 Poblaci√≥n Comunal, Estimada por el INE                      2.31e5\n 8       1101 Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal  7.58e1\n 9       1101 Porcentaje de Hogares de 0-40% de Ingresos respecto del To‚Ä¶ 4.44e1\n10       1101 Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos e‚Ä¶ 7.61e1\n# ‚Ñπ 3,796 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsiedu_4\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 891 √ó 3\n   cut_comuna variable                                                     valor\n        <dbl> <chr>                                                        <dbl>\n 1       1101 Consumo de energ√≠a el√©ctrica per c√°pita residencial         7.09e2\n 2       1101 N√∫mero de microbasurales por cada 10.000 habitantes         1.21e1\n 3       1101 Poblaci√≥n estimada de migrantes internacionales por comuna  4.46e4\n 4       1101 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidi‚Ä¶ 1.97e1\n 5       1101 Porcentaje de viviendas en situaci√≥n de hacinamiento        9.92e0\n 6       1101 Superficie de √°reas verdes p√∫blicas por habitante           2.13e0\n 7       1101 Tasa de conexiones residenciales fijas de internet por cad‚Ä¶ 2.14e1\n 8       1101 Tasa de v√≠ctimas de delitos violentos por casos policiales‚Ä¶ 1.46e2\n 9       1101 Tiempo de viaje en hora punta ma√±ana                        3   e1\n10       1107 Consumo de energ√≠a el√©ctrica per c√°pita residencial         4.84e2\n# ‚Ñπ 881 more rows\n```\n\n\n:::\n:::\n\n\n\n\n### Unir datos\nVamos a combinar estos dos conjuntos de datos para tener una mezcla de variables de temas socioecon√≥micos que ser√≠a interesante correlacionar. Como hicimos que ambos conjuntos de datos est√©n ordenados bajo la misma l√≥gica, para unirlos s√≥lo necesitamos agregar las filas de un conjunto al otro. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos <- bind_rows(sinim_4, siedu_4)\n```\n:::\n\n\n\n\nAhora que los datos est√°n unidos, contamos con 20 variables para correlacionar.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos |> distinct(variable) |> print(n=Inf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 √ó 1\n   variable                                                                     \n   <chr>                                                                        \n 1 Densidad de Poblaci√≥n por Km2                                                \n 2 Disponibilidad Presupuestaria Municipal por Habitante (M$)                   \n 3 Ingresos Propios Permanentes per C√°pita (IPPP)                               \n 4 Inversi√≥n Municipal                                                          \n 5 Participaci√≥n de Ingresos por Transferencias en el Ingreso Total             \n 6 Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total                  \n 7 Poblaci√≥n Comunal, Estimada por el INE                                       \n 8 Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal                   \n 9 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) \n10 Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos‚Ä¶\n11 Porcentaje de mujeres funcionarias municipales                               \n12 Consumo de energ√≠a el√©ctrica per c√°pita residencial                          \n13 N√∫mero de microbasurales por cada 10.000 habitantes                          \n14 Poblaci√≥n estimada de migrantes internacionales por comuna                   \n15 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional          \n16 Porcentaje de viviendas en situaci√≥n de hacinamiento                         \n17 Superficie de √°reas verdes p√∫blicas por habitante                            \n18 Tasa de conexiones residenciales fijas de internet por cada 100 habitantes   \n19 Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habit‚Ä¶\n20 Tiempo de viaje en hora punta ma√±ana                                         \n```\n\n\n:::\n:::\n\n\n\n\n### Pivotar datos a ancho\n\nEl √∫ltimo paso antes del an√°lisis de correlaci√≥n es [pivotar la estructura de los datos al formato ancho.](https://r4ds.hadley.nz/data-tidy.html#widening-data), porque las funciones que realizan correlaciones en R esperan que los datos vengan de esta forma. \n\nSi bien en el formato largo tenemos una columna con el nombre de las variables y otra columna con el valor de cada variable, siendo cada fila una observaci√≥n, en el **formato ancho** cada columna corresponde a una variable, mientras que cada fila corresponde a una observaci√≥n.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\n\ndatos_ancho <- datos |> \n  # pivotar a ancho\n  pivot_wider(id_cols = cut_comuna, # columna que identifica las observaciones\n              values_from = valor, # columna con los valores\n              names_from = variable # columna con los nombres de columna\n              )\n```\n:::\n\n\n\n\nSe consultamos los nombres de las columnas, confirmamos que ahora cada variable se encuentra una columna individual:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(datos_ancho)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"cut_comuna\"                                                                                           \n [2] \"Densidad de Poblaci√≥n por Km2\"                                                                        \n [3] \"Disponibilidad Presupuestaria Municipal por Habitante (M$)\"                                           \n [4] \"Ingresos Propios Permanentes per C√°pita (IPPP)\"                                                       \n [5] \"Inversi√≥n Municipal\"                                                                                  \n [6] \"Participaci√≥n de Ingresos por Transferencias en el Ingreso Total\"                                     \n [7] \"Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total\"                                          \n [8] \"Poblaci√≥n Comunal, Estimada por el INE\"                                                               \n [9] \"Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal\"                                           \n[10] \"Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)\"                         \n[11] \"Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos Municipales de Educaci√≥n\"\n[12] \"Porcentaje de mujeres funcionarias municipales\"                                                       \n[13] \"Consumo de energ√≠a el√©ctrica per c√°pita residencial\"                                                  \n[14] \"N√∫mero de microbasurales por cada 10.000 habitantes\"                                                  \n[15] \"Poblaci√≥n estimada de migrantes internacionales por comuna\"                                           \n[16] \"Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional\"                                  \n[17] \"Porcentaje de viviendas en situaci√≥n de hacinamiento\"                                                 \n[18] \"Superficie de √°reas verdes p√∫blicas por habitante\"                                                    \n[19] \"Tasa de conexiones residenciales fijas de internet por cada 100 habitantes\"                           \n[20] \"Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes\"                    \n[21] \"Tiempo de viaje en hora punta ma√±ana\"                                                                 \n```\n\n\n:::\n:::\n\n\n\n\n\n## Correlaci√≥n\n\nEl paquete [`{corrr}`](https://corrr.tidymodels.org), parte del framework [tidymodels](https://www.tidymodels.org), nos facilita realizar una correlaci√≥n cuyo resultado viene en una tabla ordenada con tan s√≥lo una funci√≥n: `correlate()`\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(corrr)\n\ncorrelaci√≥n <- datos_ancho |> \n  select(-cut_comuna) |> \n  correlate() \n\ncorrelaci√≥n\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 √ó 21\n   term                                   Densidad de Poblaci√≥‚Ä¶¬π Disponibilidad Presu‚Ä¶¬≤ Ingresos Propios Per‚Ä¶¬≥ `Inversi√≥n Municipal` Participaci√≥n de Ing‚Ä¶‚Å¥ Participaci√≥n del Fo‚Ä¶‚Åµ Poblaci√≥n Comunal, E‚Ä¶‚Å∂ Porcentaje de Ejecuc‚Ä¶‚Å∑ Porcentaje de Hogare‚Ä¶‚Å∏ Porcentaje de Puntaj‚Ä¶‚Åπ Porcentaje de mujere‚Ä¶Àü Consumo de energ√≠a e‚Ä¶Àü N√∫mero de microbasur‚Ä¶Àü Poblaci√≥n estimada d‚Ä¶Àü Porcentaje de la pob‚Ä¶Àü Porcentaje de vivien‚Ä¶Àü Superficie de √°reas ‚Ä¶Àü Tasa de conexiones r‚Ä¶Àü Tasa de v√≠ctimas de ‚Ä¶Àü Tiempo de viaje en h‚Ä¶Àü\n   <chr>                                                   <dbl>                  <dbl>                  <dbl>                 <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>                  <dbl>\n 1 Densidad de Poblaci√≥n por Km2                         NA                     -0.0969                -0.0445               0.222                  0.0415                 -0.255                  0.480                0.192                   -0.311                  0.0238               -0.0105                0.0691                  -0.119                  0.516                -0.0295                  0.379                -0.112                   0.248                  0.657                  0.213 \n 2 Disponibilidad Presupuestaria Municip‚Ä¶                -0.0969                NA                      0.782               -0.0794                 0.110                   0.0764                -0.190               -0.217                   -0.327                 -0.0743               -0.0905                0.681                   -0.0329                -0.0473               -0.247                  -0.371                 0.404                   0.148                 -0.0675                -0.232 \n 3 Ingresos Propios Permanentes per C√°pi‚Ä¶                -0.0445                 0.782                 NA                    0.0366                 0.0233                 -0.224                 -0.0802              -0.117                   -0.359                 -0.106                -0.0711                0.762                   -0.0139                 0.0200               -0.308                  -0.391                 0.512                   0.214                 -0.0761                -0.286 \n 4 Inversi√≥n Municipal                                    0.222                 -0.0794                 0.0366              NA                      0.00615                -0.290                  0.555                0.0647                  -0.317                  0.153                -0.0946                0.222                   -0.113                  0.142                -0.409                  -0.297                 0.162                   0.375                  0.0877                -0.0957\n 5 Participaci√≥n de Ingresos por Transfe‚Ä¶                 0.0415                 0.110                  0.0233               0.00615               NA                      -0.331                  0.0326              -0.0573                  -0.0969                 0.0340                0.00478              -0.134                   -0.0293                -0.150                 0.00375                 0.0973               -0.188                   0.0971                 0.238                  0.0176\n 6 Participaci√≥n del Fondo Com√∫n Municip‚Ä¶                -0.255                  0.0764                -0.224               -0.290                 -0.331                  NA                     -0.400               -0.263                    0.511                 -0.1000               -0.0315               -0.543                   -0.0714                -0.220                 0.406                   0.273                -0.336                  -0.370                 -0.222                  0.238 \n 7 Poblaci√≥n Comunal, Estimada por el INE                 0.480                 -0.190                 -0.0802               0.555                  0.0326                 -0.400                 NA                    0.213                   -0.416                  0.110                -0.0592               -0.0770                  -0.0972                 0.404                -0.298                  -0.0503               -0.0699                  0.421                  0.313                 -0.0764\n 8 Porcentaje de Ejecuci√≥n Presupuestari‚Ä¶                 0.192                 -0.217                 -0.117                0.0647                -0.0573                 -0.263                  0.213               NA                       -0.0976                 0.0992                0.00160               0.000366                 0.0701                -0.0124               -0.0596                  0.0518                0.00593                 0.0264                 0.149                  0.182 \n 9 Porcentaje de Hogares de 0-40% de Ing‚Ä¶                -0.311                 -0.327                 -0.359               -0.317                 -0.0969                  0.511                 -0.416               -0.0976                  NA                     -0.143                -0.0263               -0.487                    0.121                 -0.279                 0.733                   0.462                -0.260                  -0.664                 -0.195                  0.257 \n10 Porcentaje de Puntajes PSU Igual o Su‚Ä¶                 0.0238                -0.0743                -0.106                0.153                  0.0340                 -0.1000                 0.110                0.0992                  -0.143                 NA                    -0.0230                0.277                   -0.0532                 0.230                -0.572                  -0.316                 0.0845                  0.412                  0.0600                -0.235 \n11 Porcentaje de mujeres funcionarias mu‚Ä¶                -0.0105                -0.0905                -0.0711              -0.0946                 0.00478                -0.0315                -0.0592               0.00160                 -0.0263                -0.0230               NA                    -0.0355                   0.0486                -0.130                 0.206                   0.0925               -0.142                  -0.0206                -0.0459                 0.210 \n12 Consumo de energ√≠a el√©ctrica per c√°pi‚Ä¶                 0.0691                 0.681                  0.762                0.222                 -0.134                  -0.543                 -0.0770               0.000366                -0.487                  0.277                -0.0355               NA                        0.0685                 0.0691               -0.346                  -0.482                 0.450                   0.342                 -0.0319                -0.155 \n13 N√∫mero de microbasurales por cada 10.‚Ä¶                -0.119                 -0.0329                -0.0139              -0.113                 -0.0293                 -0.0714                -0.0972               0.0701                   0.121                 -0.0532                0.0486                0.0685                  NA                     -0.0890                0.0742                  0.0720               -0.120                  -0.251                 -0.0503                -0.191 \n14 Poblaci√≥n estimada de migrantes inter‚Ä¶                 0.516                 -0.0473                 0.0200               0.142                 -0.150                  -0.220                  0.404               -0.0124                  -0.279                  0.230                -0.130                 0.0691                  -0.0890                NA                    -0.230                   0.246                -0.145                   0.0871                 0.523                 -0.119 \n15 Porcentaje de la poblaci√≥n en situaci‚Ä¶                -0.0295                -0.247                 -0.308               -0.409                  0.00375                 0.406                 -0.298               -0.0596                   0.733                 -0.572                 0.206                -0.346                    0.0742                -0.230                NA                       0.628                -0.169                  -0.681                  0.0239                 0.301 \n16 Porcentaje de viviendas en situaci√≥n ‚Ä¶                 0.379                 -0.371                 -0.391               -0.297                  0.0973                  0.273                 -0.0503               0.0518                   0.462                 -0.316                 0.0925               -0.482                    0.0720                 0.246                 0.628                  NA                    -0.235                  -0.505                  0.454                  0.266 \n17 Superficie de √°reas verdes p√∫blicas p‚Ä¶                -0.112                  0.404                  0.512                0.162                 -0.188                  -0.336                 -0.0699               0.00593                 -0.260                  0.0845               -0.142                 0.450                   -0.120                 -0.145                -0.169                  -0.235                NA                       0.135                 -0.0458                -0.241 \n18 Tasa de conexiones residenciales fija‚Ä¶                 0.248                  0.148                  0.214                0.375                  0.0971                 -0.370                  0.421                0.0264                  -0.664                  0.412                -0.0206                0.342                   -0.251                  0.0871               -0.681                  -0.505                 0.135                  NA                      0.172                 -0.338 \n19 Tasa de v√≠ctimas de delitos violentos‚Ä¶                 0.657                 -0.0675                -0.0761               0.0877                 0.238                  -0.222                  0.313                0.149                   -0.195                  0.0600               -0.0459               -0.0319                  -0.0503                 0.523                 0.0239                  0.454                -0.0458                  0.172                 NA                     -0.0366\n20 Tiempo de viaje en hora punta ma√±ana                   0.213                 -0.232                 -0.286               -0.0957                 0.0176                  0.238                 -0.0764               0.182                    0.257                 -0.235                 0.210                -0.155                   -0.191                 -0.119                 0.301                   0.266                -0.241                  -0.338                 -0.0366                NA     \n# ‚Ñπ abbreviated names: ¬π‚Äã`Densidad de Poblaci√≥n por Km2`, ¬≤‚Äã`Disponibilidad Presupuestaria Municipal por Habitante (M$)`, ¬≥‚Äã`Ingresos Propios Permanentes per C√°pita (IPPP)`, ‚Å¥‚Äã`Participaci√≥n de Ingresos por Transferencias en el Ingreso Total`, ‚Åµ‚Äã`Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total`, ‚Å∂‚Äã`Poblaci√≥n Comunal, Estimada por el INE`, ‚Å∑‚Äã`Porcentaje de Ejecuci√≥n Presupuestaria Devengada Municipal`, ‚Å∏‚Äã`Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)`,\n#   ‚Åπ‚Äã`Porcentaje de Puntajes PSU Igual o Superior a 450 Puntos en Establecimientos Municipales de Educaci√≥n`, Àü‚Äã`Porcentaje de mujeres funcionarias municipales`, Àü‚Äã`Consumo de energ√≠a el√©ctrica per c√°pita residencial`, Àü‚Äã`N√∫mero de microbasurales por cada 10.000 habitantes`, Àü‚Äã`Poblaci√≥n estimada de migrantes internacionales por comuna`, Àü‚Äã`Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional`, Àü‚Äã`Porcentaje de viviendas en situaci√≥n de hacinamiento`,\n#   Àü‚Äã`Superficie de √°reas verdes p√∫blicas por habitante`, Àü‚Äã`Tasa de conexiones residenciales fijas de internet por cada 100 habitantes`, Àü‚Äã`Tasa de v√≠ctimas de delitos violentos por casos policiales cada 10.000 habitantes`, Àü‚Äã`Tiempo de viaje en hora punta ma√±ana`\n```\n\n\n:::\n:::\n\n\n\nEn la tabla anterior (muy rudimentaria a√∫n) podemos ver el cruce entre todas las variables. La tabla se lee partiendo por una fila, que representa una de las variables, y cada vez que esta fila se intercepta con una columna, el valor representa el cruce de la variable de la fila con la variable de la columna.\n\nComo estamos cruzando todas con todas las variables, obviamente cada variable tambi√©n se cruza consigo misma, lo cual resulta en un `NA`. \n\nComo el resultado es muy grande, y la cantidad de columnas muy alta, `{corrr}` ofrece la funci√≥n `stretch()` para convertir f√°cilmente el resultado a un formato largo:\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrelaci√≥n |> stretch()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 400 √ó 3\n   x                             y                                                  r\n   <chr>                         <chr>                                          <dbl>\n 1 Densidad de Poblaci√≥n por Km2 Densidad de Poblaci√≥n por Km2                NA     \n 2 Densidad de Poblaci√≥n por Km2 Disponibilidad Presupuestaria Municipal por‚Ä¶ -0.0969\n 3 Densidad de Poblaci√≥n por Km2 Ingresos Propios Permanentes per C√°pita (IP‚Ä¶ -0.0445\n 4 Densidad de Poblaci√≥n por Km2 Inversi√≥n Municipal                           0.222 \n 5 Densidad de Poblaci√≥n por Km2 Participaci√≥n de Ingresos por Transferencia‚Ä¶  0.0415\n 6 Densidad de Poblaci√≥n por Km2 Participaci√≥n del Fondo Com√∫n Municipal en ‚Ä¶ -0.255 \n 7 Densidad de Poblaci√≥n por Km2 Poblaci√≥n Comunal, Estimada por el INE        0.480 \n 8 Densidad de Poblaci√≥n por Km2 Porcentaje de Ejecuci√≥n Presupuestaria Deve‚Ä¶  0.192 \n 9 Densidad de Poblaci√≥n por Km2 Porcentaje de Hogares de 0-40% de Ingresos ‚Ä¶ -0.311 \n10 Densidad de Poblaci√≥n por Km2 Porcentaje de Puntajes PSU Igual o Superior‚Ä¶  0.0238\n# ‚Ñπ 390 more rows\n```\n\n\n:::\n:::\n\n\n\nEsto nos puede servir para encontrar las correlaciones con una de las variables en particular; por ejemplo, encontrar la correlaci√≥n de las variables con el tiempo de viaje en hora punta por las ma√±anas:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrelaci√≥n |> \n  stretch() |> \n  filter(x == \"Tiempo de viaje en hora punta ma√±ana\") |> \n  select(y, r) |> \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 2\n  y                                                                      r\n  <chr>                                                              <dbl>\n1 Densidad de Poblaci√≥n por Km2                                     0.213 \n2 Disponibilidad Presupuestaria Municipal por Habitante (M$)       -0.232 \n3 Ingresos Propios Permanentes per C√°pita (IPPP)                   -0.286 \n4 Inversi√≥n Municipal                                              -0.0957\n5 Participaci√≥n de Ingresos por Transferencias en el Ingreso Total  0.0176\n6 Participaci√≥n del Fondo Com√∫n Municipal en el Ingreso Total       0.238 \n```\n\n\n:::\n:::\n\n\n\n\n### Interpretaci√≥n de correlaciones\n\nLa columna `r` nos indica el valor de la correlaci√≥n de la variable filtrada con todo el resto de las variables.\n\nComo las correlaciones pueden ser positivas o negativas, el valor de la correlaci√≥n (`r`) puede ser positivo o negativo. Los valores de correlaci√≥n van del 0 al 1 (o del 0 al -1), donde una correlaci√≥n igual a 0 significa que no existe correlaci√≥n, y una correlaci√≥n igual a 1 significa que la correlaci√≥n es total. Usualmente, una correlaci√≥n mayor a 0,3 se considera moderada, y mayor a 0,5 se considera fuerte, pero las interpretaciones De estos valores son m√∫ltiples.\n\nOrdenemos las variables por su intensidad de correlaci√≥n con el tiempo de viaje:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrelaci√≥n |> \n  stretch() |> \n  filter(x == \"Tiempo de viaje en hora punta ma√±ana\") |> \n  select(y, r) |> \n  arrange(desc(abs(r))) |> \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 2\n  y                                                                                 r\n  <chr>                                                                         <dbl>\n1 Tasa de conexiones residenciales fijas de internet por cada 100 habitantes   -0.338\n2 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional           0.301\n3 Ingresos Propios Permanentes per C√°pita (IPPP)                               -0.286\n4 Porcentaje de viviendas en situaci√≥n de hacinamiento                          0.266\n5 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH)  0.257\n6 Superficie de √°reas verdes p√∫blicas por habitante                            -0.241\n```\n\n\n:::\n:::\n\n\n\n\nEn las primeras 3 filas podemos ver **correlaciones negativas fuertes**: las comunas del pa√≠s donde los _tiempos de viaje de viaje en hora punta por la ma√±ana_ son mayores, tambi√©n son comunas donde los _puntajes en la prueba de selecci√≥n universitaria (PSU)_ son menores, y menores son los _recursos municipales por habitante_. Dicho de otro modo, a menores recursos municipales por habitantes, mayor tiempo de viaje en hora punta por la ma√±ana.\n\nEn las filas 4 y 5 vemos unas **correlaciones positivas moderadas**: los tiempos de viaje en horario punta por las ma√±anas tambi√©n son m√°s altos en las comunas donde existen m√°s _hogares con ingresos bajos_ (seg√∫n el Registro Social de Hogares), y donde los _municipios dependen m√°s del financiamiento del Fondo Com√∫n Municipal_.\n\n\n### B√∫squeda de correlaciones\nC√≥mo tenemos todos los valores de correlaci√≥n en una misma columna gracias a `stretch()`, podemos filtrar los valores para encontrar solamente con relaciones fuertes. Podemos lograr esto filtrando valores mayores a 0,5 o menores a -0,5, o filtrando valores mayores a el valor absoluto de 0,5 (`abs(0.5)`). Luego ordenamos los valores de mayor a menor, usando el valor absoluto de `r` (el valor en positivo).\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrelaci√≥n |> \n  stretch(remove.dups = T) |> \n  filter(r > 0.5 | r < -0.5) |> \n  arrange(desc(abs(r))) |> \n  head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 3\n  x                                                                            y                                                                               r\n  <chr>                                                                        <chr>                                                                       <dbl>\n1 Disponibilidad Presupuestaria Municipal por Habitante (M$)                   Ingresos Propios Permanentes per C√°pita (IPPP)                              0.782\n2 Ingresos Propios Permanentes per C√°pita (IPPP)                               Consumo de energ√≠a el√©ctrica per c√°pita residencial                         0.762\n3 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional         0.733\n4 Porcentaje de la poblaci√≥n en situaci√≥n de pobreza multidimensional          Tasa de conexiones residenciales fijas de internet por cada 100 habitantes -0.681\n5 Disponibilidad Presupuestaria Municipal por Habitante (M$)                   Consumo de energ√≠a el√©ctrica per c√°pita residencial                         0.681\n6 Porcentaje de Hogares de 0-40% de Ingresos respecto del Total Regional (RSH) Tasa de conexiones residenciales fijas de internet por cada 100 habitantes -0.664\n```\n\n\n:::\n:::\n\n\n\n\nEvidentemente, las correlaciones m√°s fuertes son entre variables similares: los hogares de menores ingresos correlacionan con la poblaci√≥n en situaci√≥n de pobreza, la disponibilidad de presupuesto municipal por habitante se correlaciona con los ingresos municipales perc√°pita, y otras obviedades. Habr√≠a que afinar la selecci√≥n de variables para remover aquellas que representan a un mismo fen√≥meno social subyacente.\n\n## Visualizaci√≥n\n\nOtra gracia de `{corrr}` es que facilita visualizar las correlaciones por medio de un gr√°fico con la funci√≥n `rplot()`, que produce un gr√°fico `{ggplot2}` con nuestra matriz de correlaci√≥n. \n\nEn teor√≠a, visualizar una correlaci√≥n ser√≠a as√≠ de f√°cil:\n\n```r\ndatos |> \n  correlate() |> \n  rplot()\n```\n\nComo nuestra matriz de correlaci√≥n tiene muchas variables, tendremos que agregar algunos ajustes para que se vea bien.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\ncorrelaci√≥n |> \n  rearrange() |> # ordenar por intensidad\n  rplot(print_cor = T, # agregar valores encima\n        legend = F) + # sin leyenda\n  # cortar los nombres de variable\n  scale_y_discrete(labels = scales::label_wrap(70)) +\n  scale_x_discrete(labels = scales::label_wrap(70)) +\n  # variables inferiores inclinadas\n  theme(axis.text.x = element_text(angle = 40, hjust = 1),\n        axis.text = element_text(lineheight = 0.9, color = \"black\"))\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-20-1.jpeg)\n:::\n:::\n\n\n\n\nCon esta visualizaci√≥n, podemos ver el color y el tama√±o de los c√≠rculos para encontrar r√°pidamente los cruces entre variables que est√°n correlacionados.\n\nA la r√°pida, podemos ver que arriba a la izquierda la variable de consumo de energ√≠a el√©ctrica se correlaciona con los recursos municipales, y abajo la izquierda podemos ver qu√© el porcentaje de hogares en los tramos menores de ingresos se correlaciona con menos conexiones a Internet y menos consumo el√©ctrico. Tambi√©n al centro del gr√°fico podemos ver una alta correlaci√≥n entre la _tasa de v√≠ctimas de delitos violentos_ y la _densidad poblacional_.\n\n\n### Alternativas\nEl paquete [`{ggcorrplot}`](https://github.com/kassambara/ggcorrplot) es muy usado para obener gr√°ficos de correlaciones, y tiene opciones que permiten personalizar la forma de visualizarlas:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggcorrplot)\n\ncorr <- round(cor(mtcars), 1)\nggcorrplot(corr)\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-21-1.jpeg)\n:::\n:::\n\n\n\n\nTambi√©n permite presentar con c√≠rculos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggcorrplot(corr, method = \"circle\")\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-22-1.jpeg)\n:::\n:::\n\n\n\n\nY tiene la opci√≥n de entregar una matriz de correlaci√≥n de los valores _p_ para excluir las correlaciones con coeficientes que no sean estad√≠sticamente significativos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggcorrplot(corr,\n           hc.order = TRUE,\n           type = \"lower\",\n           p.mat = cor_pmat(mtcars))\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-23-1.jpeg)\n:::\n:::\n\n\n\n\n\nOtra funci√≥n de R que permite realizar correlaciones y visualizarlas de inmediato es `ggcor()` del paquete [`{GGally}`](https://ggobi.github.io/ggally/index.html), que entrega varios tipos de gr√°ficos estad√≠sticos para an√°lisis exploratorios de datos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos_ancho |> \n  select(-cut_comuna) |> \n  GGally::ggcorr(hjust = 1, nbreaks = 5, layout.exp = 10,\n                 label = TRUE)\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-24-1.jpeg)\n:::\n:::\n\n\n\n\nEl resultado es menos atractivo, pero si es bastante m√°s legible.\n\n### Manualmente\n\nFinalmente, y como no pod√≠a faltar, tambi√©n podemos crear un gr√°fico de la matriz de correlaci√≥n desde cero con `{ggplot2}`. Esto no es tan complejo gracias a que `correlate()` y `stretch()` entregan los resultados bien ordenaditos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos_ancho |> \n  correlate() |> \n  rearrange() |> \n  stretch() |> \n  # gr√°fico\n  ggplot() +\n  aes(x, y, fill = r) +\n  geom_tile(color = \"white\", linewidth = 0.6) + # geometr√≠a de cuadros o mosaicos\n  geom_text(aes(label = round(r, 1)), color = \"black\", size = 3) + # texto\n  # escala de color de los cuadros\n  scale_fill_gradient2(high = \"indianred2\", mid = \"white\", low = \"skyblue1\", na.value = \"white\") +\n  # formato de las escalas de los ejes\n  scale_y_discrete(labels = scales::label_wrap(50), expand = c(0, 0)) +\n  scale_x_discrete(labels = scales::label_wrap(60), expand = c(0, 0)) +\n  # ajustes de tema\n  theme_minimal() +\n  theme(axis.text = element_text(lineheight = 0.9, color = \"black\"),\n        axis.text.x = element_text(angle = 40, hjust = 1),\n        axis.title = element_blank(),\n        legend.key.width = unit(2, \"mm\"))\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-25-1.jpeg)\n:::\n:::\n\n\n\n\nTambi√©n podemos aprovechar el vuelo para hacer una bonita obra de arte con nuestras correlaciones:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatos_ancho |> \n  correlate() |> \n  rearrange() |> \n  stretch() |> \n  ggplot() +\n  aes(x, y, fill = r) +\n  geom_tile(color = \"white\", linewidth = 0.6) +\n  scale_fill_gradient2(high = \"#865BAB\", mid = \"white\", low = \"#AB5B90\", na.value = \"white\") +\n  guides(fill = guide_none()) +\n  theme_void() +\n  coord_fixed()\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-26-1.jpeg)\n:::\n:::\n\n\n\n\nComo siempre, `{ggplot2}` es una herramienta extremadamente vers√°til para visualizar cualquier tipo de informaci√≥n. Puedes [aprender a crear visualizaciones de datos desde cero en R siguiendo este tutorial de `{ggplot2}`.](https://bastianolea.rbind.io/blog/r_introduccion/tutorial_visualizacion_ggplot/)\n\n----\n\nSi te gust√≥ este contenido, puedes ayudarme don√°ndome un cafecito si presionas el siguiente bot√≥n. Te lo agradecer√≠a mucho y me anima a seguir compartiendo!\n\n\n\n\n{{< cafecito >}}\n\n\n{{< cursos >}}\n\n",
    "supporting": [
      "index.markdown_strict_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}