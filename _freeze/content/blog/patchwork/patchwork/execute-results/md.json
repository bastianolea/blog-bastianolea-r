{
  "hash": "5b67532409bcafdb078fa37f2993de47",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Unir y combinar gráficos {ggplot2} con {patchwork}\nauthor: Bastián Olea Herrera\ndate: '2025-03-08'\ndraft: false\nfreeze: true\nformat:\n  hugo-md:\n    output-file: \"index\"\n    output-ext: \"md\"\nslug: []\ncategories: []\ntags:\n  - visualización de datos\n  - gráficos\n  - ggplot2\neditor_options: \n  chunk_output_type: inline\nexecute:\n  message: false\n  warning: false\nlinks:\n  - icon: registered\n    icon_pack: fas\n    name: Patchwork\n    url: https://patchwork.data-imaginist.com/index.html\nexcerpt: El paquete `{patchwork}` ayuda a unir y combinar múltiples gráficos de {ggplot2}. En esta guía veremos los principios del uso de este paquete, que nos permitirá construir visualizaciones más densas, por medio de la combinación de gráficos en una sola visualización, y la inserción de gráficos dentro de otros.\n---\n\n\n\n[El paquete `{patchwork}`](https://patchwork.data-imaginist.com/articles/patchwork.html) ayuda a **unir y combinar gráficos** de `{ggplot2}`. En esta guía veremos los principios del uso de este paquete, que nos permitirá construir visualizaciones más complejas\n\n\n\n{{< indice >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(patchwork)\n```\n:::\n\n\n\nPrimero crearemos dos gráficos de muestra, a partir del dataset `iris`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_a <- iris |> \n  # calcular promedios por especie\n  group_by(Species) |> \n  summarize(Sepal.Length = mean(Sepal.Length)) |> \n  # gráfico\n  ggplot() +\n  aes(x = Sepal.Length, y = Species) +\n  # barras\n  geom_col(fill = \"darkslategray3\", width = 0.6) +\n  theme_void()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_b <- iris |> \n  # conteo por especies\n  count(Species) |> \n  # porcentaje\n  mutate(p = n/sum(n)) |> \n  # gráfico\n  ggplot() +\n  aes(x = 1, y = p, fill = Species) +\n  geom_col() +\n  # escala de color\n  scale_fill_brewer(name = \"Set2\", type = \"qual\") +\n  # gráfico de torta\n  coord_polar(theta = \"y\") +\n  theme_void() +\n  guides(fill = guide_legend(title = NULL))\n```\n:::\n\n\n\n### Combinar dos gráficos lado a lado\nGracias a `{patchwork}`, unir dos gráficos uno al lado del otro es tan sencillo como ”sumarlos”:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_a + grafico_b\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot1-1.png){width=768}\n:::\n:::\n\n\n\nSi queremos ajustar las proporciones de los gráficos, agregamos la función `plot_layout()` para especificar las proporciones. Haremos que uno de los gráficos sea el doble de ancho que el otro:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_a + grafico_b + plot_layout(widths = c(1, 2))\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot2-1.png){width=768}\n:::\n:::\n\n\n\n### Combinar dos gráficos uno arriba del otro\n\nPara combinar dos gráficos en disposición vertical; es decir, uno arriba del otro, bsata con ”dividir” los dos gráficos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_a / grafico_b\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot3-1.png){width=768}\n:::\n:::\n\n\n\n### Combinar más de dos gráficos\nCreemos un tercer gráfico de nuestra para probar la combinación de tres gráficos en uno solo:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_c <- iris |> \n  ggplot() +\n  geom_bar(aes(Petal.Width, fill = Species)) +\n  scale_fill_brewer(name = \"Set2\", type = \"qual\") +\n  scale_y_continuous(expand = expansion(c(0, 0.1))) +\n  theme_void() +\n  guides(fill = guide_legend(title = NULL))\n```\n:::\n\n\n\nTeniendo dos gráficos, podemos disponerlos uno al lado dle otro, y el tercer gráfico debajo de los dos primeros; es decir, sumar `a` + `b` y luego dividirlos por `c`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(grafico_a + grafico_b) / grafico_c + \n  plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot5-1.png){width=768}\n:::\n:::\n\n\nEn este caso agregamos una función `plot_layout()` para combinar las leyendas de dos de los gráficos, dado que las leyendas son iguales y sería redundante que cada gráfico las presente por separado.\n\nPara ajustar las proporciones en este caso, podemos primero crear la fila 1 del gráfico final, ajustando su proporción, y luego a esta fila agregarle el gráfico de abajo:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfila_1 <- grafico_a + grafico_b + plot_layout(widths = c(3, 1))\n\nfila_1 / grafico_c + plot_layout(guides = \"collect\")\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot6-1.png){width=768}\n:::\n:::\n\n\n\n\n## Poner un gráfico dentro de otro\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_d <- iris |> \n  ggplot() +\n  geom_bar(aes(x = 1), alpha = 0.6) +\n  coord_polar(theta = \"y\") +\n  theme_void()\n```\n:::\n\n\n\nTambién podemos necesitar insertar un gráfico dentro de otro, quizás porque uno de los gráficos representa un detalle del otro, y como tal puede que sea más conveniente disponerlo dentro del primero.\n\nPara insertar un gráfico dentro de otro, se agrega a un gráfico la función `inset_element()` con el gráfico que queremos insertar. Dentro de esta función hay que definir los argumentos `top`, `bottom`, `left` y `right`, que corresponden al perímetro en el que se ubicará el gráfico insertado.\n\nPara ubicar el gráfico dentro, debemos entender que el límite superior del gráfico corresponde a `top = 1`, y el inferior a `bottom = 0`, mientras que el límite izquierdo es `left = 0` y el derecho es `right = 1`. Si usamos estos argumentos, el gráfico insertado usaría la totalidad del espacio del gráfico base:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_c + inset_element(grafico_d,\n                          top = 1, bottom = 0,\n                          left = 0, right = 1)\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot7-1.png){width=768}\n:::\n:::\n\n\nNotemos que las coordenadas corresponden con el _centro_ del área del gráfico, excluyendo el área de la leyenda.\n\nSi ponemos que `top = 0.5`y `right = 0.5`, entonces el borde superior del gráfico insertado estará en la mitad del alto del gráfico base, y el borde derecho en la mitad del ancho; es decir, ubicándolo en la esquina inferior izquierda.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_c + inset_element(grafico_d,\n                          top = 0.5, bottom = 0,\n                          left = 0, right = 0.5)\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot8-1.png){width=768}\n:::\n:::\n\n\n\nSabiendo esto, podemos ajustar los argumentos de `inset_element()` para poner el gráfico exactamente donde queremos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_c + inset_element(grafico_b + guides(fill = guide_none()),\n                          top = .9, bottom = .4,\n                          left = .2, right = .5)\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot9-1.png){width=768}\n:::\n:::\n\n\n\nNaturalmente, podríamos combinar este gráfico con un gráfico insertado con otro gráfico más, o con la cantidad que se nos ocurra:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrafico_c + \n  guides(fill = guide_legend(position = \"inside\", title = NULL)) +\n  theme(legend.position.inside = c(.8, .7)) +\n  inset_element(grafico_b + guides(fill = guide_none()),\n                top = 1, bottom = .4,\n                left = .2, right = .6) +\n  (grafico_a / grafico_a / grafico_a / grafico_a / grafico_a / grafico_a)\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/plot10-1.png){width=768}\n:::\n:::\n\n\n\nOtra forma de insertar un gráfico dentro de otro es ubicándolo a una cierta distancia desde un borde; en este caso, insertaremos un gráfico que solo contiene un texto (el año) en al esquina superior derecha, y para ello, definiremos que el borde izquierdo de la figura insertada `inset_element()` se ubique en el borde izquierdo del gráfico menos 3 centímetros, el borde derecho de la figura insertada en el límite derecho del gráfico, el borde superior en el límite superior del gráfico, y el borde inferior de la figura a 2 centímetros menos del límite superior del gráfico. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# gráfico vacío que solo contiene un texto\ntexto_año <- ggplot() + annotate(\"text\", x = 1, y = 1, label = 2025, size = 7) +  theme_void()\n\ngrafico_c +\n  inset_element(\n      texto_año,\n      left = unit(1, 'npc') - unit(3, 'cm'),\n      right = 1,\n      top = 1, \n      bottom = unit(1, 'npc') - unit(2, 'cm'),\n      align_to = \"full\")\n```\n\n::: {.cell-output-display}\n![](patchwork.markdown_strict_files/figure-markdown_strict/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n\nPodemos usar esta técnica para insertar cualquier texto en cualquier posición de un gráfico, incluso fuera de los límites de las escalas (que sería una limitación de hacer lo mismo con `annotate()`.\n\nLa gracia de usar `inset_element()` es que posicionamos los elementos con respecto al tamaño del gráfico (donde el borde izquierdo es 0 y el derecho es 1, y el borde inferior es 0 y el superior es 1) y no a las coordenadas de las variables `x` e `y`, lo que nos permite ubicar los elementos de forma independiente al sistema de coordenadas del gráfico.\n\n\n\n\n\n{{< cafecito >}}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}