{
  "hash": "bca4ef4786476f6e7985a5806ab3feb1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Rotar un mapa de Chile en R para que quede horizontal\nauthor: Basti谩n Olea Herrera\nformat:\n  hugo-md:\n    output-file: \"index\"\n    output-ext: \"md\"\ndate: '2025-03-04'\nslug: []\ncategories: []\nfreeze: true\ntags:\n  - mapas\n  - visualizaci贸n de datos\n  - Chile\neditor_options: \n  chunk_output_type: console\nexcerpt: Visualizar un mapa de Chile puede ser complicado debido a su largo. Muchas veces cuesta ubicar correctamente el mapa por el espacio vertical que requiere. Pero en ciertos casos puede ser conveniente visualizar a Chile _de lado_, para aprovechar el espacio horizontal. En esta gu铆a veremos c贸mo rotar un mapa de Chile 90掳 hacia la izquierda en R para que quede acostado.\nlinks:\n  - icon: file-code\n    icon_pack: fas\n    name: C贸digo\n    url: https://gist.github.com/bastianolea/8e3dff701fb660ee7cb5091bd1195b5f\n---\n\n\n\nVisualizar un mapa de Chile puede ser complicado debido a su largo. Muchas veces cuesta ubicar correctamente el mapa por el espacio vertical que requiere. Pero en ciertos casos puede ser conveniente **visualizar a Chile _de lado_**, para aprovechar el espacio horizontal. \n\nEn esta gu铆a veremos c贸mo rotar un mapa de Chile 90掳 hacia la izquierda en R para que quede acostado ゐ\n\n\n\n{{< aviso \"Si necesitas aprender en profundidad la visualizaci贸n de mapas con R, revisa mi [tutorial de mapas y datos espaciales con `{sf}`](/blog/mapas_sf/).\" >}}\n\n\n\n\nPrimero cargamos los paquetes necesarios:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf) # manejo de datos espaciales\nlibrary(chilemapas) # mapas de Chile\nlibrary(ggplot2) # visualizaci贸n de datos\nlibrary(dplyr) # manejo de datos tabulares\nlibrary(readr) # cargar datos\n```\n:::\n\n\n\nObtenemos un mapa de Chile [gracias al paquete `{chilemapas}`](https://github.com/pachadotdev/chilemapas); en este caso un mapa del pa铆s por regiones:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# obtener mapa\nmapa_region <- chilemapas::generar_regiones()\n\nmapa_region\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 16 features and 1 field\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: -109.4499 ymin: -56.52511 xmax: -66.41617 ymax: -17.49778\nGeodetic CRS:  SIRGAS 2000\n# A tibble: 16  2\n   codigo_region                                                        geometry\n * <chr>                                                          <GEOMETRY [掳]>\n 1 01            POLYGON ((-68.86081 -21.28512, -68.7581 -21.21752, -68.65677 -\n 2 02            MULTIPOLYGON (((-68.98863 -25.38016, -68.98522 -25.37566, -68.\n 3 03            MULTIPOLYGON (((-70.68641 -26.15053, -70.68923 -26.15726, -70.\n 4 04            MULTIPOLYGON (((-71.66962 -30.34526, -71.67234 -30.34574, -71.\n 5 05            MULTIPOLYGON (((-71.67929 -33.44583, -71.68012 -33.448, -71.67\n 6 06            POLYGON ((-71.1344 -34.78711, -71.12134 -34.80128, -71.09905 -\n 7 07            POLYGON ((-72.1032 -36.12348, -72.09964 -36.12574, -72.09894 -\n 8 08            MULTIPOLYGON (((-71.41259 -38.10669, -71.3922 -38.098, -71.383\n 9 09            MULTIPOLYGON (((-73.35579 -38.73982, -73.35306 -38.73343, -73.\n10 10            MULTIPOLYGON (((-73.6175 -41.8142, -73.61389 -41.80392, -73.61\n11 11            MULTIPOLYGON (((-74.34857 -45.02053, -74.34886 -45.02632, -74.\n12 12            MULTIPOLYGON (((-71.18405 -52.8089, -71.17569 -52.80759, -71.1\n13 13            POLYGON ((-70.47405 -33.8624, -70.47327 -33.86269, -70.46068 -\n14 14            MULTIPOLYGON (((-71.65597 -40.35386, -71.65874 -40.34691, -71.\n15 15            POLYGON ((-70.35079 -18.8362, -70.34707 -18.83939, -70.34351 -\n16 16            POLYGON ((-72.38553 -36.91169, -72.37685 -36.91617, -72.37034 \n```\n\n\n:::\n\n```{.r .cell-code}\n# visualizar\nmapa_region |> \n  ggplot(aes()) +\n  geom_sf() +\n  # recortar coordenadas horizontales\n  coord_sf(xlim = c(-80, -62))\n```\n\n::: {.cell-output-display}\n![](mapa_chile_horizontal.markdown_strict_files/figure-markdown_strict/unnamed-chunk-2-1.png){width=768}\n:::\n:::\n\n\n\nCargamos algunos datos regionales para ponerle al mapa, sacados de mi proyecto de [visualizaci贸n de datos econ贸micos de Chile](https://bastianoleah.shinyapps.io/economia_chile/):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# obtener datos\ndatos <- read_csv2(\"https://github.com/bastianolea/economia_chile/raw/main/app/datos/pib_regional.csv\")\n# https://github.com/bastianolea/economia_chile\n\n# limpiar datos\ndatos_2 <- datos |> \n  group_by(serie) |> \n  slice_max(a帽o) |> \n  slice_max(mes) |> \n  select(nombre_region = serie, valor, a帽o, trimestre, mes)\n\n# crear tabla de regiones\nregiones <- tribble(~codigo_region, ~nombre_region,\n                    \"01\", \"Regi贸n de Arica y Parinacota\",\n                    \"02\", \"Regi贸n de Tarapac谩\",\n                    \"03\", \"Regi贸n de Antofagasta\",\n                    \"04\", \"Regi贸n de Atacama\",\n                    \"05\", \"Regi贸n de Coquimbo\",\n                    \"06\", \"Regi贸n de Valpara铆so\",\n                    \"07\", \"Regi贸n Metropolitana de Santiago\",\n                    \"08\", \"Regi贸n del Libertador General Bernardo OHiggins\",\n                    \"09\", \"Regi贸n del Maule\",\n                    \"10\", \"Regi贸n de uble\",\n                    \"11\", \"Regi贸n del Biob铆o\",\n                    \"12\", \"Regi贸n de La Araucan铆a\",\n                    \"13\", \"Regi贸n de Los R铆os\",\n                    \"14\", \"Regi贸n de Los Lagos\",\n                    \"15\", \"Regi贸n de Ays茅n del General Carlos Ib谩帽ez del Campo\",\n                    \"16\", \"Regi贸n de Magallanes y de la Ant谩rtica Chilena\")\n```\n:::\n\n\n\nAhora que tenemos los datos listos, los agregamos al mapa [usando un `left_join()`](/blog/left_join/):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# agregar regiones y datos al mapa\nmapa_datos <- mapa_region |> \n  left_join(regiones, by = join_by(codigo_region)) |> \n  left_join(datos_2, by = join_by(nombre_region))\n```\n:::\n\n\n\nFinalmente, previsualizamos el mapa con los datos agregados:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# visualizar mapa con datos\nmapa_datos |> \n  ggplot() +\n  aes(fill = valor) +\n  geom_sf(linewidth = 0) +\n  coord_sf(xlim = c(-80, -62)) +\n  scale_fill_distiller(type = \"seq\", palette = 12,\n                       labels = scales::label_comma(big.mark = \".\")) +\n  theme_classic() +\n  theme(axis.text = element_blank(),\n        axis.line = element_blank(),\n        axis.ticks = element_blank())\n```\n\n::: {.cell-output-display}\n![](mapa_chile_horizontal.markdown_strict_files/figure-markdown_strict/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n\n\nAhora que tenemos un mapa de Chile con datos regionales, procedemos a **rotar el mapa**. Para esto, necesitamos una _matriz de rotaci贸n_, respecto de la cual no hay mucho que entender, salvo que nos permitir谩 multiplicar la geometr铆a del mapa para obtener como resultado la misma geometr铆a, pero rotada. El 煤nico detalle que hay que considerar es que es necesario **cambiar la proyecci贸n del mapa** para que la zona sur del pa铆s no se vea deformada.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# reprojectar a CRS EPSG:5361 para evitar deformaci贸n\nmapa_proyectado <- st_transform(mapa_datos, 5361)\n\n# matriz de rotaci贸n 90掳 izquierda\nrotacion <- matrix(c(0, -1, 1, 0), 2, 2)\n\n# aplicar rotaci贸n al mapa proyectado\nmapa_rotado <- mapa_proyectado |> \n  mutate(geometry = geometry * rotacion)\n```\n:::\n\n\n\nAhora visualizamos el **mapa reproyectado y rotado**:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_rotado |> \n  ggplot() +\n  aes(fill = valor) +\n  geom_sf(linewidth = 0) +\n  scale_y_continuous(labels = scales::label_number()) +\n  coord_sf(ylim = c(800000, -100000)) +\n  labs(title = \"Mapa de Chile horizontal\",\n       subtitle = \"A mimir\") +\n  scale_fill_distiller(type = \"seq\", palette = 12,\n                       labels = scales::label_comma(big.mark = \".\")) +\n  guides(fill = guide_legend(position = \"bottom\")) +\n  theme_classic() +\n  theme(axis.text = element_blank(),\n        axis.line = element_blank(),\n        axis.ticks = element_blank())\n```\n\n::: {.cell-output-display}\n![](mapa_chile_horizontal.markdown_strict_files/figure-markdown_strict/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n\n\nListo! Revisa el [c贸digo completo](https://gist.github.com/bastianolea/8e3dff701fb660ee7cb5091bd1195b5f) en el siguiente bot贸n para poder copiarlo y pegarlo en tu proyecto:\n\n\n\n{{< boton \"Ver c贸digo completo\" \"https://gist.github.com/bastianolea/8e3dff701fb660ee7cb5091bd1195b5f\" \"fas fa-file-code\" >}}\n\n\n\n\n### Fuentes\n- [DeepSeek DeepThink (R1)](https://chat.deepseek.com)\n- https://gist.github.com/ryanpeek/99c6935ae51429761f5f73cf3b027da2\n- https://r-spatial.github.io/sf/articles/sf3.html#affine-transformations\n- https://en.wikipedia.org/wiki/Rotation_matrix\n\n\n\n\n{{< cafecito >}}\n\n\n{{< cursos >}}\n",
    "supporting": [
      "mapa_chile_horizontal.markdown_strict_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}