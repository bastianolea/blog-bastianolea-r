{
  "hash": "547e6eb1dcbcc9ff54365d5273fe203c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Validaci칩n b치sica de datos con R'\nauthor: Basti치n Olea Herrera\ndate: '2025-08-07'\nslug: []\nfreeze: true\ncategories: []\nformat:\n  hugo-md:\n    output-file: \"index\"\n    output-ext: \"md\"\ntags:\n  - procesamiento de datos\n  - consejos\n  - automatizaci칩n\n  - control de flujo\n  - funciones\nexcerpt: Si est치s procesando muchos datos y/o datos que vienen de distintas fuentes con R, validarlos puede ayudarte a encontrar problemas antes de que sea tarde! 쯈u칠 es la validaci칩n de datos? Son las distintas pruebas que crearemos para confirmar que nuestros datos cumplen ciertos criterios. El objetivo es entregarnos la certeza de que nuestros datos son como esperamos luego de procesarlos. Para lograrlo, ponemos a prueba nuestros datos en distintos puntos de nuestros procesos de an치lisis de datos.\n---\n\n{{< indice >}}\n\n\n\n\nSi est치s procesando muchos datos y/o datos que vienen de distintas fuentes con R, validarlos puede ayudarte a encontrar problemas antes de que sea tarde! 游땸\n\n쯈u칠 es la validaci칩n de datos? Son las distintas pruebas que crearemos para **confirmar que nuestros datos cumplen ciertos criterios**. El objetivo es entregarnos la **certeza** de que nuestros datos son como esperamos luego de procesarlos. Para lograrlo, ponemos a prueba nuestros datos en distintos puntos de nuestros procesos de an치lisis de datos.\n\nPor ejemplo: luego de cargar un conjunto de datos a R y realizar una limpieza b치sica, realmente los datos quedaron como deb칤an quedar? \n\n- 쯊enemos datos perdidos en variables donde no esperamos que los hayan?\n- 쯃a tabla tiene la cantidad de filas esperadas?\n- En una variable num칠rica, 쯘xisten observaciones que se salen del rango esperable? Como a침os en el futuro, edades imposibles, etc.\n- Las columnas que contienen n칰meros, 쯥on realmente num칠ricas, o hay texto en algunas celdas escurridizas?\n- 쯃as variables categ칩ricas o de texto est치n bien escritas, o vienen cosas repetidas en min칰sculas y otras en may칰sculas?\n- 쯋na variable categ칩rica contiene exactamente las categor칤as posibles, o tiene m치s o menos que las esperadas?\n\n칄ste tipo de revisiones las hacemos generalmente de forma manual mientras exploramos los datos. Pero la idea de la validaci칩n de datos es que **formalicemos estas pruebas** para poder **aplicarlas en distintos momentos, y a distintos conjuntos de datos.**\n\n## Validaci칩n b치sica\n\nEn el fondo, una validaci칩n no es m치s que evaluar una expresi칩n condicional para ver si se cumple o no se cumple. Creemos un conjunto de datos de prueba:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nanimales <- tribble(~animal,  ~patas, ~lindura,   ~color,\n                    \"mapache\",     4,      100,   \"gris\",\n                    \"gato\",       80,       90,  \"negro\",\n                    \"gallina\",     2,       NA, \"plumas\")\n```\n:::\n\n\n\nPara validar los datos, puedes usar expresiones `if`s para crear **pruebas que revisan si tus resultados cumplen con criterios m칤nimos**, como contener ciertas columnas, que no hayan datos perdidos, o lo que necesites. \n\nCreemos una expresi칩n condicional para revisar si es que nuestra tabla de datos tiene **al menos una observaci칩n**:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# validar si el dataframe tiene filas\nif (nrow(animales) > 0) {\n  message(\"tabla con filas!\")\n} else {\n  warning(\"tabla sin filas\")\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\ntabla con filas!\n```\n\n\n:::\n:::\n\n\nCon este c칩digo confirmamos que los datos cumplen con este criterio m칤nimo. Si modificamos los datos y probamos de nuevo, la validaci칩n nos avisar치 que hay un problema con los datos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# modificar el dataframe y ver si sigue cumpliendo\nanimales2 <- animales |> filter(patas == 0)\n\nif (nrow(animales2) > 0) {\n  message(\"tabla con filas!\")\n} else {\n  warning(\"tabla sin filas :(\")\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: tabla sin filas :(\n```\n\n\n:::\n:::\n\n\n\nSiguiendo la misma idea, podemos crear otras validaciones para confirmar que los datos vienen como esperamos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# revisar que no hayan datos perdidos en columna `lindura`\nif (sum(is.na(animales$lindura)) == 0) {\n  message(\"sin datos perdidos en variable `lindura`\")\n} else {\n  stop(\"datos perdidos en variable `lindura`, 쯔caso demasiada lindura?\")\n}\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: datos perdidos en variable `lindura`, 쯔caso demasiada lindura?\n```\n\n\n:::\n\n```{.r .cell-code}\n# revisar que variable `patas` no tenga observaciones fuera del rango posible\nif (all(between(animales$patas, 2, 8))) {\n  message(\"cantidad de patas aceptable\")\n} else {\n  stop(\"demasiadas patas!\")\n}\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: demasiadas patas!\n```\n\n\n:::\n\n```{.r .cell-code}\n# revisar que los valores de `colores` sean v치lidos\nif (all(animales$color %in% c(\"verde\", \"negro\", \"caf칠\", \"gris\", \"blanco\"))) {\n  message(\"colores aceptables\")\n} else {\n  stop(\"variable colores tiene datos fuera de lo esperado\")\n}\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: variable colores tiene datos fuera de lo esperado\n```\n\n\n:::\n:::\n\n\n\nAl ejecutar esta validaciones obtenemos mensajes que nos indican el estado de los datos, o su calidad.\n\nDentro de las condicionales puedes agregar `warning()` o `message()` para recibir avisos en tu consola dependiendo de lo que se obtiene en cada prueba. Tambi칠n puedes usar `stop()` para que **detener la ejecuci칩n** si la validaci칩n sale negativa, en el caso de que sea muy importante de resolver el problema con los datos de manera inmediata en vez de continuar con el flujo de procesamiento. \n\nOtra alternativa para crear validaciones es usar la funci칩n `stopifnot()`, a la que le entregamos una condici칩n que esperamos que se cumpla, y si no se cumple, la ejecuci칩n se detiene:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstopifnot(\"valores perdidos\" = is.na(animales$lindura))\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: valores perdidos\n```\n\n\n:::\n:::\n\n\nLa diferencia es que con `stopifnot()` tenemos menos control sobre qu칠 hacer cuando se cumple o no se cumple la condici칩n, y solamente te avisa si es que no se cumple.\n\n## Funciones de validaci칩n\n\nEl siguiente paso es reunir todas estas pruebas en una sola funci칩n, para que puedas reutilizarla en distintas versiones de la tabla, y en distintos conjuntos de datos.\n\nCreamos una funci칩n con `function()`, donde el argumento `data` va a representar el conjunto de datos que pasemos a la funci칩n.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrevisar <- function(data) {\n  \n  # prueba de filas\n  if (nrow(data) > 0) {\n    message(\"filas ok\") \n  } else {\n    warning(\"tabla sin filas\")\n  }\n  \n  # prueba de perdidos\n  if (any(is.na(data$lindura))) {\n    warning(\"datos perdidos\")\n  } else {\n    message(\"sin datos perdidos\")\n  }\n  \n  # prueba de rangos\n  if (all(between(data$patas, 2, 8))) {\n    message(\"rango aceptable\")\n  } else {\n    warning(\"datos fuera de rango\")\n  }\n  \n  # prueba de valores categ칩ricos\n  if (all(data$color %in% c(\"verde\", \"negro\", \"caf칠\", \"rosado\", \"gris\", \"blanco\"))) {\n    message(\"valores esperados\")\n  } else {\n    warning(\"valores inesperados\")\n  }\n}\n```\n:::\n\n\n\nAhora podemos aplicar la funci칩n a los datos para validarlos en cualquier momento:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrevisar(animales)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfilas ok\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in revisar(animales): datos perdidos\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in revisar(animales): datos fuera de rango\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in revisar(animales): valores inesperados\n```\n\n\n:::\n:::\n\n\n\nPodemos corregir los datos y volver a aplicar la validaci칩n para confirmar que ahora est치n correctos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# corregir datos luego de las pruebas\nanimales_3 <- animales |> \n  filter(patas <= 8) |> \n  mutate(color = recode(color, \"plumas\" = \"blanco\")) |> \n  mutate(lindura = if_else(is.na(lindura), 0, lindura))\n\n# validar\nrevisar(animales_3)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfilas ok\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nsin datos perdidos\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrango aceptable\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nvalores esperados\n```\n\n\n:::\n:::\n\n\n\nFinalmente, podemos volver a aplicar la validaci칩n a un conjunto de datos actualizado o una versi칩n distinta de una tabla con las mismas caracter칤sticas:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanimales_4 <- tribble(~animal,  ~patas, ~lindura,    ~color,\n                      \"perro\",       4,       50,    \"caf칠\",\n                     \"ratita\",       3,       99,    \"caf칠\",\n                    \"chancho\",       4,       70,  \"rosado\",\n                      \"ara침a\",       8,     -100,   \"negro\")\n\nanimales_4 |> revisar()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfilas ok\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nsin datos perdidos\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrango aceptable\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nvalores esperados\n```\n\n\n:::\n\n```{.r .cell-code}\nanimales_4 |> filter(lindura > 50) |> revisar()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfilas ok\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nsin datos perdidos\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrango aceptable\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nvalores esperados\n```\n\n\n:::\n:::\n\n\n\nEstas peque침as buenas pr치cticas te van a ayudar a reducir la incertidumbre en rutinas largas de procesamiento de datos!\n\n## Validaci칩n avanzada\n[El paquete de R `{pointblank}`](https://rstudio.github.io/pointblank/) se especializa en validaci칩n de datos, as칤 que si requieres algo m치s avanzado para garantizar la calidad de tus datos y la estabilidad de tus procesos, [revisa este post con un tutorial!](/blog/validacion_avanzada/)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}