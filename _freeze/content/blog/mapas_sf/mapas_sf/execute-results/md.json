{
  "hash": "750c1026b86db4fc25c76f2ba93435eb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Mapas y visualización de datos geoespaciales en R con {sf}\nauthor: Bastián Olea Herrera\ndate: '2025-11-18'\ndraft: false\nfreeze: true\nslug: []\ncategories:\n  - tutoriales\ntags:\n  - mapas\n  - visualización de datos\nformat:\n  hugo-md:\n    output-file: index\n    output-ext: md\nlinks:\n  - icon: registered\n    icon_pack: fas\n    name: SF\n    url: https://r-spatial.github.io/sf/\nexecute:\n  eval: true\n  cache: false\n  warning: false\nexcerpt: \"R cuenta con un muy amplio ecosistema para trabajar con datos geoespaciales. Uno de los paquetes más importantes es `{sf}`, que permite manipular datos espaciales a partir del estándar _simple features_ (características simples). En esta guía iré recopilando los comandos básicos para manipular y visualizar datos geoespaciales en R. En la medida que voy aprendiendo más sobre hacer mapas, iré actualizando y complementando.\"\n---\n\n{{< imagen \"mapa_rm_featured.png\" >}}\n\n\n{{< aviso \"⚠️ Este tutorial se encuentra en construcción! ⚠️\" >}}\n\n\n\n\nR cuenta con un muy amplio [ecosistema](https://github.com/r-spatial/) de paquetes para datos geoespaciales. Uno de los [paquetes más importantes es `{sf}`](https://r-spatial.github.io/sf/), que permite manipular datos espaciales a partir del estándar _simple features_ (características simples), ampliamente utilizado en sistemas de información geográfica (SIG/GIS).\n\nEn esta guía iré guardando los comandos que uso frecuentemente para **manipular, transformar y visualizar datos geoespaciales** en R. En la medida que voy aprendiendo más sobre hacer mapitas, iré actualizando y complementando.\n\nLo inicial es instalar `{sf}`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"sf\")\n```\n:::\n\n\n\nY cargarlo junto a `{dplyr}` para empezar a trabajar con datos geoespaciales.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(dplyr)\n```\n:::\n\n\n\n\n**Nota:** para simplificar, en este tutorial voy a ocultar el código de los gráficos, pero siempre estará disponible bajo flechitas que despliegan el código, como la siguiente:\n\n\n\n{{< detalles \"**Ver código para los gráficos**\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\n# tema de colores\nthematic::thematic_on(fg = \"#553A74\",\n                      bg = \"#EAD2FA\",\n                      accent = \"#9069C0\")\n\ntheme_set(\n  # fondo transparente para mapas\n  theme(plot.background = element_rect(fill = \"transparent\", color = \"transparent\")) +\n    # borrar líneas feas\n    theme(axis.ticks = element_blank())\n)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n<br>\n\n\n\n{{< indice >}}\n\n\n\n\n----\n\n\n## Carga de mapas\n\nUna de las fuentes principales de datos geoespaciales son los _shapefiles_. Pero también existen **paquetes de R que contienen información geoespacial**, para mayor conveniencia. Exploraremos ambas opciones a continuación.\n\n\n### Cargar mapas de cualquier país\n\nSi no tenemos o no queremos descargar _shapes_, podemos **cargar mapas de cualquier país directo en R** gracias a [`{rnaturalearth}`](http://ropensci.github.io/rnaturalearth/). Con este paquete obtenemos directamente mapas de cualquier país del mundo, incluyendo sus estados o regiones internos, sin necesidad de descargas.\n\nInstala `{rnaturalearth}` si no lo tienes:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"rnaturalearth\")\n```\n:::\n\n\n\nPuedes insertar el nombre de tu país para seguir con este tutorial usando ejemplos de tu territorio.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\n\npais <- ne_states(\"Argentina\")\n# pais <- ne_states(\"Mexico\")\n# pais <- ne_states(\"Colombia\")\n\nmapa <- pais |> \n  # seleccionar columnas\n  select(pais = admin,\n         region = name_es,\n         geometry)\n\nmapa\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 24 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -73.57274 ymin: -55.05202 xmax: -53.66155 ymax: -21.78694\nGeodetic CRS:  WGS 84\nFirst 10 features:\n          pais     region                       geometry\n1    Argentina Entre Ríos MULTIPOLYGON (((-58.20011 -...\n12   Argentina      Salta MULTIPOLYGON (((-68.49647 -...\n13   Argentina      Jujuy MULTIPOLYGON (((-67.25133 -...\n741  Argentina    Formosa MULTIPOLYGON (((-62.34136 -...\n746  Argentina   Misiones MULTIPOLYGON (((-54.66497 -...\n749  Argentina      Chaco MULTIPOLYGON (((-58.35127 -...\n750  Argentina Corrientes MULTIPOLYGON (((-58.6042 -2...\n1318 Argentina  Catamarca MULTIPOLYGON (((-68.33776 -...\n1320 Argentina   La Rioja MULTIPOLYGON (((-69.65405 -...\n1321 Argentina   San Juan MULTIPOLYGON (((-69.95766 -...\n```\n\n\n:::\n:::\n\n\n\n\n### Cargar _shapes_\n\nUn _shapefile_ es un formato de archivo común para datos geoespaciales, que en realidad consiste en una **carpeta** con archivos relacionados (`.shp`, `.shx`, `.dbf`, entre otros) que juntos representan la geometría y atributos de los objetos geográficos.\n\nTeniendo la carpeta, basta con cargarla con la función `read_sf()`.\n\n\n\n{{< detalles \"**Ejemplo de descarga y carga de un _shapefile_ de Chile**\" >}}\n\n\n\n\nPara aprender, podemos descargar un _shape_ y usarlo para practicar. Si no tienes uno a mano, en el siguiente botón podemos bajar un _shapefile_ de Chile por regiones, que proviene de la [Mapoteca de la Biblioteca del Congreso Nacional](https://www.bcn.cl/siit/mapas_vectoriales).\n\n{{< boton \"Division regional: polígonos de las regiones de Chile\" \"https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip\" \"fas fa-map\">}}\n\nTambién puedes descargarlo directamente desde R con `download.file()` y luego `unzip()`, [como se indica en este post](/blog/mapa_chile_triple/#descargar-mapas).\n\n\nUna vez descargado, descomprimimos el archivo y obtenemos una **carpeta**. Esta carpeta es nuestro _shapefile_, así que la guardamos dentro de nuestro [proyecto de RStudio](/blog/r_introduccion/proyectos/), idealmente dentro de una carpeta donde guardemos nuestros mapas. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# descargar\ndownload.file(\"https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip\",\n              \"Regiones.zip\")\n\n# descomprimir\nunzip(\"Regiones.zip\", exdir = \"shapes/Regiones\")\n```\n:::\n\n\n\nEn el siguiente ejemplo, guardamos el _shapefile_ en una carpeta `shapes`, y lo cargamos con `read_sf()`.\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa <- read_sf(\"shapes/Regiones\") |> \n  janitor::clean_names()\n\nmapa\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 17 features and 7 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: -12183900 ymin: -7554306 xmax: -7393644 ymax: -1978920\nProjected CRS: WGS 84 / Pseudo-Mercator\n# A tibble: 17 × 8\n   objectid cir_sena codregion area_km    st_area_sh st_length region           \n *    <dbl>    <int>     <int>   <dbl>         <dbl>     <dbl> <chr>            \n 1     1084        1        15  16867.  18868687744.   750530. Región de Arica …\n 2     1085        2         1  42285.  48306372203.  1213713. Región de Tarapa…\n 3     1086        3         2 126071. 150845155633   2516112. Región de Antofa…\n 4     1087       15        12 133053. 358131609833  90498304. Región de Magall…\n 5     1088       14        11 106703. 224274263072  41444811. Región de Aysén …\n 6     1089        4         3  75661.  96439063562.  2401741. Región de Atacama\n 7     1090        5         4  40576.  54980818749.  2065933. Región de Coquim…\n 8     1091        6         5  16323.  23014748571.  1679609. Región de Valpar…\n 9     1092        7        13  15392.  22252038246.  1064253. Región Metropoli…\n10     1093       13        10  48408.  87718341940.  7874158. Región de Los La…\n11     1094       12        14  18245.  31086613540.  1844423. Región de Los Rí…\n12     1095       11         9  31838.  52215073344.  1501025. Región de La Ara…\n13     1096       10         8  24022.  38176117509.  2097147. Región del Bío-B…\n14     1097       10        16  13104.  20376298459.  1074094. Región de Ñuble  \n15     1098        9         7  30322.  45969426092.  1388328. Región del Maule \n16     1099        8         6  16349.  24090278437.   984853. Región del Liber…\n17     1100        0         0   3937.   9306245194.   388722. Zona sin demarcar\n# ℹ 1 more variable: geometry <GEOMETRY [m]>\n```\n\n\n:::\n:::\n\n{{< /detalles >}}\n\n\n{{< aviso \"Puedes seguir este tutorial independientemente del mapa que hayas cargado (el _shape_ de Chile, con `rnaturalearth`, u otro _shape_ que tú elijas); lo importante es que cargues un objeto `mapa` que tenga columna `geometry` y `region`.\" >}}\n\n\n\n\n<!--\n### Cargar geoJSON\n\n\n### Cargar KMZ\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunzip(\"~/Downloads/Mis lugares.kmz\", exdir = \"~/Downloads/Mis lugares\")\n\nsf::read_sf(\"~/Downloads/Mis lugares/doc.kml\")\n```\n:::\n\n\n\n-->\n\n----\n\nComo vemos, una vez que cargamos los datos geoespaciales obtenemos una **tabla con características especiales**. Arriba de la tabla vemos una descripción de las características del mapa, el tipo de geometrías, la caja o _bounding box_ que enmarca los polígonos, y el sistema de referencia de coordenadas del mapa.\n\nEn `{sf}` los datos geoespaciales además contienen una columna `geometry`, que contiene las geometrías (puntos, líneas o polígonos) que definen la forma y ubicación de los elementos geográficos. Vamos a trabajar con esta columna si queremos **modificar la geometría** de los elementos geoespaciales o calcular algo a partir de ellos. **Cada fila de la tabla representa un objeto geográfico** (una región, comuna, país, etc.) y las demás columnas son variables relacionadas al objeto geográfico (población, superficie, nombre, etc.)\n\n\n<!--\n## Glosario\n\n- **Simple features**: estándar para representar datos geoespaciales en forma de tablas con una columna especial de geometría.\n- **Shapefile**: formato de archivo común para datos geoespaciales, que en realidad consiste en varios archivos relacionados.\n- **Polígono**: forma geométrica que representa áreas en un mapa.\n\n-->\n\n----\n\n\n## Visualización básica de mapas\n\nPara visualizar un mapa con `{sf}` usamos la geometría `geom_sf()` dentro de un gráfico de `{ggplot2}`. Esta función reconoce automáticamente la columna `geometry` del objeto espacial, y dibuja las formas geográficas correspondientes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa |> \n  ggplot() +\n  geom_sf(fill = \"#9069C0\", \n          color = \"#EBD2FA\",\n          linewidth = 0.1)\n```\n\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/mapa_basico-1.png){width=768}\n:::\n:::\n\n{{< aviso \"Si necesitas aprender lo básico de `{ggplot2}` para visualización de datos, [revisa este completo tutorial](/blog/r_introduccion/tutorial_visualizacion_ggplot/).\" >}}\n\n\n\n\n\n----\n\n## Operaciones sobre geometrías\n\nLas operaciones sobre geometrías permiten manipular y analizar las formas y ubicaciones de los objetos geográficos. A continuación veremos algunas operaciones comunes que se pueden realizar con el paquete `{sf}` en R.\n\n### Calcular centroide\n\nEl centroide es el punto central de un polígono. Calcularlo sirve, por ejemplo, para ubicar una etiqueta de texto sobre un polígono, poner un punto sobre un territorio que crece con respecto a una variable, etc.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_centroide <- mapa |> \n  select(region, geometry) |> \n  mutate(centroide = st_centroid(geometry))\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                  region                   centroide\n1             Entre Ríos POINT (-59.20493 -32.03189)\n12                 Salta POINT (-64.80661 -24.28824)\n13                 Jujuy POINT (-65.77985 -23.31783)\n741              Formosa POINT (-59.94839 -24.89604)\n746             Misiones POINT (-54.65212 -26.86956)\n749                Chaco POINT (-60.77109 -26.39039)\n750           Corrientes POINT (-57.79471 -28.76018)\n1318           Catamarca  POINT (-66.99006 -27.3092)\n1320            La Rioja POINT (-67.21371 -29.66235)\n1321            San Juan POINT (-68.88199 -30.82274)\n1323             Mendoza POINT (-68.60826 -34.58944)\n1328             Neuquén POINT (-70.11374 -38.62865)\n1333              Chubut POINT (-68.51499 -43.78523)\n1335           Río Negro POINT (-67.21765 -40.40738)\n1337          Santa Cruz  POINT (-69.8981 -48.76187)\n1339    Tierra del Fuego  POINT (-67.4401 -54.32625)\n1726        Buenos Aires POINT (-60.54573 -36.66279)\n1746        Buenos Aires POINT (-58.45093 -34.64272)\n3852            Santa Fe POINT (-60.93513 -30.66904)\n3853             Tucumán  POINT (-65.36557 -26.9491)\n3854 Santiago del Estero  POINT (-63.2909 -27.71835)\n3855            San Luis POINT (-66.03363 -33.74238)\n3856            La Pampa POINT (-65.44562 -37.12691)\n3857             Córdoba POINT (-63.76859 -32.07319)\n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/mapa_centroide-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_centroide |> \n  filter(region == mapa$region[3]) |> \n  ggplot() +\n  geom_sf(fill = \"#9069C0\", \n          linewidth = NA) +\n  geom_sf(\n    aes(geometry = centroide),\n    size = 3, alpha = .6) +\n  geom_sf_text(\n    aes(geometry = centroide),\n    label = \"centroide\", size = 3,\n    vjust = 2)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n----\n\n### Extraer longitud y latitud\nPara obtener las coordenadas (longitud y latitud) de un elemento espacial, necesitamos primero que sea un punto, porque un polígono es una figura compleja que no tiene solamente una latitud y una longitud. Si tenemos un polígono, [primero calculamos el centroide](#calcular-centroide), y luego extraemos las coordenadas con `st_coordinates()`. Como esta función retorna la longitud y latitud de cada punto al mismo tiempo, tenemos que pedirle que entregue la una o la otra usando corchetes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_centroide_coordenadas <- mapa_centroide |> \n  mutate(lon = st_coordinates(centroide)[,1],\n         lat = st_coordinates(centroide)[,2])\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                  region       lon       lat\n1             Entre Ríos -59.20493 -32.03189\n12                 Salta -64.80661 -24.28824\n13                 Jujuy -65.77985 -23.31783\n741              Formosa -59.94839 -24.89604\n746             Misiones -54.65212 -26.86956\n749                Chaco -60.77109 -26.39039\n750           Corrientes -57.79471 -28.76018\n1318           Catamarca -66.99006 -27.30920\n1320            La Rioja -67.21371 -29.66235\n1321            San Juan -68.88199 -30.82274\n1323             Mendoza -68.60826 -34.58944\n1328             Neuquén -70.11374 -38.62865\n1333              Chubut -68.51499 -43.78523\n1335           Río Negro -67.21765 -40.40738\n1337          Santa Cruz -69.89810 -48.76187\n1339    Tierra del Fuego -67.44010 -54.32625\n1726        Buenos Aires -60.54573 -36.66279\n1746        Buenos Aires -58.45093 -34.64272\n3852            Santa Fe -60.93513 -30.66904\n3853             Tucumán -65.36557 -26.94910\n3854 Santiago del Estero -63.29090 -27.71835\n3855            San Luis -66.03363 -33.74238\n3856            La Pampa -65.44562 -37.12691\n3857             Córdoba -63.76859 -32.07319\n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/barras_latitud-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_centroide_coordenadas |> \n  distinct(region, .keep_all = TRUE) |> \n  mutate(region = forcats::fct_reorder(region, lat)) |> # ordenar regiones\n  ggplot() +\n  aes(lat, region) +\n  geom_col(width = 0.7, \n           fill = \"#9069C0\") +\n  geom_text(aes(label = region),\n            size = 3, hjust = -0.05, color = \"#EAD2FA\") +\n  scale_y_discrete(labels = NULL) +\n  labs(y = NULL, x = \"Latitud\")\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n----\n\n\n### Calcular buffer\nUn _buffer_ es una zona alrededor de un objeto geográfico, definida por una distancia específica. Calcular un _buffer_ es útil para analizar áreas de influencia, proximidad a ciertos puntos o regiones, o para hacer modificiones sobre mapas con fines de visualización.\n\nCon la función `st_buffer()` definimos el espacio en torno a un polígono, especificando en el argumento `dist` la **distancia** del _buffer_ en las unidades del sistema de coordenadas del mapa (por ejemplo, metros si el mapa está en UTM), y con `max_cells` podemos controlar la calidad del polígono resultante.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_buffer <- mapa |> \n  # filtrar una región/polígono\n  filter(region == mapa$region[3]) |> \n  # crear buffer\n  mutate(buffer = st_buffer(geometry, \n                            dist = 20000,\n                            max_cells = 10000))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/mapa_buffer-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_buffer |> \n  ggplot() +\n  # capa de la región\n  geom_sf(aes(geometry = geometry), \n          fill = \"#9069C0\", linewidth = NA) +\n  # capa del buffer\n  geom_sf(aes(geometry = buffer), \n          fill = \"#9069C0\", alpha = 0.5, linewidth = NA)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n----\n\n### Calcular caja de un polígono\n\nCon la función `st_bbox()` obtenemos las coordenadas de la caja que envuelve a un polígono o conjunto de polígonos. Esta caja está definida por las coordenadas mínimas y máximas en los ejes _x_ (longitud) e _y_ (latitud).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncaja <- st_bbox(mapa)\n\ncaja\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     xmin      ymin      xmax      ymax \n-73.57274 -55.05202 -53.66155 -21.78694 \n```\n\n\n:::\n:::\n\n\n\n\n\n#### Convertir caja a polígono\n\nTeniendo una caja con sus coordenadas, podemos convertirla a un polígono para aplicarlo sobre (o debajo de) un mapa.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrectangulo <- caja |> \n  st_as_sfc(crs = st_crs(mapa))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-18-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#EBD2FB\",\n          linewidth = 0.1) +\n  # capa con la caja encima\n  geom_sf(data = rectangulo,\n          fill = \"#9069C0\", color = \"#9069C0\", \n          linewidth = 0.8, alpha = 0.4) +\n  # tema\n  theme(axis.text = element_blank(),\n        panel.background = element_blank())\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n----\n\n\n### Poner un punto en un mapa\n\nSi queremos poner puntos en posiciones específicas de un mapa, sólo necesitamos crear una tabla con las coordenadas de los puntos y convertir la tabla a `sf` con `st_as_sf()`. Al hacer esto, es necesario especificar el sistema de referencia de coordenadas (CRS) del mapa, para que los puntos se ubiquen correctamente. Hacemos esto extrayendo el CRS del mapa con `st_crs()` y aplicándolo a nuestra nueva tabla `sf`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# definir coordenadas\ncoordenadas <- tibble(longitud = -70, \n                      latitud = -38)\n\n# convertir tabla a sf\npunto <- coordenadas |> \n  st_as_sf(coords = c(\"longitud\", \"latitud\"), \n           crs = st_crs(mapa))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-21-1.png){width=768}\n:::\n:::\n\n\n\n{{< detalles \"Ver código del gráfico\">}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#EBD2FB\",\n          linewidth = 0.1) +\n  # capa con el punto\n  geom_sf(data = punto,\n          size = 3, alpha = .5)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n\n#### Poner varios puntos en un mapa\n\nSi necesitamos agregar más de un punto, simplemente hacemos una tabla con todos los que necesitemos. Obviamente también podemos especificar otras columnas que podemos usar para etiquetar los puntos, especificar sus colores, y más.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoordenadas <- tribble(~nombre, ~lon, ~lat, ~n,\n                       \"A\",  -69,  -38,  4,\n                       \"B\",  -65,  -37,  6,\n                       \"C\",  -61,  -36,  9)\n\npuntos <- coordenadas |> \n  # convertir tabla a sf\n  st_as_sf(coords = c(\"lon\", \"lat\"), \n           crs = st_crs(mapa))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-24-1.png){width=768}\n:::\n:::\n\n\n{{< detalles \"Ver código del gráfico\">}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#EBD2FB\",\n          linewidth = 0.1) +\n  # capa con puntos\n  geom_sf(data = puntos,\n          aes(size = n),\n          alpha = .5) +\n  # capa con textos\n  geom_sf_label(data = puntos,\n                aes(label = nombre),\n                size = 3, vjust = -0.8,\n                fontface = \"bold\") +\n  # escala de tamaño\n  scale_size(range = c(3, 6),\n             breaks = scales::breaks_pretty(n = 3)) +\n  guides(size = guide_legend(override.aes = list(color = \"#9069C0\", \n                                                 alpha = 1)))\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n----\n\n\n### Crear un cuadrado\n\nPara poner un cuadrado encima de una ubicación del mapa, primero creamos un punto, luego lo [expandimos con un _buffer_](#calcular-buffer), calculamos [la caja que envuelve a dicho punto](#calcular-caja-de-un-polígono), y finalmente convertimos la caja en un polígono `sf`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoordenadas <- tibble(longitud = -58, latitud = -38)\n\npunto <- coordenadas |> \n  # convertir tabla a sf\n  st_as_sf(coords = c(\"longitud\", \"latitud\"), \n           crs = st_crs(mapa))\n\ncuadrado <- punto |> \n  st_buffer(dist = 100000) |> # agrandar punto\n  st_bbox() |> # crear caja al rededor\n  st_as_sfc(crs = st_crs(mapa)) # convertir a sf\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-27-1.png){width=768}\n:::\n:::\n\n\n\n{{< detalles \"Ver código del gráfico\">}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#EBD2FB\",\n          linewidth = 0.1, alpha = .7) +\n  # capa con puntos\n  geom_sf(data = cuadrado,\n          fill = NA,\n          linewidth = 0.8, \n          linejoin = \"mitre\", #linejoin = \"round\",\n          color = \"#402E5A\") +\n  coord_sf(xlim = c(-72, -56),\n           ylim = c(-40, -30))\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\nPaso a paso, el proceso de crear el punto, agrandarlo, y formarlo en un cuadrado se vería así:\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-29-1.png){width=768}\n:::\n:::\n\n\n\n{{< detalles \"Ver código del proceso y del gráfico\">}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npunto_grande <- punto |> \n  st_buffer(dist = 100000, max_cells = 10000)\n\ncuadrado <- punto_grande |> \n  st_bbox(crs = st_crs(mapa)) |> \n  st_as_sfc() |> \n  st_as_sf(crs = st_crs(mapa))\n\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#EBD2FB\",\n          linewidth = 0.1) +\n  # capas \n  geom_sf(data = punto, \n          color = \"#402E5A\", size = 3) +\n  geom_sf(data = punto_grande,\n          fill = NA, color = \"#402E5A\", lwd = 0.7) +\n  geom_sf(data = cuadrado,\n          fill = NA, color = \"#402E5A\", lwd = 0.7) +\n  # acercar mapa\n  coord_sf(xlim = c(-61, -55),\n           ylim = c(-40, -35.7))\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n#### Crear un rectángulo a partir de puntos\nSi tenemos varios puntos y necesitamos crear un rectángulo que los contenga a todos, podemos repetir lo anterior pero partiendo de varios puntos a la vez.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# tabla con coordenadas\ncoordenadas <- tribble(~nombre, ~lon, ~lat, ~n,\n                       \"A\",  -69,  -38,  4,\n                       \"B\",  -65,  -37,  6,\n                       \"C\",  -61,  -36,  9)\n\n# convertir coordenadas a puntos\npuntos <- coordenadas |> \n  # convertir tabla a sf\n  st_as_sf(coords = c(\"lon\", \"lat\"), \n           crs = st_crs(mapa))\n\n# convertir puntos a rectándulo\nrectangulo <- puntos |> \n  st_buffer(dist = 80000) |> # ampliar\n  st_bbox() |> \n  st_as_sfc(crs = st_crs(mapa))\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-32-1.png){width=768}\n:::\n:::\n\n\n{{< detalles \"Ver código del gráfico\">}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#EBD2FB\",\n          linewidth = 0.2, alpha = .7) +\n  # capa con puntos\n  geom_sf(data = puntos,\n          alpha = .5) +\n  geom_sf(data = rectangulo,\n          fill = NA, color = \"#402E5A\", lwd = 0.7)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n----\n\n### Crear un polígono a partir de coordenadas\n\nTeniendo una tabla con un conjunto de coordenadas, podemos unirlas para formar un polígono. Es decir, **unir los puntos** para conformar una figura geométrica cerrada. Para ello, usamos `st_combine()` para combinar las coordenadas en un solo elemento, y luego `st_cast()` para convertir esos puntos combinados en un polígono.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoordenadas <- tribble(~nombre, ~lon, ~lat,\n                           \"A\", -68,  -36,\n                           \"B\", -64,  -31,\n                           \"C\", -60,  -36)\n\n# convertir tabla a sf\npuntos <- coordenadas |> \n  st_as_sf(coords = c(\"lon\", \"lat\"), \n           crs = st_crs(mapa))\n\npoligono <- puntos |> \n  # combinar coordenadas en un solo elemento\n  summarise(geometry = st_combine(geometry)) |> \n  # convertir puntos a polígono\n  st_cast(\"POLYGON\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/poligonos_1-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#E0C7F0\",\n          linewidth = 0.2, alpha = 0.7) +\n  # capa con puntos\n  geom_sf(data = puntos,\n          alpha = .6) +\n  # capa con polígono\n  geom_sf(data = poligono,\n          fill = \"#402E5A\", color = \"#402E5A\",\n          lwd = 0.7, alpha = 0.7)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n\n#### Crear varios polígonos a partir de coordenadas\n\nPodemos realizar el mismo proceso anterior, pero agrupando los datos con `group_by()` para crear varios polígonos a la vez, de acuerdo a la variable de agrupación (en este caso, `tipo`). Entonces, cuando usemos `st_combine()`, se combinarán las coordenadas de cada grupo por separado, y luego `st_cast()` convertirá cada grupo de puntos combinados en un polígono distinto.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoordenadas <- tribble(~tipo,    ~lon, ~lat,\n                       \"Triángulo\", -68,  -30,\n                       \"Triángulo\", -64,  -25,\n                       \"Triángulo\", -60,  -30,\n                        \"Cuadrado\", -68,  -38,\n                        \"Cuadrado\", -60,  -38,\n                        \"Cuadrado\", -60,  -32,\n                        \"Cuadrado\", -68,  -32)\n\n# convertir tabla a sf\npuntos <- coordenadas |> \n  st_as_sf(coords = c(\"lon\", \"lat\"), \n           crs = st_crs(mapa))\n\npoligono <- puntos |> \n  # combinar coordenadas en elementos únicos agrupados por una variable\n  group_by(tipo) |> \n  summarise(geometry = st_combine(geometry)) |> \n  # convertir puntos a polígono\n  st_cast(\"POLYGON\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/poligonos_2-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  # mapa de fondo\n  geom_sf(data = mapa,\n          fill = \"#9069C0\", color = \"#E0C7F0\",\n          linewidth = 0.2, alpha = 0.7) +\n  # capa con polígonos de color\n  geom_sf(data = poligono,\n          aes(fill = tipo, color = tipo),\n          lwd = 0.6, alpha = .7) +\n  # capa con puntos\n  geom_sf(data = puntos,\n          alpha = .4) +\n  # escala de colores\n  labs(fill = \"Tipo\", color = \"Tipo\") +\n  theme(legend.key.spacing.y = unit(1, \"mm\"))\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n----\n\n\n### Recortar un mapa\n\nPara enfocar un mapa en una zona específica y eliminar el resto de los polígonos, usamos la función `st_crop()`, definiendo los límites del recorte con las coordenadas mínimas y máximas en los ejes _x_ (longitud) e _y_ (latitud).\n\nPrimero obtengamos un mapa de Chile desde `{rnaturalearth}`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rnaturalearth)\n\nchile <- ne_countries(country = \"Chile\", scale = 10) |> \n  select(pais = admin,\n         region = name_es,\n         geometry)\n```\n:::\n\n\n\nAhora lo recortamos con `st_crop()`. Recomiendo hacerlo terminando el recorte con una visualización del mapa, para ver inmediatamente el resultado y así poder ir ajustando el recorte:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchile_recortado <- chile |> \n  st_crop(xmin = -78, ymax = -17,\n          xmax = -65, ymin = -56) \n```\n:::\n\n\n\nEn este caso, hacemos un recorte para obtener el territorio continental de Chile (excluyendo las islas Juan Fernández, Isla de Pascua y Antártica)\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-40-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_completo <- chile |> \n  ggplot() +\n  geom_sf(fill = \"#9069C0\", linewidth = 0)\n\nmapa_recortado <- chile_recortado |> \n  ggplot() +\n  geom_sf(fill = \"#9069C0\", linewidth = 0)\n\n# poner los dos mapas lado a lado\nlibrary(patchwork)\n\nmapa_completo + mapa_recortado\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\nTambién podemos hacer recortes que pasen por encima de los polígonos, eliminando la geografía que quede fuera del recorte. En este caso hacemos un recorte más cercano a la zona costera de Temuco y Valdivia:\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-42-1.png){width=768}\n:::\n:::\n\n\n\n\n----\n\n### Mover puntos de un mapa\nCuando ya contamos con tabla con datos geoespaciales en puntos, a veces es necesario mover la posición de los puntos en un mapa, por ejemplo, para evitar que se sobrepongan etiquetas, para ajustar una coordenada incorrecta, o para mejorar la visualización. \n\nLos puntos pueden moverse al **modificar las coordenadas de la geometría**. En el caso de los puntos se las coordenadas son un vector de dos elementos (longitud y latitud), por lo que podemos sumar o restarle a la columna `geometry` para modificar la posición de cada punto.\n\nCreemos una tabla con latitudes y longitudes, y convirtámosla a `sf` con `st_as_sf()`, [como vimos antes](#poner-un-punto-en-un-mapa):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npuntos <- tribble(~nombre, ~lon,     ~lat,\n                \"Hualqui\", -8113368, -4434476,\n                \"Coronel\", -8136065, -4440419,\n             \"Concepción\", -8132714, -4414370,\n                   \"Lota\", -8139383, -4451456,\n                  \"Penco\", -8119934, -4402016,\n             \"Talcahuano\", -8139277, -4399701) |> \n  # convertir a tabla sf\n  st_as_sf(coords = c(\"lon\", \"lat\"), \n           crs = 3395)\n```\n:::\n\n\n\nAsí se ven los puntitos por sí solos: \n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-44-1.png){width=768}\n:::\n:::\n\n\n\nAhora recortemos el mapa de Chile para enfocarnos en la zona donde están los puntos. [Creamos un _buffer_](#calcular-buffer) alrededor de los puntos para agrandarlos con `st_buffer()`, y luego [calculamos la caja que los contiene](#calcular-caja-de-un-polígono) con `st_bbox()` para usarla como recorte.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncaja_puntos <- puntos|> \n  st_buffer(50000) |> # agrandar puntos\n  st_bbox() # calcular caja que contiene a los puntos\n```\n:::\n\n\n\nAhora que tenemos la caja, la usamos dentro de `st_crop()` para recortar el mapa, pero ojo, que ambas capas tienen que tener el mismo sistema de referencias de coordenadas (CRS), así que primero transformamos el mapa de Chile con `st_transform()` para que use el mismo sistema que la capa de puntos.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchile_recorte <- chile |> \n  # ajustar crs para que coincidan\n  st_transform(crs = st_crs(puntos)) |>\n  # recortar con la caja (bounding box)\n  st_crop(caja_puntos)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-47-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = chile_recorte,\n          fill = \"#9069C0\", color = \"#E0C7F0\", alpha = 0.5) +\n  geom_sf(data = puntos,\n          color = \"#402E5A\", size = 3, alpha = 0.7) +\n  geom_sf_text(data = puntos, \n               aes(label = paste(\"  \", nombre)),\n               color = \"#402E5A\", size = 3, hjust = 0, angle = -35)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\nImaginemos que queremos mover o modificar puntos específicos del mapa. Igual como haríamos con una tabla de datos, usamos `mutate()` para modificar la columna `geometry`, que contiene las coordenadas de cada punto, y le aplicamos una función para modificar sus valores condicionalmente, como `case_when()`. Así podemos modificar los puntos dependiendo de si coinciden con criterios basados en datos, en vez de hacerlo a mano.\n\nPara este ejemplo, modificaremos puntos a partir de su valor en la variable `nombre`. Simplemente sumamos a las coordenadas de los puntos que queremos mover, recordando que como es un vector de dos elementos, sumamos un vector de dos elementos. Para moverlos horizontalmente (hacia el este), sumamos a la primera posición del vector (longitud, `c(7000, 0)`) y dejamos la segunda posición (latitud) en cero.\n\nEl problema es que, al hacer esto, convertimos las coordenadas en meros números, por lo que pierden atributos geométricos, lo que causa problemas. Para resolverlo, le sacamos también los atributos geométricos a los demás puntos que no se mueven (con `st_set_crs(NA)`), y después luego le reasignamos el sistema de coordenadas (CRS) original a toda la tabla con `st_set_crs()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npuntos_movidos <- puntos |> \n  # modificar puntos condicionalmente\n  mutate(geometry = case_when(nombre == \"Hualqui\" ~ geometry + c(7000, 0),\n                              nombre ==  \"Penco\" ~ geometry + c(7000, 0),\n                              .default = st_sfc(geometry) |> st_set_crs(NA))\n         ) |> \n  st_set_crs(st_crs(puntos))\n```\n:::\n\n{{< detalles \"Otra alternativa sería...\" >}}\n\n\n\n\nOtra alternativa al problema de perder las coordenadas al modificar los puntos es hacer lo contrario: volver a agregar las coordenadas a cada observación que se modifique agregándoles `st_set_crs(st_crs(mapa))`, y dejando las demás observaciones sin cambios.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npuntos |> \n  mutate(geometry = case_match(nombre,\n                               \"Hualqui\" ~ st_sfc(geometry + c(7000, 0)) |> st_set_crs(st_crs(puntos)),\n                               \"Tomé\" ~ st_sfc(geometry + c(7000, 0)) |> st_set_crs(st_crs(puntos)),\n                               .default = geometry)\n  )\n```\n:::\n\n\n\nPersonalmente encuentro que la primera forma es más legible.\n\n{{< /detalles>}}\n\nLo que sumemos o restemos a las coordenadas depende del sistema de coordenadas de cada mapa. En algunos va a haber que sumar números muy pequeños, pero en otros sistemas de coordenadas se usan números muy grandes.\n\nEn el gráfico vemos en color más tenue las posiciones originales de los puntos que fueron modificados.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-51-1.png){width=768}\n:::\n:::\n\n{{< detalles \"Ver código del gráfico\" >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = chile_recorte,\n          fill = \"#9069C0\", color = \"#E0C7F0\", alpha = 0.5) +\n  geom_sf(data = puntos,\n          color = \"#402E5A\", size = 3, alpha = 0.2) +\n  geom_sf(data = puntos_movidos,\n          color = \"#402E5A\", size = 3, alpha = 0.7) +\n    geom_sf_text(data = puntos_movidos, \n               aes(label = paste(\"  \", nombre)),\n               color = \"#402E5A\", size = 3, hjust = 0, angle = -35)\n```\n:::\n\n{{< /detalles >}}\n\n\n\n\n----\n\n<!--\nDesde el centroide de un polígono\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa |> \nfilter(region == \"Región de Antofagasta\") |>\nst_centroid() |> \nst_buffer(dist = 8000) |> \nst_bbox() |> \nst_as_sfc() |>\nst_as_sf()\n```\n:::\n\n\n-->\n\n<!--\n### Calcular superficie o área\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa_region_comunas_areas |> \nst_union() |> \nst_area() |> \nunits::set_units(\"km^2\")\n```\n:::\n\n\n\n\n\n### Recortar polígono a coordenadas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crop(xmin = -74, ymin = -36, xmax = -65, ymax = -30) |> \n```\n:::\n\n\n\n\n### Simplificar un polígono\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhttps://bookdown.org/robinlovelace/geocompr/geometric-operations.html#simplification\nst_simplify(dTolerance = 0.01)\n\nrmapshaper::ms_simplify(geometry, keep = 0.8)) \n```\n:::\n\n\n\n\n### Extraer líneas internas de un polígono\n\n\n::: {.cell}\n\n```{.r .cell-code}\nms_innerlines() # deja solo las líneas interiores de un coso\n```\n:::\n\n\n\n\n## Correcciones\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_as_sf()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nst_make_valid()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nst_drop_geometry() \n```\n:::\n\n\n\n\n----\n\n\n## Operaciones agrupadas\n\n### Unir polígonos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngroup_by() |> \nst_union()\n```\n:::\n\n\n\n\n## Operaciones entre geometrías\n\n### Recortar un polígono con otro\nhttps://bookdown.org/robinlovelace/geocompr/geometric-operations.html#clipping\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_intersection()\n```\n:::\n\n\n\n### Usar un polígono para eliminar partes de otro\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_difference()\n```\n:::\n\n\n\n\n### unir dos polígonos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_union()\n```\n:::\n\n\n\n### Spatial join\n\n### Filter\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhttps://cengel.github.io/R-spatial/spatialops.html#topological-subsetting-select-polygons-by-location\n```\n:::\n\n\n\n\n\n## Coordenadas\n\n### Extraer sistema de coordenadas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(comunas_region)\n```\n:::\n\n\n\n### Cambiar coordenadas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_transform(crs = st_crs(comunas_region))\n```\n:::\n\n\n\n\n## Visualización\n\n### Visualizar por capas\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngeom_sf()\n```\n:::\n\n\n\n\n### Texto\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngeom_sf_text(data = nombres_areas |> filter(clase_topo == \"Comuna\"), color = \"red\", fontface = \"bold\",\naes(label = nombre)) + \n```\n:::\n\n\n\n### Texto con repel\nhttps://github.com/slowkow/ggrepel/issues/111#issuecomment-416853013\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggrepel::geom_label_repel(data = comunas_region_conteo_urbanas,\naes(label = comuna, geometry = geometry),\nstat = \"sf_coordinates\",\nsize = 2, box.padding = 0,\nmin.segment.length = unit(3, \"mm\"),\nlabel.padding = 0.15, label.size = 0\n) +\n```\n:::\n\n\n\n\n### Hacer zoom\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#   coord_sf(xlim = c(-70.4, -70.2),\n#            ylim = c(-18.7, -18.4),\n```\n:::\n\n\n\n### Dibujar un cuadrado\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#   annotate(\"rect\", fill = NA, color = \"black\", linewidth = 1,\n#            xmin = bbox_area_met[1]-2000, xmax = bbox_area_met[2]+2000,\n#            ymin = bbox_area_met[3]+2000, ymax = bbox_area_met[4]-2000)+\n```\n:::\n\n\n\n### Escala de colores para mapa de calor\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscale_fill_gradient2(\nlow = color$bajo, mid = color$medio, high = color$alto,\nmidpoint = mean(comunas_region_conteo$n),\nna.value = col_mix(color$fondo, color$principal, 0.1),\nlimits = c(0, NA)\n# breaks = cortes\n)\n```\n:::\n\n\n\n\n### Minimapa\nhttps://dominicroye.github.io/blog/inserted-map/\n\n\n::: {.cell}\n\n:::\n\n\n\n-->\n\n\n\n{{< aviso \"⚠️ Este tutorial se encuentra en construcción ⚠️\" >}}\n\n\n\n\n----\n\n\n## Recursos para aprender más\n\n### Apuntes\n<div style=\"display: flex; margin:auto;\">\n\n\n{{< imagen \"sf_cheatsheet_1.jpeg\" >}}\n\n\n{{< imagen \"sf_cheatsheet_2.jpeg\" >}}\n\n\n\n</div>\n\n\n### Libros\n\n- [Drawing beautiful maps programmatically with R, sf and ggplot2](https://r-spatial.org/r/2018/10/25/ggplot2-sf.html)\n- [Geocomputation with R](https://bookdown.org/robinlovelace/geocompr/)\n- [Spatial Data Science With Applications in R](https://r-spatial.org/book/)\n- [Using Spatial Data with R](https://cengel.github.io/R-spatial/)",
    "supporting": [
      "mapas_sf.markdown_strict_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}