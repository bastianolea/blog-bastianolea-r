<!DOCTYPE html>
<html lang="es-ES" dir="ltr"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=5219&amp;path=livereload" data-no-instant defer></script>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.152.2">
<title>Mapas y visualización de datos geoespaciales en R con {sf} | Bastián Olea</title>


<meta property="twitter:site" content="@bastimapache">
<meta property="twitter:creator" content="@bastimapache">







  
    
  
<meta name="description" content="R cuenta con un muy amplio ecosistema para trabajar con datos geoespaciales. Uno de los paquetes más importantes es `{sf}`, que permite manipular datos espaciales a partir del estándar _simple features_ (características simples). En esta guía iré recopilando los comandos básicos para manipular y visualizar datos geoespaciales en R. En la medida que voy aprendiendo más sobre hacer mapas, iré actualizando y complementando.">


<meta property="og:site_name" content="Bastián Olea">
<meta property="og:title" content="Mapas y visualización de datos geoespaciales en R con {sf} | Bastián Olea">
<meta property="og:description" content="R cuenta con un muy amplio ecosistema para trabajar con datos geoespaciales. Uno de los paquetes más importantes es `{sf}`, que permite manipular datos espaciales a partir del estándar _simple features_ (características simples). En esta guía iré recopilando los comandos básicos para manipular y visualizar datos geoespaciales en R. En la medida que voy aprendiendo más sobre hacer mapas, iré actualizando y complementando." />
<meta property="og:type" content="page" />
<meta property="og:url" content="http://localhost:5219/blog/mapas_sf/" />
<meta property="og:locale" content="es-ES">




    
        <meta property="og:image" content="http://localhost:5219/blog/mapas_sf/mapa_rm_featured.png" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="http://localhost:5219/blog/mapas_sf/mapa_rm_featured.png" >
    
    
  
  <meta itemprop="name" content="Mapas y visualización de datos geoespaciales en R con {sf}">
  <meta itemprop="description" content="⚠️ Este tutorial se encuentra en construcción! ⚠️ R cuenta con un muy amplio ecosistema de paquetes para datos geoespaciales. Uno de los paquetes más importantes es {sf}, que permite manipular datos espaciales a partir del estándar simple features (características simples), ampliamente utilizado en sistemas de información geográfica (SIG/GIS).">
  <meta itemprop="datePublished" content="2025-11-18T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-11-18T00:00:00+00:00">
  <meta itemprop="wordCount" content="3974">
  <meta itemprop="image" content="http://localhost:5219/blog/mapas_sf/mapa_rm_featured.png">
  <meta itemprop="keywords" content="Mapas,Visualización de datos">
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="false" type="image/x-icon">
  <link rel="icon" href="false" type="image/x-icon">
  
  
  <link rel="stylesheet" href="../../style.main.min.8f721815d150079638fe25bf9714e71c67b8ddf7e9435d32764c3175c3e06556.css" integrity="sha256-j3IYFdFQB5Y4/iW/lxTnHGe43ffpQ10ydkwxdcPgZVY=" media="screen">
  
  
  <script src="../../panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="../../main.min.858230d8d39b17ec435a8cd8991902766cb7afe0621875ffe5fcdf376474ca6e.js" type="text/javascript"></script>
  
  <link rel="stylesheet" href="../../css/syntax.css">
</head>
<body>
      <div class="grid-container single-sidebar">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="http://localhost:5219/" title="Home">
      <img src="../../img/logo.png" class="dib db-l h2 w-auto" alt="Bastián Olea">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="../../blog/" title="Bastián Olea: Blog de R">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea.github.io/aprende_r/" title="Aprende R">Aprende R</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea.github.io/shiny_apps/" title="Apps">Apps</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea.github.io/datos_sociales/" title="Datos">Datos</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea-buscador.share.connect.posit.cloud" title="Buscador">Buscar</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../clases/" title="Clases">Clases</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../categories/tutoriales/" title="Tutoriales">Tutoriales</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../blog/r_introduccion/recursos_r/" title="Recursos">Enlaces</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../about/" title="Bastián Olea: Sobre mi">Yo</a>
      
      
      
      <div class="dib v-mid", style = "padding: 4px; margin-top: 4px;">
        <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bastianolea-buscador.share.connect.posit.cloud" title="search" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-search fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/bastianolea" title="github" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://x.com/bastimapache" title="twitter" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/bastianolea/" title="linkedin" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-linkedin fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.tiktok.com/@bastimapache" title="tiktok" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-tiktok fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/raccunnie" title="instagram" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.goodreads.com/user/show/53224910-basti-n-olea-herrera" title="goodreads" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-goodreads fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.last.fm/user/bastimapache" title="lastfm" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-lastfm fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bsky.app/profile/bastianolea.rbind.io" title="bluesky" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-bluesky fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="../../contacto/" title="envelope" 
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-envelope fa-lg fa-fw"></i>
    </a>
  
</div>

      </div>
      
    </div>
  </nav>
</header>


                       
 

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 pr3-l">
      <header class="post-header" style="margin-top:-30px;">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">Mapas y visualización de datos geoespaciales en R con {sf}</h1>
        
        
        
        <div style = "display: inline-block;">  
          <p class="f7 db mv0 ttu" style = "display: inline-block;">
            18/11/2025</p>
          
          
          <span>
            




<span style="font-size: 79%; opacity: 100%; margin-left: 6px;">
<span id="149c7f70a2ab632f152c704b2572212e" title="visitas">
</span>
<script>
    var r = new XMLHttpRequest();
    r.addEventListener('load', function() {
        document.getElementById('149c7f70a2ab632f152c704b2572212e').innerText = JSON.parse(this.responseText).count_unique + ' ' + 'visitas'
    })
    r.open('GET', "https://bastimapache.goatcounter.com/counter/" + encodeURIComponent("/blog/mapas_sf/".replace(/(\/)?$/, '')) + '.json')
    r.send()
</script>
</span>

          </span>
        </div>
          
        
        
        
        <dl class="f6 lh-copy">
          <em><dd class="fw5 ml0"> <a href="http://localhost:5219/tags/mapas"
          style="margin-right: 2px; 
                       color: #EAD2FA; 
                       font-style: normal;
                       text-decoration: none;
                       font-size: 10pt;
                       background-color: #9069C0; 
                       border-radius: 3px; 
                       padding: 2px 6px; ">
            mapas</a>  <a href="http://localhost:5219/tags/visualizaci%C3%B3n-de-datos"
          style="margin-right: 2px; 
                       color: #EAD2FA; 
                       font-style: normal;
                       text-decoration: none;
                       font-size: 10pt;
                       background-color: #9069C0; 
                       border-radius: 3px; 
                       padding: 2px 6px; ">
            visualización de datos</a> </dd></em>
        </dl>
         
      
        
      
      <div class="ph0 pt3">
        

<div style="margin-top:-24px;">

    
    
    
      
    
    
    
    
    
      
      
    
  <a class="btn-links mr2 ba dib" 
  style = "background-color: #9069C0; border-radius: 4px; 
  color: #EAD2FA; font-size: 10pt;
  padding-top: 9px; padding-bottom: 6px; padding-left: 9px; padding-right: 10px; 
  margin-right: 1px; margin-top: 6px; margin-bottom: 0px;"
  href="https://r-spatial.github.io/sf/" target="_blank" rel="noopener"><i class="fas fa-registered fa-lg fa-fw mr2"></i>SF</a>

</div>

      </div>
      
      
    </header>
      
      
    <section class="post-body pt5 pb4">
        <p><a href="mapa_rm_featured.png" target="_blank">

  <img src="mapa_rm_featured.png" style="border-radius: 5px; width: 80%; max-width: 700px; display: block; margin: auto; margin-bottom: 8px; margin-top: 8px;">
  
</a>


<div style="display: flex; align-items: center; gap: 15px; padding: 14px; 
            background-color: #493365;  border-radius: 6px;
            margin: 20px 40px 20px 40px;">
  
  <div style="flex-shrink: 0;">
    <i class="fas fa-triangle-exclamation" style="font-size: 130%; margin-left: 2px; opacity: 1; color: #EAD2FA;"></i>
  </div>
  
  <aside style = "font-size: 90%; color: #EAD2FA;">
    ⚠️ Este tutorial se encuentra en construcción! ⚠️
  </aside>
  
</div></p>
<p>R cuenta con un muy amplio 
<a href="https://github.com/r-spatial/" target="_blank" rel="noopener">ecosistema</a> de paquetes para datos geoespaciales. Uno de los 
<a href="https://r-spatial.github.io/sf/" target="_blank" rel="noopener">paquetes más importantes es <code>{sf}</code></a>, que permite manipular datos espaciales a partir del estándar <em>simple features</em> (características simples), ampliamente utilizado en sistemas de información geográfica (SIG/GIS).</p>
<p>En esta guía iré guardando los comandos que uso frecuentemente para <strong>manipular, transformar y visualizar datos geoespaciales</strong> en R. En la medida que voy aprendiendo más sobre hacer mapitas, iré actualizando y complementando.</p>
<p>Lo inicial es instalar <code>{sf}</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;sf&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Y cargarlo junto a <code>{dplyr}</code> para empezar a trabajar con datos geoespaciales.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>Nota:</strong> para simplificar, en este tutorial voy a ocultar el código de los gráficos, pero siempre estará disponible bajo flechitas que despliegan el código, como la siguiente:</p>


<details>
  <summary>
    <strong>Ver código para los gráficos</strong>
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># tema de colores</span>
</span></span><span class="line"><span class="cl"><span class="n">thematic</span><span class="o">::</span><span class="nf">thematic_on</span><span class="p">(</span><span class="n">fg</span> <span class="o">=</span> <span class="s">&#34;#553A74&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">bg</span> <span class="o">=</span> <span class="s">&#34;#EAD2FA&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="n">accent</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">theme_set</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># fondo transparente para mapas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.background</span> <span class="o">=</span> <span class="nf">element_rect</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;transparent&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;transparent&#34;</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># borrar líneas feas</span>
</span></span><span class="line"><span class="cl">    <span class="nf">theme</span><span class="p">(</span><span class="n">axis.ticks</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<br>
<div style = "margin-left: -16px;">
  
  <details closed id="PageTableOfContents">
    <summary>
      <h2 class="mv0 f5 fw7 ttu tracked dib" style = "margin-left: 6px; font-size: 120%;">Índice</h2>
      </summary>
    <div class="pl2 pr0 mh0" style = "font-size: 90%; margin-top: -8px; margin-left: 16px; margin-bottom: 32px;">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#carga-de-mapas">Carga de mapas</a>
      <ul>
        <li><a href="#cargar-mapas-de-cualquier-país">Cargar mapas de cualquier país</a></li>
        <li><a href="#cargar-shapes">Cargar <em>shapes</em></a></li>
      </ul>
    </li>
    <li><a href="#visualización-básica-de-mapas">Visualización básica de mapas</a></li>
    <li><a href="#operaciones-sobre-geometrías">Operaciones sobre geometrías</a>
      <ul>
        <li><a href="#calcular-centroide">Calcular centroide</a></li>
        <li><a href="#extraer-longitud-y-latitud">Extraer longitud y latitud</a></li>
        <li><a href="#calcular-buffer">Calcular buffer</a></li>
        <li><a href="#calcular-caja-de-un-polígono">Calcular caja de un polígono</a></li>
        <li><a href="#poner-un-punto-en-un-mapa">Poner un punto en un mapa</a></li>
        <li><a href="#crear-un-cuadrado">Crear un cuadrado</a></li>
        <li><a href="#crear-un-polígono-a-partir-de-coordenadas">Crear un polígono a partir de coordenadas</a></li>
        <li><a href="#recortar-un-mapa">Recortar un mapa</a></li>
        <li><a href="#mover-puntos-de-un-mapa">Mover puntos de un mapa</a></li>
      </ul>
    </li>
    <li><a href="#recursos-para-aprender-más">Recursos para aprender más</a>
      <ul>
        <li><a href="#apuntes">Apuntes</a></li>
        <li><a href="#libros">Libros</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </details>
  
</div>
<hr>




<h2 id="carga-de-mapas">Carga de mapas
  <a href="#carga-de-mapas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Una de las fuentes principales de datos geoespaciales son los <em>shapefiles</em>. Pero también existen <strong>paquetes de R que contienen información geoespacial</strong>, para mayor conveniencia. Exploraremos ambas opciones a continuación.</p>




<h3 id="cargar-mapas-de-cualquier-país">Cargar mapas de cualquier país
  <a href="#cargar-mapas-de-cualquier-pa%c3%ads"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Si no tenemos o no queremos descargar <em>shapes</em>, podemos <strong>cargar mapas de cualquier país directo en R</strong> gracias a 
<a href="http://ropensci.github.io/rnaturalearth/" target="_blank" rel="noopener"><code>{rnaturalearth}</code></a>. Con este paquete obtenemos directamente mapas de cualquier país del mundo, incluyendo sus estados o regiones internos, sin necesidad de descargas.</p>
<p>Instala <code>{rnaturalearth}</code> si no lo tienes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;rnaturalearth&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>Puedes insertar el nombre de tu país para seguir con este tutorial usando ejemplos de tu territorio.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">rnaturalearth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pais</span> <span class="o">&lt;-</span> <span class="nf">ne_states</span><span class="p">(</span><span class="s">&#34;Argentina&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pais &lt;- ne_states(&#34;Mexico&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pais &lt;- ne_states(&#34;Colombia&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa</span> <span class="o">&lt;-</span> <span class="n">pais</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># seleccionar columnas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">pais</span> <span class="o">=</span> <span class="n">admin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">region</span> <span class="o">=</span> <span class="n">name_es</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">geometry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa</span>
</span></span></code></pre></div><pre><code>Simple feature collection with 24 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -73.57274 ymin: -55.05202 xmax: -53.66155 ymax: -21.78694
Geodetic CRS:  WGS 84
First 10 features:
          pais     region                       geometry
1    Argentina Entre Ríos MULTIPOLYGON (((-58.20011 -...
12   Argentina      Salta MULTIPOLYGON (((-68.49647 -...
13   Argentina      Jujuy MULTIPOLYGON (((-67.25133 -...
741  Argentina    Formosa MULTIPOLYGON (((-62.34136 -...
746  Argentina   Misiones MULTIPOLYGON (((-54.66497 -...
749  Argentina      Chaco MULTIPOLYGON (((-58.35127 -...
750  Argentina Corrientes MULTIPOLYGON (((-58.6042 -2...
1318 Argentina  Catamarca MULTIPOLYGON (((-68.33776 -...
1320 Argentina   La Rioja MULTIPOLYGON (((-69.65405 -...
1321 Argentina   San Juan MULTIPOLYGON (((-69.95766 -...
</code></pre>




<h3 id="cargar-shapes">Cargar <em>shapes</em>
  <a href="#cargar-shapes"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Un <em>shapefile</em> es un formato de archivo común para datos geoespaciales, que en realidad consiste en una <strong>carpeta</strong> con archivos relacionados (<code>.shp</code>, <code>.shx</code>, <code>.dbf</code>, entre otros) que juntos representan la geometría y atributos de los objetos geográficos.</p>
<p>Teniendo la carpeta, basta con cargarla con la función <code>read_sf()</code>.</p>
<p>

<details>
  <summary>
    <strong>Ejemplo de descarga y carga de un <em>shapefile</em> de Chile</strong>
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <p>Para aprender, podemos descargar un <em>shape</em> y usarlo para practicar. Si no tienes uno a mano, en el siguiente botón podemos bajar un <em>shapefile</em> de Chile por regiones, que proviene de la 
<a href="https://www.bcn.cl/siit/mapas_vectoriales" target="_blank" rel="noopener">Mapoteca de la Biblioteca del Congreso Nacional</a>.</p>
<div class = "db pt1"
style = "margin-bottom: 34px;">
<p><a class = "btn-links mr2 ba dib"
href = "https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip" target="_blank"
style = "padding: 12px; padding-bottom: 8px; border-radius: 5px; padding-right: 18px; text-decoration: none; border: 1px solid; color: #EAD2FA; background-color: #9069C0; margin-bottom: -12px;">
<i class="fas fa-map fa-lg fa-fw mr2" style="color: #EAD2FA;"></i>
Division regional: polígonos de las regiones de Chile</a></p>
</div>
<p>También puedes descargarlo directamente desde R con <code>download.file()</code> y luego <code>unzip()</code>, 
<a href="../../../blog/mapa_chile_triple/#descargar-mapas">como se indica en este post</a>.</p>
<p>Una vez descargado, descomprimimos el archivo y obtenemos una <strong>carpeta</strong>. Esta carpeta es nuestro <em>shapefile</em>, así que la guardamos dentro de nuestro 
<a href="../../../blog/r_introduccion/proyectos/">proyecto de RStudio</a>, idealmente dentro de una carpeta donde guardemos nuestros mapas.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># descargar</span>
</span></span><span class="line"><span class="cl"><span class="nf">download.file</span><span class="p">(</span><span class="s">&#34;https://www.bcn.cl/obtienearchivo?id=repositorio/10221/10398/2/Regiones.zip&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s">&#34;Regiones.zip&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># descomprimir</span>
</span></span><span class="line"><span class="cl"><span class="nf">unzip</span><span class="p">(</span><span class="s">&#34;Regiones.zip&#34;</span><span class="p">,</span> <span class="n">exdir</span> <span class="o">=</span> <span class="s">&#34;shapes/Regiones&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>En el siguiente ejemplo, guardamos el <em>shapefile</em> en una carpeta <code>shapes</code>, y lo cargamos con <code>read_sf()</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa</span> <span class="o">&lt;-</span> <span class="nf">read_sf</span><span class="p">(</span><span class="s">&#34;shapes/Regiones&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="n">janitor</span><span class="o">::</span><span class="nf">clean_names</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa</span>
</span></span></code></pre></div><pre><code>Simple feature collection with 17 features and 7 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -12183900 ymin: -7554306 xmax: -7393644 ymax: -1978920
Projected CRS: WGS 84 / Pseudo-Mercator
# A tibble: 17 × 8
   objectid cir_sena codregion area_km    st_area_sh st_length region           
 *    &lt;dbl&gt;    &lt;int&gt;     &lt;int&gt;   &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;            
 1     1084        1        15  16867.  18868687744.   750530. Región de Arica …
 2     1085        2         1  42285.  48306372203.  1213713. Región de Tarapa…
 3     1086        3         2 126071. 150845155633   2516112. Región de Antofa…
 4     1087       15        12 133053. 358131609833  90498304. Región de Magall…
 5     1088       14        11 106703. 224274263072  41444811. Región de Aysén …
 6     1089        4         3  75661.  96439063562.  2401741. Región de Atacama
 7     1090        5         4  40576.  54980818749.  2065933. Región de Coquim…
 8     1091        6         5  16323.  23014748571.  1679609. Región de Valpar…
 9     1092        7        13  15392.  22252038246.  1064253. Región Metropoli…
10     1093       13        10  48408.  87718341940.  7874158. Región de Los La…
11     1094       12        14  18245.  31086613540.  1844423. Región de Los Rí…
12     1095       11         9  31838.  52215073344.  1501025. Región de La Ara…
13     1096       10         8  24022.  38176117509.  2097147. Región del Bío-B…
14     1097       10        16  13104.  20376298459.  1074094. Región de Ñuble  
15     1098        9         7  30322.  45969426092.  1388328. Región del Maule 
16     1099        8         6  16349.  24090278437.   984853. Región del Liber…
17     1100        0         0   3937.   9306245194.   388722. Zona sin demarcar
# ℹ 1 more variable: geometry &lt;GEOMETRY [m]&gt;
</code></pre>

    </div>
</details>


<div style="display: flex; align-items: center; gap: 15px; padding: 14px; 
            background-color: #493365;  border-radius: 6px;
            margin: 20px 40px 20px 40px;">
  
  <div style="flex-shrink: 0;">
    <i class="fas fa-triangle-exclamation" style="font-size: 130%; margin-left: 2px; opacity: 1; color: #EAD2FA;"></i>
  </div>
  
  <aside style = "font-size: 90%; color: #EAD2FA;">
    Puedes seguir este tutorial independientemente del mapa que hayas cargado (el <em>shape</em> de Chile, con <code>rnaturalearth</code>, u otro <em>shape</em> que tú elijas); lo importante es que cargues un objeto <code>mapa</code> que tenga columna <code>geometry</code> y <code>region</code>.
  </aside>
  
</div></p>
<!--
### Cargar geoJSON


### Cargar KMZ


::: {.cell}

```{.r .cell-code}
unzip("~/Downloads/Mis lugares.kmz", exdir = "~/Downloads/Mis lugares")

sf::read_sf("~/Downloads/Mis lugares/doc.kml")
```
:::



-->
<hr>
<p>Como vemos, una vez que cargamos los datos geoespaciales obtenemos una <strong>tabla con características especiales</strong>. Arriba de la tabla vemos una descripción de las características del mapa, el tipo de geometrías, la caja o <em>bounding box</em> que enmarca los polígonos, y el sistema de referencia de coordenadas del mapa.</p>
<p>En <code>{sf}</code> los datos geoespaciales además contienen una columna <code>geometry</code>, que contiene las geometrías (puntos, líneas o polígonos) que definen la forma y ubicación de los elementos geográficos. Vamos a trabajar con esta columna si queremos <strong>modificar la geometría</strong> de los elementos geoespaciales o calcular algo a partir de ellos. <strong>Cada fila de la tabla representa un objeto geográfico</strong> (una región, comuna, país, etc.) y las demás columnas son variables relacionadas al objeto geográfico (población, superficie, nombre, etc.)</p>
<!--
## Glosario

- **Simple features**: estándar para representar datos geoespaciales en forma de tablas con una columna especial de geometría.
- **Shapefile**: formato de archivo común para datos geoespaciales, que en realidad consiste en varios archivos relacionados.
- **Polígono**: forma geométrica que representa áreas en un mapa.

-->
<hr>




<h2 id="visualización-básica-de-mapas">Visualización básica de mapas
  <a href="#visualizaci%c3%b3n-b%c3%a1sica-de-mapas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Para visualizar un mapa con <code>{sf}</code> usamos la geometría <code>geom_sf()</code> dentro de un gráfico de <code>{ggplot2}</code>. Esta función reconoce automáticamente la columna <code>geometry</code> del objeto espacial, y dibuja las formas geográficas correspondientes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FA&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">)</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/mapa_basico-1.png" width="768" />


<div style="display: flex; align-items: center; gap: 15px; padding: 14px; 
            background-color: #493365;  border-radius: 6px;
            margin: 20px 40px 20px 40px;">
  
  <div style="flex-shrink: 0;">
    <i class="fas fa-triangle-exclamation" style="font-size: 130%; margin-left: 2px; opacity: 1; color: #EAD2FA;"></i>
  </div>
  
  <aside style = "font-size: 90%; color: #EAD2FA;">
    Si necesitas aprender lo básico de <code>{ggplot2}</code> para visualización de datos, 
<a href="../../blog/r_introduccion/tutorial_visualizacion_ggplot/">revisa este completo tutorial</a>.
  </aside>
  
</div>
<hr>




<h2 id="operaciones-sobre-geometrías">Operaciones sobre geometrías
  <a href="#operaciones-sobre-geometr%c3%adas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Las operaciones sobre geometrías permiten manipular y analizar las formas y ubicaciones de los objetos geográficos. A continuación veremos algunas operaciones comunes que se pueden realizar con el paquete <code>{sf}</code> en R.</p>




<h3 id="calcular-centroide">Calcular centroide
  <a href="#calcular-centroide"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>El centroide es el punto central de un polígono. Calcularlo sirve, por ejemplo, para ubicar una etiqueta de texto sobre un polígono, poner un punto sobre un territorio que crece con respecto a una variable, etc.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_centroide</span> <span class="o">&lt;-</span> <span class="n">mapa</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">centroide</span> <span class="o">=</span> <span class="nf">st_centroid</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span>
</span></span></code></pre></div><pre><code>                  region                   centroide
1             Entre Ríos POINT (-59.20493 -32.03189)
12                 Salta POINT (-64.80661 -24.28824)
13                 Jujuy POINT (-65.77985 -23.31783)
741              Formosa POINT (-59.94839 -24.89604)
746             Misiones POINT (-54.65212 -26.86956)
749                Chaco POINT (-60.77109 -26.39039)
750           Corrientes POINT (-57.79471 -28.76018)
1318           Catamarca  POINT (-66.99006 -27.3092)
1320            La Rioja POINT (-67.21371 -29.66235)
1321            San Juan POINT (-68.88199 -30.82274)
1323             Mendoza POINT (-68.60826 -34.58944)
1328             Neuquén POINT (-70.11374 -38.62865)
1333              Chubut POINT (-68.51499 -43.78523)
1335           Río Negro POINT (-67.21765 -40.40738)
1337          Santa Cruz  POINT (-69.8981 -48.76187)
1339    Tierra del Fuego  POINT (-67.4401 -54.32625)
1726        Buenos Aires POINT (-60.54573 -36.66279)
1746        Buenos Aires POINT (-58.45093 -34.64272)
3852            Santa Fe POINT (-60.93513 -30.66904)
3853             Tucumán  POINT (-65.36557 -26.9491)
3854 Santiago del Estero  POINT (-63.2909 -27.71835)
3855            San Luis POINT (-66.03363 -33.74238)
3856            La Pampa POINT (-65.44562 -37.12691)
3857             Córdoba POINT (-63.76859 -32.07319)
</code></pre>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/mapa_centroide-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_centroide</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">region</span> <span class="o">==</span> <span class="n">mapa</span><span class="o">$</span><span class="n">region[3]</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">centroide</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">.6</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf_text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">centroide</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">label</span> <span class="o">=</span> <span class="s">&#34;centroide&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">vjust</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="extraer-longitud-y-latitud">Extraer longitud y latitud
  <a href="#extraer-longitud-y-latitud"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Para obtener las coordenadas (longitud y latitud) de un elemento espacial, necesitamos primero que sea un punto, porque un polígono es una figura compleja que no tiene solamente una latitud y una longitud. Si tenemos un polígono, 
<a href="#calcular-centroide">primero calculamos el centroide</a>, y luego extraemos las coordenadas con <code>st_coordinates()</code>. Como esta función retorna la longitud y latitud de cada punto al mismo tiempo, tenemos que pedirle que entregue la una o la otra usando corchetes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_centroide_coordenadas</span> <span class="o">&lt;-</span> <span class="n">mapa_centroide</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">lon</span> <span class="o">=</span> <span class="nf">st_coordinates</span><span class="p">(</span><span class="n">centroide</span><span class="p">)</span><span class="n">[</span><span class="p">,</span><span class="m">1</span><span class="n">]</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">lat</span> <span class="o">=</span> <span class="nf">st_coordinates</span><span class="p">(</span><span class="n">centroide</span><span class="p">)</span><span class="n">[</span><span class="p">,</span><span class="m">2</span><span class="n">]</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>                  region       lon       lat
1             Entre Ríos -59.20493 -32.03189
12                 Salta -64.80661 -24.28824
13                 Jujuy -65.77985 -23.31783
741              Formosa -59.94839 -24.89604
746             Misiones -54.65212 -26.86956
749                Chaco -60.77109 -26.39039
750           Corrientes -57.79471 -28.76018
1318           Catamarca -66.99006 -27.30920
1320            La Rioja -67.21371 -29.66235
1321            San Juan -68.88199 -30.82274
1323             Mendoza -68.60826 -34.58944
1328             Neuquén -70.11374 -38.62865
1333              Chubut -68.51499 -43.78523
1335           Río Negro -67.21765 -40.40738
1337          Santa Cruz -69.89810 -48.76187
1339    Tierra del Fuego -67.44010 -54.32625
1726        Buenos Aires -60.54573 -36.66279
1746        Buenos Aires -58.45093 -34.64272
3852            Santa Fe -60.93513 -30.66904
3853             Tucumán -65.36557 -26.94910
3854 Santiago del Estero -63.29090 -27.71835
3855            San Luis -66.03363 -33.74238
3856            La Pampa -65.44562 -37.12691
3857             Córdoba -63.76859 -32.07319
</code></pre>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/barras_latitud-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_centroide_coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">distinct</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">.keep_all</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">region</span> <span class="o">=</span> <span class="n">forcats</span><span class="o">::</span><span class="nf">fct_reorder</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">lat</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="c1"># ordenar regiones</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_col</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">           <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">region</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">-0.05</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EAD2FA&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_y_discrete</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Latitud&#34;</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="calcular-buffer">Calcular buffer
  <a href="#calcular-buffer"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Un <em>buffer</em> es una zona alrededor de un objeto geográfico, definida por una distancia específica. Calcular un <em>buffer</em> es útil para analizar áreas de influencia, proximidad a ciertos puntos o regiones, o para hacer modificiones sobre mapas con fines de visualización.</p>
<p>Con la función <code>st_buffer()</code> definimos el espacio en torno a un polígono, especificando en el argumento <code>dist</code> la <strong>distancia</strong> del <em>buffer</em> en las unidades del sistema de coordenadas del mapa (por ejemplo, metros si el mapa está en UTM), y con <code>max_cells</code> podemos controlar la calidad del polígono resultante.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_buffer</span> <span class="o">&lt;-</span> <span class="n">mapa</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># filtrar una región/polígono</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">region</span> <span class="o">==</span> <span class="n">mapa</span><span class="o">$</span><span class="n">region[3]</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># crear buffer</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">buffer</span> <span class="o">=</span> <span class="nf">st_buffer</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                            <span class="n">dist</span> <span class="o">=</span> <span class="m">20000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">max_cells</span> <span class="o">=</span> <span class="m">10000</span><span class="p">))</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/mapa_buffer-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_buffer</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa de la región</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa del buffer</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="calcular-caja-de-un-polígono">Calcular caja de un polígono
  <a href="#calcular-caja-de-un-pol%c3%adgono"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Con la función <code>st_bbox()</code> obtenemos las coordenadas de la caja que envuelve a un polígono o conjunto de polígonos. Esta caja está definida por las coordenadas mínimas y máximas en los ejes <em>x</em> (longitud) e <em>y</em> (latitud).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">caja</span> <span class="o">&lt;-</span> <span class="nf">st_bbox</span><span class="p">(</span><span class="n">mapa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">caja</span>
</span></span></code></pre></div><pre><code>     xmin      ymin      xmax      ymax 
-73.57274 -55.05202 -53.66155 -21.78694 
</code></pre>




<h4 id="convertir-caja-a-polígono">Convertir caja a polígono
  <a href="#convertir-caja-a-pol%c3%adgono"></a>
</h4>
<p>Teniendo una caja con sus coordenadas, podemos convertirla a un polígono para aplicarlo sobre (o debajo de) un mapa.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">rectangulo</span> <span class="o">&lt;-</span> <span class="n">caja</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sfc</span><span class="p">(</span><span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-18-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con la caja encima</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">rectangulo</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># tema</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">axis.text</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="n">panel.background</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">())</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="poner-un-punto-en-un-mapa">Poner un punto en un mapa
  <a href="#poner-un-punto-en-un-mapa"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Si queremos poner puntos en posiciones específicas de un mapa, sólo necesitamos crear una tabla con las coordenadas de los puntos y convertir la tabla a <code>sf</code> con <code>st_as_sf()</code>. Al hacer esto, es necesario especificar el sistema de referencia de coordenadas (CRS) del mapa, para que los puntos se ubiquen correctamente. Hacemos esto extrayendo el CRS del mapa con <code>st_crs()</code> y aplicándolo a nuestra nueva tabla <code>sf</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># definir coordenadas</span>
</span></span><span class="line"><span class="cl"><span class="n">coordenadas</span> <span class="o">&lt;-</span> <span class="nf">tibble</span><span class="p">(</span><span class="n">longitud</span> <span class="o">=</span> <span class="m">-70</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="n">latitud</span> <span class="o">=</span> <span class="m">-38</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># convertir tabla a sf</span>
</span></span><span class="line"><span class="cl"><span class="n">punto</span> <span class="o">&lt;-</span> <span class="n">coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;longitud&#34;</span><span class="p">,</span> <span class="s">&#34;latitud&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-21-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con el punto</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">punto</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>




<h4 id="poner-varios-puntos-en-un-mapa">Poner varios puntos en un mapa
  <a href="#poner-varios-puntos-en-un-mapa"></a>
</h4>
<p>Si necesitamos agregar más de un punto, simplemente hacemos una tabla con todos los que necesitemos. Obviamente también podemos especificar otras columnas que podemos usar para etiquetar los puntos, especificar sus colores, y más.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">coordenadas</span> <span class="o">&lt;-</span> <span class="nf">tribble</span><span class="p">(</span><span class="o">~</span><span class="n">nombre</span><span class="p">,</span> <span class="o">~</span><span class="n">lon</span><span class="p">,</span> <span class="o">~</span><span class="n">lat</span><span class="p">,</span> <span class="o">~</span><span class="n">n</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;A&#34;</span><span class="p">,</span>  <span class="m">-69</span><span class="p">,</span>  <span class="m">-38</span><span class="p">,</span>  <span class="m">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;B&#34;</span><span class="p">,</span>  <span class="m">-65</span><span class="p">,</span>  <span class="m">-37</span><span class="p">,</span>  <span class="m">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;C&#34;</span><span class="p">,</span>  <span class="m">-61</span><span class="p">,</span>  <span class="m">-36</span><span class="p">,</span>  <span class="m">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">puntos</span> <span class="o">&lt;-</span> <span class="n">coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir tabla a sf</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;lon&#34;</span><span class="p">,</span> <span class="s">&#34;lat&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-24-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con puntos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nf">aes</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">alpha</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con textos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf_label</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">nombre</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">vjust</span> <span class="o">=</span> <span class="m">-0.8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">fontface</span> <span class="o">=</span> <span class="s">&#34;bold&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># escala de tamaño</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_size</span><span class="p">(</span><span class="n">range</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">             <span class="n">breaks</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="nf">breaks_pretty</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">3</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">guides</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="nf">guide_legend</span><span class="p">(</span><span class="n">override.aes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                                 <span class="n">alpha</span> <span class="o">=</span> <span class="m">1</span><span class="p">)))</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="crear-un-cuadrado">Crear un cuadrado
  <a href="#crear-un-cuadrado"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Para poner un cuadrado encima de una ubicación del mapa, primero creamos un punto, luego lo 
<a href="#calcular-buffer">expandimos con un <em>buffer</em></a>, calculamos 
<a href="#calcular-caja-de-un-pol%c3%adgono">la caja que envuelve a dicho punto</a>, y finalmente convertimos la caja en un polígono <code>sf</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">coordenadas</span> <span class="o">&lt;-</span> <span class="nf">tibble</span><span class="p">(</span><span class="n">longitud</span> <span class="o">=</span> <span class="m">-58</span><span class="p">,</span> <span class="n">latitud</span> <span class="o">=</span> <span class="m">-38</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">punto</span> <span class="o">&lt;-</span> <span class="n">coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir tabla a sf</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;longitud&#34;</span><span class="p">,</span> <span class="s">&#34;latitud&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cuadrado</span> <span class="o">&lt;-</span> <span class="n">punto</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_buffer</span><span class="p">(</span><span class="n">dist</span> <span class="o">=</span> <span class="m">100000</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="c1"># agrandar punto</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_bbox</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="c1"># crear caja al rededor</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sfc</span><span class="p">(</span><span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span> <span class="c1"># convertir a sf</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-27-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con puntos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">cuadrado</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="n">linejoin</span> <span class="o">=</span> <span class="s">&#34;mitre&#34;</span><span class="p">,</span> <span class="c1">#linejoin = &#34;round&#34;,</span>
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_sf</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-72</span><span class="p">,</span> <span class="m">-56</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">           <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-40</span><span class="p">,</span> <span class="m">-30</span><span class="p">))</span>
</span></span></code></pre></div>
    </div>
</details>
<p>Paso a paso, el proceso de crear el punto, agrandarlo, y formarlo en un cuadrado se vería así:</p>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-29-1.png" width="768" />


<details>
  <summary>
    Ver código del proceso y del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">punto_grande</span> <span class="o">&lt;-</span> <span class="n">punto</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_buffer</span><span class="p">(</span><span class="n">dist</span> <span class="o">=</span> <span class="m">100000</span><span class="p">,</span> <span class="n">max_cells</span> <span class="o">=</span> <span class="m">10000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cuadrado</span> <span class="o">&lt;-</span> <span class="n">punto_grande</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_bbox</span><span class="p">(</span><span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sfc</span><span class="p">()</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capas </span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">punto</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">punto_grande</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">cuadrado</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># acercar mapa</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_sf</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-61</span><span class="p">,</span> <span class="m">-55</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">           <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-40</span><span class="p">,</span> <span class="m">-35.7</span><span class="p">))</span>
</span></span></code></pre></div>
    </div>
</details>




<h4 id="crear-un-rectángulo-a-partir-de-puntos">Crear un rectángulo a partir de puntos
  <a href="#crear-un-rect%c3%a1ngulo-a-partir-de-puntos"></a>
</h4>
<p>Si tenemos varios puntos y necesitamos crear un rectángulo que los contenga a todos, podemos repetir lo anterior pero partiendo de varios puntos a la vez.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># tabla con coordenadas</span>
</span></span><span class="line"><span class="cl"><span class="n">coordenadas</span> <span class="o">&lt;-</span> <span class="nf">tribble</span><span class="p">(</span><span class="o">~</span><span class="n">nombre</span><span class="p">,</span> <span class="o">~</span><span class="n">lon</span><span class="p">,</span> <span class="o">~</span><span class="n">lat</span><span class="p">,</span> <span class="o">~</span><span class="n">n</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;A&#34;</span><span class="p">,</span>  <span class="m">-69</span><span class="p">,</span>  <span class="m">-38</span><span class="p">,</span>  <span class="m">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;B&#34;</span><span class="p">,</span>  <span class="m">-65</span><span class="p">,</span>  <span class="m">-37</span><span class="p">,</span>  <span class="m">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;C&#34;</span><span class="p">,</span>  <span class="m">-61</span><span class="p">,</span>  <span class="m">-36</span><span class="p">,</span>  <span class="m">9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># convertir coordenadas a puntos</span>
</span></span><span class="line"><span class="cl"><span class="n">puntos</span> <span class="o">&lt;-</span> <span class="n">coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir tabla a sf</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;lon&#34;</span><span class="p">,</span> <span class="s">&#34;lat&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># convertir puntos a rectándulo</span>
</span></span><span class="line"><span class="cl"><span class="n">rectangulo</span> <span class="o">&lt;-</span> <span class="n">puntos</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_buffer</span><span class="p">(</span><span class="n">dist</span> <span class="o">=</span> <span class="m">80000</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="c1"># ampliar</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_bbox</span><span class="p">()</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sfc</span><span class="p">(</span><span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-32-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#EBD2FB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con puntos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">alpha</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">rectangulo</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="crear-un-polígono-a-partir-de-coordenadas">Crear un polígono a partir de coordenadas
  <a href="#crear-un-pol%c3%adgono-a-partir-de-coordenadas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Teniendo una tabla con un conjunto de coordenadas, podemos unirlas para formar un polígono. Es decir, <strong>unir los puntos</strong> para conformar una figura geométrica cerrada. Para ello, usamos <code>st_combine()</code> para combinar las coordenadas en un solo elemento, y luego <code>st_cast()</code> para convertir esos puntos combinados en un polígono.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">coordenadas</span> <span class="o">&lt;-</span> <span class="nf">tribble</span><span class="p">(</span><span class="o">~</span><span class="n">nombre</span><span class="p">,</span> <span class="o">~</span><span class="n">lon</span><span class="p">,</span> <span class="o">~</span><span class="n">lat</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="m">-68</span><span class="p">,</span>  <span class="m">-36</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="m">-64</span><span class="p">,</span>  <span class="m">-31</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="m">-60</span><span class="p">,</span>  <span class="m">-36</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># convertir tabla a sf</span>
</span></span><span class="line"><span class="cl"><span class="n">puntos</span> <span class="o">&lt;-</span> <span class="n">coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;lon&#34;</span><span class="p">,</span> <span class="s">&#34;lat&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">poligono</span> <span class="o">&lt;-</span> <span class="n">puntos</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># combinar coordenadas en un solo elemento</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">st_combine</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir puntos a polígono</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_cast</span><span class="p">(</span><span class="s">&#34;POLYGON&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/poligonos_1-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#E0C7F0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con puntos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">alpha</span> <span class="o">=</span> <span class="m">.6</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con polígono</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">poligono</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">lwd</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>




<h4 id="crear-varios-polígonos-a-partir-de-coordenadas">Crear varios polígonos a partir de coordenadas
  <a href="#crear-varios-pol%c3%adgonos-a-partir-de-coordenadas"></a>
</h4>
<p>Podemos realizar el mismo proceso anterior, pero agrupando los datos con <code>group_by()</code> para crear varios polígonos a la vez, de acuerdo a la variable de agrupación (en este caso, <code>tipo</code>). Entonces, cuando usemos <code>st_combine()</code>, se combinarán las coordenadas de cada grupo por separado, y luego <code>st_cast()</code> convertirá cada grupo de puntos combinados en un polígono distinto.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">coordenadas</span> <span class="o">&lt;-</span> <span class="nf">tribble</span><span class="p">(</span><span class="o">~</span><span class="n">tipo</span><span class="p">,</span>    <span class="o">~</span><span class="n">lon</span><span class="p">,</span> <span class="o">~</span><span class="n">lat</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;Triángulo&#34;</span><span class="p">,</span> <span class="m">-68</span><span class="p">,</span>  <span class="m">-30</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;Triángulo&#34;</span><span class="p">,</span> <span class="m">-64</span><span class="p">,</span>  <span class="m">-25</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s">&#34;Triángulo&#34;</span><span class="p">,</span> <span class="m">-60</span><span class="p">,</span>  <span class="m">-30</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;Cuadrado&#34;</span><span class="p">,</span> <span class="m">-68</span><span class="p">,</span>  <span class="m">-38</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;Cuadrado&#34;</span><span class="p">,</span> <span class="m">-60</span><span class="p">,</span>  <span class="m">-38</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;Cuadrado&#34;</span><span class="p">,</span> <span class="m">-60</span><span class="p">,</span>  <span class="m">-32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;Cuadrado&#34;</span><span class="p">,</span> <span class="m">-68</span><span class="p">,</span>  <span class="m">-32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># convertir tabla a sf</span>
</span></span><span class="line"><span class="cl"><span class="n">puntos</span> <span class="o">&lt;-</span> <span class="n">coordenadas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;lon&#34;</span><span class="p">,</span> <span class="s">&#34;lat&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">mapa</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">poligono</span> <span class="o">&lt;-</span> <span class="n">puntos</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># combinar coordenadas en elementos únicos agrupados por una variable</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">tipo</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">st_combine</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir puntos a polígono</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_cast</span><span class="p">(</span><span class="s">&#34;POLYGON&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/poligonos_2-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mapa de fondo</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#E0C7F0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con polígonos de color</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">poligono</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">tipo</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">tipo</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">lwd</span> <span class="o">=</span> <span class="m">0.6</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># capa con puntos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">alpha</span> <span class="o">=</span> <span class="m">.4</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># escala de colores</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Tipo&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Tipo&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.key.spacing.y</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">))</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>




<h3 id="recortar-un-mapa">Recortar un mapa
  <a href="#recortar-un-mapa"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Para enfocar un mapa en una zona específica y eliminar el resto de los polígonos, usamos la función <code>st_crop()</code>, definiendo los límites del recorte con las coordenadas mínimas y máximas en los ejes <em>x</em> (longitud) e <em>y</em> (latitud).</p>
<p>Primero obtengamos un mapa de Chile desde <code>{rnaturalearth}</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">rnaturalearth</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">chile</span> <span class="o">&lt;-</span> <span class="nf">ne_countries</span><span class="p">(</span><span class="n">country</span> <span class="o">=</span> <span class="s">&#34;Chile&#34;</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="m">10</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">pais</span> <span class="o">=</span> <span class="n">admin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">region</span> <span class="o">=</span> <span class="n">name_es</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">geometry</span><span class="p">)</span>
</span></span></code></pre></div><p>Ahora lo recortamos con <code>st_crop()</code>. Recomiendo hacerlo terminando el recorte con una visualización del mapa, para ver inmediatamente el resultado y así poder ir ajustando el recorte:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">chile_recortado</span> <span class="o">&lt;-</span> <span class="n">chile</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_crop</span><span class="p">(</span><span class="n">xmin</span> <span class="o">=</span> <span class="m">-78</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="m">-17</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">xmax</span> <span class="o">=</span> <span class="m">-65</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="m">-56</span><span class="p">)</span> 
</span></span></code></pre></div><p>En este caso, hacemos un recorte para obtener el territorio continental de Chile (excluyendo las islas Juan Fernández, Isla de Pascua y Antártica)</p>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-40-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_completo</span> <span class="o">&lt;-</span> <span class="n">chile</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa_recortado</span> <span class="o">&lt;-</span> <span class="n">chile_recortado</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># poner los dos mapas lado a lado</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">patchwork</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa_completo</span> <span class="o">+</span> <span class="n">mapa_recortado</span>
</span></span></code></pre></div>
    </div>
</details>
<p>También podemos hacer recortes que pasen por encima de los polígonos, eliminando la geografía que quede fuera del recorte. En este caso hacemos un recorte más cercano a la zona costera de Temuco y Valdivia:</p>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-42-1.png" width="768" />
<hr>




<h3 id="mover-puntos-de-un-mapa">Mover puntos de un mapa
  <a href="#mover-puntos-de-un-mapa"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Cuando ya contamos con tabla con datos geoespaciales en puntos, a veces es necesario mover la posición de los puntos en un mapa, por ejemplo, para evitar que se sobrepongan etiquetas, para ajustar una coordenada incorrecta, o para mejorar la visualización.</p>
<p>Los puntos pueden moverse al <strong>modificar las coordenadas de la geometría</strong>. En el caso de los puntos se las coordenadas son un vector de dos elementos (longitud y latitud), por lo que podemos sumar o restarle a la columna <code>geometry</code> para modificar la posición de cada punto.</p>
<p>Creemos una tabla con latitudes y longitudes, y convirtámosla a <code>sf</code> con <code>st_as_sf()</code>, 
<a href="#poner-un-punto-en-un-mapa">como vimos antes</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">puntos</span> <span class="o">&lt;-</span> <span class="nf">tribble</span><span class="p">(</span><span class="o">~</span><span class="n">nombre</span><span class="p">,</span> <span class="o">~</span><span class="n">lon</span><span class="p">,</span>     <span class="o">~</span><span class="n">lat</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;Hualqui&#34;</span><span class="p">,</span> <span class="m">-8113368</span><span class="p">,</span> <span class="m">-4434476</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#34;Coronel&#34;</span><span class="p">,</span> <span class="m">-8136065</span><span class="p">,</span> <span class="m">-4440419</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="s">&#34;Concepción&#34;</span><span class="p">,</span> <span class="m">-8132714</span><span class="p">,</span> <span class="m">-4414370</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="s">&#34;Lota&#34;</span><span class="p">,</span> <span class="m">-8139383</span><span class="p">,</span> <span class="m">-4451456</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="s">&#34;Penco&#34;</span><span class="p">,</span> <span class="m">-8119934</span><span class="p">,</span> <span class="m">-4402016</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="s">&#34;Talcahuano&#34;</span><span class="p">,</span> <span class="m">-8139277</span><span class="p">,</span> <span class="m">-4399701</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir a tabla sf</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_as_sf</span><span class="p">(</span><span class="n">coords</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;lon&#34;</span><span class="p">,</span> <span class="s">&#34;lat&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">crs</span> <span class="o">=</span> <span class="m">3395</span><span class="p">)</span>
</span></span></code></pre></div><p>Así se ven los puntitos por sí solos:</p>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-44-1.png" width="768" />
<p>Ahora recortemos el mapa de Chile para enfocarnos en la zona donde están los puntos. 
<a href="#calcular-buffer">Creamos un <em>buffer</em></a> alrededor de los puntos para agrandarlos con <code>st_buffer()</code>, y luego 
<a href="#calcular-caja-de-un-pol%c3%adgono">calculamos la caja que los contiene</a> con <code>st_bbox()</code> para usarla como recorte.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">caja_puntos</span> <span class="o">&lt;-</span> <span class="n">puntos</span><span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_buffer</span><span class="p">(</span><span class="m">50000</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="c1"># agrandar puntos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_bbox</span><span class="p">()</span> <span class="c1"># calcular caja que contiene a los puntos</span>
</span></span></code></pre></div><p>Ahora que tenemos la caja, la usamos dentro de <code>st_crop()</code> para recortar el mapa, pero ojo, que ambas capas tienen que tener el mismo sistema de referencias de coordenadas (CRS), así que primero transformamos el mapa de Chile con <code>st_transform()</code> para que use el mismo sistema que la capa de puntos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">chile_recorte</span> <span class="o">&lt;-</span> <span class="n">chile</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># ajustar crs para que coincidan</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_transform</span><span class="p">(</span><span class="n">crs</span> <span class="o">=</span> <span class="nf">st_crs</span><span class="p">(</span><span class="n">puntos</span><span class="p">))</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># recortar con la caja (bounding box)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_crop</span><span class="p">(</span><span class="n">caja_puntos</span><span class="p">)</span>
</span></span></code></pre></div><img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-47-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">chile_recorte</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#E0C7F0&#34;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf_text</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">               <span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#34;  &#34;</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">               <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="m">-35</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<p>Imaginemos que queremos mover o modificar puntos específicos del mapa. Igual como haríamos con una tabla de datos, usamos <code>mutate()</code> para modificar la columna <code>geometry</code>, que contiene las coordenadas de cada punto, y le aplicamos una función para modificar sus valores condicionalmente, como <code>case_when()</code>. Así podemos modificar los puntos dependiendo de si coinciden con criterios basados en datos, en vez de hacerlo a mano.</p>
<p>Para este ejemplo, modificaremos puntos a partir de su valor en la variable <code>nombre</code>. Simplemente sumamos a las coordenadas de los puntos que queremos mover, recordando que como es un vector de dos elementos, sumamos un vector de dos elementos. Para moverlos horizontalmente (hacia el este), sumamos a la primera posición del vector (longitud, <code>c(7000, 0)</code>) y dejamos la segunda posición (latitud) en cero.</p>
<p>El problema es que, al hacer esto, convertimos las coordenadas en meros números, por lo que pierden atributos geométricos, lo que causa problemas. Para resolverlo, le sacamos también los atributos geométricos a los demás puntos que no se mueven (con <code>st_set_crs(NA)</code>), y después luego le reasignamos el sistema de coordenadas (CRS) original a toda la tabla con <code>st_set_crs()</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">puntos_movidos</span> <span class="o">&lt;-</span> <span class="n">puntos</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># modificar puntos condicionalmente</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">case_when</span><span class="p">(</span><span class="n">nombre</span> <span class="o">==</span> <span class="s">&#34;Hualqui&#34;</span> <span class="o">~</span> <span class="n">geometry</span> <span class="o">+</span> <span class="nf">c</span><span class="p">(</span><span class="m">7000</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">nombre</span> <span class="o">==</span>  <span class="s">&#34;Penco&#34;</span> <span class="o">~</span> <span class="n">geometry</span> <span class="o">+</span> <span class="nf">c</span><span class="p">(</span><span class="m">7000</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">.default</span> <span class="o">=</span> <span class="nf">st_sfc</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nf">st_set_crs</span><span class="p">(</span><span class="kc">NA</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">         <span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">st_set_crs</span><span class="p">(</span><span class="nf">st_crs</span><span class="p">(</span><span class="n">puntos</span><span class="p">))</span>
</span></span></code></pre></div>

<details>
  <summary>
    Otra alternativa sería&hellip;
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <p>Otra alternativa al problema de perder las coordenadas al modificar los puntos es hacer lo contrario: volver a agregar las coordenadas a cada observación que se modifique agregándoles <code>st_set_crs(st_crs(mapa))</code>, y dejando las demás observaciones sin cambios.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">puntos</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">case_match</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                               <span class="s">&#34;Hualqui&#34;</span> <span class="o">~</span> <span class="nf">st_sfc</span><span class="p">(</span><span class="n">geometry</span> <span class="o">+</span> <span class="nf">c</span><span class="p">(</span><span class="m">7000</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="nf">st_set_crs</span><span class="p">(</span><span class="nf">st_crs</span><span class="p">(</span><span class="n">puntos</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                               <span class="s">&#34;Tomé&#34;</span> <span class="o">~</span> <span class="nf">st_sfc</span><span class="p">(</span><span class="n">geometry</span> <span class="o">+</span> <span class="nf">c</span><span class="p">(</span><span class="m">7000</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="nf">st_set_crs</span><span class="p">(</span><span class="nf">st_crs</span><span class="p">(</span><span class="n">puntos</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                               <span class="n">.default</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><p>Personalmente encuentro que la primera forma es más legible.</p>

    </div>
</details>
<p>Lo que sumemos o restemos a las coordenadas depende del sistema de coordenadas de cada mapa. En algunos va a haber que sumar números muy pequeños, pero en otros sistemas de coordenadas se usan números muy grandes.</p>
<p>En el gráfico vemos en color más tenue las posiciones originales de los puntos que fueron modificados.</p>
<img src="mapas_sf.markdown_strict_files/figure-markdown_strict/unnamed-chunk-51-1.png" width="768" />


<details>
  <summary>
    Ver código del gráfico
  </summary>
    <div style="padding: 16px; border: solid 2px #A885C6AA; border-radius: 6px; 
    background-color: #A885C630;
    margin-top: 8px; padding-top: 0px; padding-bottom: 0px;">
    <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">chile_recorte</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;#9069C0&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#E0C7F0&#34;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos_movidos</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nf">geom_sf_text</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">puntos_movidos</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">               <span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="nf">paste</span><span class="p">(</span><span class="s">&#34;  &#34;</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">               <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;#402E5A&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="m">-35</span><span class="p">)</span>
</span></span></code></pre></div>
    </div>
</details>
<hr>
<!--
Desde el centroide de un polígono


::: {.cell}

```{.r .cell-code}
mapa |> 
filter(region == "Región de Antofagasta") |>
st_centroid() |> 
st_buffer(dist = 8000) |> 
st_bbox() |> 
st_as_sfc() |>
st_as_sf()
```
:::


-->
<!--
### Calcular superficie o área


::: {.cell}

```{.r .cell-code}
mapa_region_comunas_areas |> 
st_union() |> 
st_area() |> 
units::set_units("km^2")
```
:::





### Recortar polígono a coordenadas


::: {.cell}

```{.r .cell-code}
st_crop(xmin = -74, ymin = -36, xmax = -65, ymax = -30) |> 
```
:::




### Simplificar un polígono


::: {.cell}

```{.r .cell-code}
https://bookdown.org/robinlovelace/geocompr/geometric-operations.html#simplification
st_simplify(dTolerance = 0.01)

rmapshaper::ms_simplify(geometry, keep = 0.8)) 
```
:::




### Extraer líneas internas de un polígono


::: {.cell}

```{.r .cell-code}
ms_innerlines() # deja solo las líneas interiores de un coso
```
:::




## Correcciones


::: {.cell}

```{.r .cell-code}
st_as_sf()
```
:::

::: {.cell}

```{.r .cell-code}
st_make_valid()
```
:::

::: {.cell}

```{.r .cell-code}
st_drop_geometry() 
```
:::




----


## Operaciones agrupadas

### Unir polígonos


::: {.cell}

```{.r .cell-code}
group_by() |> 
st_union()
```
:::




## Operaciones entre geometrías

### Recortar un polígono con otro
https://bookdown.org/robinlovelace/geocompr/geometric-operations.html#clipping



::: {.cell}

```{.r .cell-code}
st_intersection()
```
:::



### Usar un polígono para eliminar partes de otro


::: {.cell}

```{.r .cell-code}
st_difference()
```
:::




### unir dos polígonos


::: {.cell}

```{.r .cell-code}
st_union()
```
:::



### Spatial join

### Filter


::: {.cell}

```{.r .cell-code}
https://cengel.github.io/R-spatial/spatialops.html#topological-subsetting-select-polygons-by-location
```
:::





## Coordenadas

### Extraer sistema de coordenadas


::: {.cell}

```{.r .cell-code}
st_crs(comunas_region)
```
:::



### Cambiar coordenadas


::: {.cell}

```{.r .cell-code}
st_transform(crs = st_crs(comunas_region))
```
:::




## Visualización

### Visualizar por capas


::: {.cell}

```{.r .cell-code}
geom_sf()
```
:::




### Texto


::: {.cell}

```{.r .cell-code}
geom_sf_text(data = nombres_areas |> filter(clase_topo == "Comuna"), color = "red", fontface = "bold",
aes(label = nombre)) + 
```
:::



### Texto con repel
https://github.com/slowkow/ggrepel/issues/111#issuecomment-416853013


::: {.cell}

```{.r .cell-code}
ggrepel::geom_label_repel(data = comunas_region_conteo_urbanas,
aes(label = comuna, geometry = geometry),
stat = "sf_coordinates",
size = 2, box.padding = 0,
min.segment.length = unit(3, "mm"),
label.padding = 0.15, label.size = 0
) +
```
:::




### Hacer zoom


::: {.cell}

```{.r .cell-code}
#   coord_sf(xlim = c(-70.4, -70.2),
#            ylim = c(-18.7, -18.4),
```
:::



### Dibujar un cuadrado


::: {.cell}

```{.r .cell-code}
#   annotate("rect", fill = NA, color = "black", linewidth = 1,
#            xmin = bbox_area_met[1]-2000, xmax = bbox_area_met[2]+2000,
#            ymin = bbox_area_met[3]+2000, ymax = bbox_area_met[4]-2000)+
```
:::



### Escala de colores para mapa de calor



::: {.cell}

```{.r .cell-code}
scale_fill_gradient2(
low = color$bajo, mid = color$medio, high = color$alto,
midpoint = mean(comunas_region_conteo$n),
na.value = col_mix(color$fondo, color$principal, 0.1),
limits = c(0, NA)
# breaks = cortes
)
```
:::




### Minimapa
https://dominicroye.github.io/blog/inserted-map/


::: {.cell}

:::



-->


<div style="display: flex; align-items: center; gap: 15px; padding: 14px; 
            background-color: #493365;  border-radius: 6px;
            margin: 20px 40px 20px 40px;">
  
  <div style="flex-shrink: 0;">
    <i class="fas fa-triangle-exclamation" style="font-size: 130%; margin-left: 2px; opacity: 1; color: #EAD2FA;"></i>
  </div>
  
  <aside style = "font-size: 90%; color: #EAD2FA;">
    ⚠️ Este tutorial se encuentra en construcción ⚠️
  </aside>
  
</div>
<hr>




<h2 id="recursos-para-aprender-más">Recursos para aprender más
  <a href="#recursos-para-aprender-m%c3%a1s"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="apuntes">Apuntes
  <a href="#apuntes"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><a href="sf_cheatsheet_1.jpeg" target="_blank">

  <img src="sf_cheatsheet_1.jpeg" style="border-radius: 5px; width: 80%; max-width: 700px; display: block; margin: auto; margin-bottom: 8px; margin-top: 8px;">
  
</a>
<a href="sf_cheatsheet_2.jpeg" target="_blank">

  <img src="sf_cheatsheet_2.jpeg" style="border-radius: 5px; width: 80%; max-width: 700px; display: block; margin: auto; margin-bottom: 8px; margin-top: 8px;">
  
</a></p>




<h3 id="libros">Libros
  <a href="#libros"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<ul>
<li>
<a href="https://r-spatial.org/r/2018/10/25/ggplot2-sf.html" target="_blank" rel="noopener">Drawing beautiful maps programmatically with R, sf and ggplot2</a></li>
<li>
<a href="https://bookdown.org/robinlovelace/geocompr/" target="_blank" rel="noopener">Geocomputation with R</a></li>
<li>
<a href="https://r-spatial.org/book/" target="_blank" rel="noopener">Spatial Data Science With Applications in R</a></li>
<li>
<a href="https://cengel.github.io/R-spatial/" target="_blank" rel="noopener">Using Spatial Data with R</a></li>
</ul>
 
    </section>
      
    <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
    <a class="prev dtc pr2 tl v-top fw6"
    href="http://localhost:5219/blog/2025-11-25/">&larr; Configura R para que haga cosas automáticamente al abrirlo</a>
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="http://localhost:5219/blog/elecciones_presidenciales_2025/">Visualización y scraping de resultados de las elecciones presidenciales 2025 &rarr;</a>
  
</div>

    </footer>
    
  </article>
    
    <div class="post-comments pa0 pa4-l mt4">
  
    
      <script src="https://utteranc.es/client.js"
              repo="bastianolea/blog-bastianolea-r"
              issue-term="pathname"
              theme="github-light"
              label="comments"
              crossorigin="anonymous"
              async
              type="text/javascript">
      </script>
    
  
</div>

    
</section>
  

<section class="post-body pt5 pb4">
  
  <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Fecha de publicación:</dt>
    <dd class="fw5 ml0">November 18, 2025</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Extensión:</dt>
    <dd class="fw5 ml0">19 minute read, 3974 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categorías:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:5219/categories/tutoriales">tutoriales</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Tags:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:5219/tags/mapas">mapas</a>  <a href="http://localhost:5219/tags/visualizaci%C3%B3n-de-datos">visualización de datos</a> </dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Ver también:</dt>
    
    <dd class="fw5 ml0"><a href="../../blog/app_censo_mapas/">App: visualizador de mapas comunales del Censo 2024 por manzanas</a></dd>
    
    <dd class="fw5 ml0"><a href="../../blog/mapas_censo_2024/">Visualiza datos del Censo 2024 en mapas a nivel de manzana con R</a></dd>
    
    <dd class="fw5 ml0"><a href="../../blog/elecciones_presidenciales_2025/">Visualización y scraping de resultados de las elecciones presidenciales 2025</a></dd>
    
  </dl>
</details>

</section>
</main>


<aside class="page-sidebar" role="complementary">
   
   

  <div class="blog-info ph4 pt4 pb4 pb0-l">
    

  <h1 class="f3">Blog</h1>
  <p class="f6 lh-copy measure">Tutoriales, reseñas y consejos sobre R para análisis de datos. Usa el 
<a href="https://bastianolea-buscador.share.connect.posit.cloud" target="_blank" rel="noopener">buscador</a> para encontrar publicaciones o navega los 
<a href="../../tags/">temas</a>.</p>
  

   
<h3 style="margin-bottom: 12px;">Temas:</h3>

<div style="font-size:90%;">

<div style="font-size: 90%;">
  
   
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/chile/">Chile</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/datos/">Datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/consejos/">Consejos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/visualizaci%C3%B3n-de-datos/">Visualización de datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/gr%C3%A1ficos/">Gráficos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/blog/">Blog</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/ggplot2/">Ggplot2</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/apps/">Apps</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/shiny/">Shiny</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/web-scraping/">Web scraping</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/mapas/">Mapas</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/b%C3%A1sico/">Básico</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/limpieza-de-datos/">Limpieza de datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/procesamiento-de-datos/">Procesamiento de datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/curiosidades/">Curiosidades</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/dplyr/">Dplyr</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/quarto/">Quarto</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/ciencias-sociales/">Ciencias sociales</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/inteligencia-artificial/">Inteligencia artificial</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:5219/tags/optimizaci%C3%B3n/">Optimización</a></span>
  </span>

<a href="../../tags/" style="margin-left: 3px;">y más!</a>
</div>
</div>
  
  
   
   

</div>

  
  <div id="PageTableOfContents" style="margin-top: 24px; position: sticky; top: 108px;">
        <div class="blog-info ph4 pb4 pb0-l">
        <h3 style="margin-bottom: 12px;">Índice:</h3>
          <div class="pl2 pr0 mh0" style = "font-size: 90%; margin-top: -8px; margin-left: -22px; margin-bottom: 32px;">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#carga-de-mapas">Carga de mapas</a>
      <ul>
        <li><a href="#cargar-mapas-de-cualquier-país">Cargar mapas de cualquier país</a></li>
        <li><a href="#cargar-shapes">Cargar <em>shapes</em></a></li>
      </ul>
    </li>
    <li><a href="#visualización-básica-de-mapas">Visualización básica de mapas</a></li>
    <li><a href="#operaciones-sobre-geometrías">Operaciones sobre geometrías</a>
      <ul>
        <li><a href="#calcular-centroide">Calcular centroide</a></li>
        <li><a href="#extraer-longitud-y-latitud">Extraer longitud y latitud</a></li>
        <li><a href="#calcular-buffer">Calcular buffer</a></li>
        <li><a href="#calcular-caja-de-un-polígono">Calcular caja de un polígono</a></li>
        <li><a href="#poner-un-punto-en-un-mapa">Poner un punto en un mapa</a></li>
        <li><a href="#crear-un-cuadrado">Crear un cuadrado</a></li>
        <li><a href="#crear-un-polígono-a-partir-de-coordenadas">Crear un polígono a partir de coordenadas</a></li>
        <li><a href="#recortar-un-mapa">Recortar un mapa</a></li>
        <li><a href="#mover-puntos-de-un-mapa">Mover puntos de un mapa</a></li>
      </ul>
    </li>
    <li><a href="#recursos-para-aprender-más">Recursos para aprender más</a>
      <ul>
        <li><a href="#apuntes">Apuntes</a></li>
        <li><a href="#libros">Libros</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
        </div>
    </div>
  
  

</aside>

        
          <script id="partials/analytics.html" 
  data-goatcounter="https://bastimapache.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2026 Bastián Olea Herrera, Chile
      <span class="middot-divider"></span>
      Hecho con <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source" style="color:#9069C0;">Hugo Apéro</a> 
      y <a href="https://pkgs.rstudio.com/blogdown/" style="color:#9069C0;">{blogdown}</a></span>.
      <br />
      
Basado en <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source" style="color:#9069C0;">Blogophonic</a></span>, de <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL" style="color:#9069C0;">Formspree</a>.

Sitio alojado en <a href="https://www.netlify.com" style="color:#9069C0;">Netlify</a></span>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bastianolea-buscador.share.connect.posit.cloud" title="search" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-search fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/bastianolea" title="github" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://x.com/bastimapache" title="twitter" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/bastianolea/" title="linkedin" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-linkedin fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.tiktok.com/@bastimapache" title="tiktok" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-tiktok fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/raccunnie" title="instagram" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.goodreads.com/user/show/53224910-basti-n-olea-herrera" title="goodreads" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-goodreads fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.last.fm/user/bastimapache" title="lastfm" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-lastfm fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bsky.app/profile/bastianolea.rbind.io" title="bluesky" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-bluesky fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="../../contacto/" title="envelope" 
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-envelope fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="../../about/" title="Bastián Olea: Sobre mi">Sobre mi</a>
      
      <a class="dib pv1 ph2 link" href="https://bastianolea-buscador.share.connect.posit.cloud" title="Buscador">Buscar</a>
      
      <a class="dib pv1 ph2 link" href="../../contacto/" title="Bastián Olea: Contacto">Contacto</a>
      
      <a class="dib pv1 ph2 link" href="../../tags/" title="Temas">Temas</a>
      
      <a class="dib pv1 ph2 link" href="../../clases/" title="Clases">Clases</a>
      
      <a class="dib pv1 ph2 link" href="../../code-of-conduct/" title="Bastián Olea: Código de conducta">Código de conducta</a>
      
      <a class="dib pv1 ph2 link" href="../../license/" title="Bastián Olea: Licencia">Licencia</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
