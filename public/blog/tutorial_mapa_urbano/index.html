<!DOCTYPE html>
<html lang="es-ES" dir="ltr"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=7359&amp;path=livereload" data-no-instant defer></script>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.152.2">
<title>Tutorial: Mapa de la zona urbana de la Región Metropolitana de Santiago en R | Bastián Olea</title>


<meta property="twitter:site" content="@bastimapache">
<meta property="twitter:creator" content="@bastimapache">







  
    
  
<meta name="description" content="Blog de Bastián Olea, sociólogx y analista de datos">


<meta property="og:site_name" content="Bastián Olea">
<meta property="og:title" content="Tutorial: Mapa de la zona urbana de la Región Metropolitana de Santiago en R | Bastián Olea">
<meta property="og:description" content="Blog de Bastián Olea, sociólogx y analista de datos" />
<meta property="og:type" content="page" />
<meta property="og:url" content="http://localhost:7359/blog/tutorial_mapa_urbano/" />
<meta property="og:locale" content="es-ES">




    
        <meta property="og:image" content="http://localhost:7359/blog/tutorial_mapa_urbano/featured.png" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="http://localhost:7359/blog/tutorial_mapa_urbano/featured.png" >
    
    
  
  <meta itemprop="name" content="Tutorial: Mapa de la zona urbana de la Región Metropolitana de Santiago en R">
  <meta itemprop="description" content="Este tutorial de R te explicará paso a paso a cómo obtener mapas de todo Chile usando el paquete {chilemapas} desarrollado por Mauricio Vargas, y hacer gráficos con estos mapas usando {ggplot2}.
En la primera parte veremos cómo obtener los mapas y cómo visualizar datos comunales usando mapas en R. Si necesitas una guía sobre mapas en R, revisa este post.
Luego, nos enfrentaremos a un problema común que se tiene al graficar un mapa de la Región Metropolitana de Santiago, que tiene que ver con la diferencia entre los límites comunales reales de cada comuna y los límites urbanos de las comunas. Es la diferencia entre tener un mapa de la RM que abarque sectores rurales como Paine y que llegue hasta Argentina, o un mapa que demarque la zona urbana de Santiago, aproximadamente correspondiente a la zona que atravieza el anillo de la autopista Américo Vespucio.">
  <meta itemprop="datePublished" content="2024-06-12T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-06-12T00:00:00+00:00">
  <meta itemprop="wordCount" content="2949">
  <meta itemprop="image" content="http://localhost:7359/blog/tutorial_mapa_urbano/featured.png">
  <meta itemprop="keywords" content="Mapas,Chile">
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="false" type="image/x-icon">
  <link rel="icon" href="false" type="image/x-icon">
  
  
  <link rel="stylesheet" href="../../style.main.min.8f721815d150079638fe25bf9714e71c67b8ddf7e9435d32764c3175c3e06556.css" integrity="sha256-j3IYFdFQB5Y4/iW/lxTnHGe43ffpQ10ydkwxdcPgZVY=" media="screen">
  
  
  <script src="../../panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="../../main.min.858230d8d39b17ec435a8cd8991902766cb7afe0621875ffe5fcdf376474ca6e.js" type="text/javascript"></script>
  
  <link rel="stylesheet" href="../../css/syntax.css">
</head>
<body>
      <div class="grid-container single-sidebar">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="http://localhost:7359/" title="Home">
      <img src="../../img/logo.png" class="dib db-l h2 w-auto" alt="Bastián Olea">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="../../blog/" title="Bastián Olea: Blog de R">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea.github.io/aprende_r/" title="Aprende R">Aprende R</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea.github.io/shiny_apps/" title="Apps">Apps</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea.github.io/datos_sociales/" title="Datos">Datos</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="https://bastianolea-buscador.share.connect.posit.cloud" title="Buscador">Buscar</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../clases/" title="Clases">Clases</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../categories/tutoriales/" title="Tutoriales">Tutoriales</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../blog/r_introduccion/recursos_r/" title="Recursos">Enlaces</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="../../about/" title="Bastián Olea: Sobre mi">Yo</a>
      
      
      
      <div class="dib v-mid", style = "padding: 4px; margin-top: 4px;">
        <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bastianolea-buscador.share.connect.posit.cloud" title="search" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-search fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/bastianolea" title="github" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://x.com/bastimapache" title="twitter" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/bastianolea/" title="linkedin" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-linkedin fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.tiktok.com/@bastimapache" title="tiktok" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-tiktok fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/raccunnie" title="instagram" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.goodreads.com/user/show/53224910-basti-n-olea-herrera" title="goodreads" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-goodreads fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.last.fm/user/bastimapache" title="lastfm" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-lastfm fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bsky.app/profile/bastianolea.rbind.io" title="bluesky" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-bluesky fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="../../contacto/" title="envelope" 
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-envelope fa-lg fa-fw"></i>
    </a>
  
</div>

      </div>
      
    </div>
  </nav>
</header>


                       
 

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 pr3-l">
      <header class="post-header" style="margin-top:-30px;">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">Tutorial: Mapa de la zona urbana de la Región Metropolitana de Santiago en R</h1>
        
        
        
        <div style = "display: inline-block;">  
          <p class="f7 db mv0 ttu" style = "display: inline-block;">
            12/6/2024</p>
          
          
          <span>
            




<span style="font-size: 79%; opacity: 100%; margin-left: 6px;">
<span id="fc6d5a3037bf48e3c1732a34324bbef7" title="visitas">
</span>
<script>
    var r = new XMLHttpRequest();
    r.addEventListener('load', function() {
        document.getElementById('fc6d5a3037bf48e3c1732a34324bbef7').innerText = JSON.parse(this.responseText).count_unique + ' ' + 'visitas'
    })
    r.open('GET', "https://bastimapache.goatcounter.com/counter/" + encodeURIComponent("/blog/tutorial_mapa_urbano/".replace(/(\/)?$/, '')) + '.json')
    r.send()
</script>
</span>

          </span>
        </div>
          
        
        
        
        <dl class="f6 lh-copy">
          <em><dd class="fw5 ml0"> <a href="http://localhost:7359/tags/mapas"
          style="margin-right: 2px; 
                       color: #EAD2FA; 
                       font-style: normal;
                       text-decoration: none;
                       font-size: 10pt;
                       background-color: #9069C0; 
                       border-radius: 3px; 
                       padding: 2px 6px; ">
            mapas</a>  <a href="http://localhost:7359/tags/chile"
          style="margin-right: 2px; 
                       color: #EAD2FA; 
                       font-style: normal;
                       text-decoration: none;
                       font-size: 10pt;
                       background-color: #9069C0; 
                       border-radius: 3px; 
                       padding: 2px 6px; ">
            Chile</a> </dd></em>
        </dl>
         
      
        
      
      <div class="ph0 pt3">
        

<div style="margin-top:-24px;">

    
    
    
      
    
    
    
    
    
      
      
    
  <a class="btn-links mr2 ba dib" 
  style = "background-color: #9069C0; border-radius: 4px; 
  color: #EAD2FA; font-size: 10pt;
  padding-top: 9px; padding-bottom: 6px; padding-left: 9px; padding-right: 10px; 
  margin-right: 1px; margin-top: 6px; margin-bottom: 0px;"
  href="https://github.com/bastianolea/tutorial_r_mapa_urbano_rm" target="_blank" rel="noopener"><i class="fab fa-github fa-lg fa-fw mr2"></i>código</a>

    
    
    
      
    
    
    
    
    
      
      
    
  <a class="btn-links mr2 ba dib" 
  style = "background-color: #9069C0; border-radius: 4px; 
  color: #EAD2FA; font-size: 10pt;
  padding-top: 9px; padding-bottom: 6px; padding-left: 9px; padding-right: 10px; 
  margin-right: 1px; margin-top: 6px; margin-bottom: 0px;"
  href="https://github.com/pachadotdev/chilemapas" target="_blank" rel="noopener"><i class="fas fa-registered fa-lg fa-fw mr2"></i>chilemapas</a>

</div>

      </div>
      
      
    </header>
      
      
    <section class="post-body pt5 pb4">
        <p>Este tutorial de R te explicará paso a paso a cómo obtener mapas de todo Chile usando el paquete 
<a href="https://github.com/pachadotdev/chilemapas" target="_blank" rel="noopener"><code>{chilemapas}</code> desarrollado por Mauricio Vargas</a>, y hacer gráficos con estos mapas usando <code>{ggplot2}</code>.</p>
<p>En la primera parte veremos cómo <strong>obtener los mapas</strong> y cómo <strong>visualizar datos comunales</strong> usando mapas en R. Si necesitas una guía sobre mapas en R, 
<a href="../../../blog/mapas_sf/">revisa este post.</a></p>
<p>Luego, nos enfrentaremos a un problema común que se tiene al graficar un mapa de la Región Metropolitana de Santiago, que tiene que ver con la diferencia entre los límites comunales reales de cada comuna y los <strong>límites urbanos</strong> de las comunas. Es la diferencia entre tener un mapa de la RM que abarque sectores rurales como Paine y que llegue hasta Argentina, o un mapa que demarque la zona urbana de Santiago, aproximadamente correspondiente a la zona que atravieza el anillo de la autopista Américo Vespucio.</p>
<p>Con un mapa de la superficie urbana de la Región Metropolitana, obtenemos una figura que es más familiar al habitante promedio de la región, y que es la que usalmente vemos en la cotidianeidad, en contraste con un mapa geográficamente correcto de todo el territorio regional.</p>
<div style = "margin-left: -16px;">
  
  <details closed id="PageTableOfContents">
    <summary>
      <h2 class="mv0 f5 fw7 ttu tracked dib" style = "margin-left: 6px; font-size: 120%;">Índice</h2>
      </summary>
    <div class="pl2 pr0 mh0" style = "font-size: 90%; margin-top: -8px; margin-left: 16px; margin-bottom: 32px;">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introducción">Introducción</a>
      <ul>
        <li><a href="#paquetes">Paquetes</a></li>
        <li><a href="#obtener-un-mapa-regional">Obtener un mapa regional</a></li>
      </ul>
    </li>
    <li><a href="#visualización">Visualización</a>
      <ul>
        <li><a href="#mapa-básico-de-la-región">Mapa básico de la región</a></li>
        <li><a href="#mapa-de-la-región-con-datos-ficticios">Mapa de la región con datos ficticios</a></li>
        <li><a href="#agregar-datos-obtenidos-desde-internet-al-mapa">Agregar datos obtenidos desde internet al mapa</a></li>
        <li><a href="#visualizar-datos">Visualizar datos</a></li>
      </ul>
    </li>
    <li><a href="#mapa-urbano-de-la-región-metropolitana">Mapa urbano de la región Metropolitana</a>
      <ul>
        <li></li>
        <li><a href="#excluir-islas-urbanas">Excluir islas urbanas</a></li>
        <li><a href="#visualizar-datos-en-el-mapa-urbano">Visualizar datos en el mapa urbano</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </details>
  
</div>




<h2 id="introducción">Introducción
  <a href="#introducci%c3%b3n"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="paquetes">Paquetes
  <a href="#paquetes"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Primero cargamos los paquetes que usaremos en este tutorial. Si no tienes alguno de ellos, intálalo con <code>install.packages()</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># datos</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span> <span class="c1">#manipulación de datos</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">janitor</span><span class="p">)</span> <span class="c1">#limpieza de datos</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span> <span class="c1">#manipulación de texto</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># mapas</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">chilemapas</span><span class="p">)</span> <span class="c1">#mapas de chile</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span> <span class="c1">#manipulación de mapas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># gráficos</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span> <span class="c1">#visualización de datos</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">viridis</span><span class="p">)</span> <span class="c1">#escalas de colores</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span> <span class="c1">#escalas numéricas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># web scraping</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span> <span class="c1">#obtener datos desde páginas de internet</span>
</span></span></code></pre></div>



<h3 id="obtener-un-mapa-regional">Obtener un mapa regional
  <a href="#obtener-un-mapa-regional"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Primero, usaremos <code>{chilemapas}</code> para obtener los datos geográficos (polígonos o shapes) necesarios para producir un mapa de la Región Metropolitana:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># obtener mapa comunal</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_comunas</span> <span class="o">&lt;-</span> <span class="n">chilemapas</span><span class="o">::</span><span class="n">mapa_comunas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">nombres_comunas</span> <span class="o">&lt;-</span> <span class="n">chilemapas</span><span class="o">::</span><span class="n">codigos_territoriales</span> <span class="o">|&gt;</span> <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#34;comuna&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># mapa de la región metropolitana</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa</span> <span class="o">&lt;-</span> <span class="n">mapa_comunas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># especificar la geometría</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_set_geometry</span><span class="p">(</span><span class="n">mapa_comunas</span><span class="o">$</span><span class="n">geometry</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># agregar nombres de comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">left_join</span><span class="p">(</span><span class="n">nombres_comunas</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;codigo_comuna&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># filtrar la región metropolitana</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">codigo_region</span> <span class="o">==</span> <span class="s">&#34;13&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa</span>
</span></span></code></pre></div><pre><code>Simple feature collection with 52 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -71.71523 ymin: -34.29093 xmax: -69.76999 ymax: -32.92194
Geodetic CRS:  SIRGAS 2000
# A tibble: 52 × 5
   codigo_comuna codigo_provincia codigo_region                         geometry
 * &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;                       &lt;MULTIPOLYGON [°]&gt;
 1 13404         134              13            (((-70.61396 -33.73862, -70.609…
 2 13402         134              13            (((-70.61396 -33.73862, -70.623…
 3 13124         131              13            (((-70.75679 -33.38348, -70.780…
 4 13103         131              13            (((-70.72154 -33.43661, -70.724…
 5 13301         133              13            (((-70.37256 -33.10578, -70.376…
 6 13303         133              13            (((-70.72028 -32.95297, -70.723…
 7 13302         133              13            (((-70.79191 -33.17296, -70.783…
 8 13107         131              13            (((-70.59589 -33.33656, -70.590…
 9 13104         131              13            (((-70.68968 -33.36587, -70.682…
10 13504         135              13            (((-71.27576 -33.40409, -71.263…
# ℹ 42 more rows
# ℹ 1 more variable: nombre_comuna &lt;chr&gt;
</code></pre>
<p>Podemos ver que obtuvimos un <em>dataframe</em> donde cada fila es una comuna, individualizada por su nombre y su código único territorial (<code>codigo_comuna</code>).</p>
<p>En esta tabla de datos, la columna <code>geometry</code> contiene la información geográfica de cada comuna, lo que permite visualizarlas como un mapa.</p>
<p>Por lo tanto, en cada fila tenemos información geográfica que representa polígonos comunales, donde cada polígono (o conjuto de polígonos) se corresponde con los datos existentes en las demás columnas, que pueden ser información como sus nombres, su población, o cualquier otra.</p>




<h2 id="visualización">Visualización
  <a href="#visualizaci%c3%b3n"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="mapa-básico-de-la-región">Mapa básico de la región
  <a href="#mapa-b%c3%a1sico-de-la-regi%c3%b3n"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Podemos visualizar este mapa de manera con <code>{ggplot2}</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># iniciar gráfico</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># agregar capa con el mapa</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey60&#34;</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># tema</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_prueba-1.png" width="768" />
<p>Obtuvimos un mapa básico de todas las comunas de la Región Metropolitana de Santiago.</p>




<h3 id="mapa-de-la-región-con-datos-ficticios">Mapa de la región con datos ficticios
  <a href="#mapa-de-la-regi%c3%b3n-con-datos-ficticios"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Ahora, hagamos una prueba para aprender a visualizar datos en la di este mapa. Para esto, crearemos una nueva variable donde algunas comunas tengan valores distintos. Podemos crear la nueva variable a partir de la columna <code>nombre_comuna</code>, aunque siempre es preferible hacerlo en base a la columna <code>codigo_comuna</code>, dado que los códigos únicos territoriales son identificadores únicos para cada comuna, mientras que los nombres de las comunas son más impredecibles (por ejemplo, pueden venir sin tilde, pueden venir en mayúsculas, o derechamente mal escritos).</p>
<p>Usamos la función <code>case_when()</code> para asignar valores ficticios sobre algunas comunas, y los visualizamos en el mapa:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_datos</span> <span class="o">&lt;-</span> <span class="n">mapa</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># crear una variable para comunas específicas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">variable</span> <span class="o">=</span> <span class="nf">case_when</span><span class="p">(</span><span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;Paine&#34;</span> <span class="o">~</span> <span class="s">&#34;Bacán&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;Buin&#34;</span> <span class="o">~</span> <span class="s">&#34;Penca&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;La Florida&#34;</span> <span class="o">~</span> <span class="s">&#34;Bacán&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;Cerrillos&#34;</span> <span class="o">~</span> <span class="s">&#34;Bacán&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;Nunoa&#34;</span> <span class="o">~</span> <span class="s">&#34;Penca&#34;</span><span class="p">))</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">select</span><span class="p">(</span><span class="n">nombre_comuna</span><span class="p">,</span> <span class="n">codigo_comuna</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa_datos</span>
</span></span></code></pre></div><pre><code>Simple feature collection with 52 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -71.71523 ymin: -34.29093 xmax: -69.76999 ymax: -32.92194
Geodetic CRS:  SIRGAS 2000
# A tibble: 52 × 4
   nombre_comuna codigo_comuna variable                                 geometry
   &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;                          &lt;MULTIPOLYGON [°]&gt;
 1 Paine         13404         Bacán    (((-70.61396 -33.73862, -70.60917 -33.7…
 2 Buin          13402         Penca    (((-70.61396 -33.73862, -70.62304 -33.7…
 3 Pudahuel      13124         &lt;NA&gt;     (((-70.75679 -33.38348, -70.78087 -33.4…
 4 Cerro Navia   13103         &lt;NA&gt;     (((-70.72154 -33.43661, -70.72426 -33.4…
 5 Colina        13301         &lt;NA&gt;     (((-70.37256 -33.10578, -70.37609 -33.1…
 6 Tiltil        13303         &lt;NA&gt;     (((-70.72028 -32.95297, -70.72329 -32.9…
 7 Lampa         13302         &lt;NA&gt;     (((-70.79191 -33.17296, -70.7833 -33.18…
 8 Huechuraba    13107         &lt;NA&gt;     (((-70.59589 -33.33656, -70.59023 -33.3…
 9 Conchali      13104         &lt;NA&gt;     (((-70.68968 -33.36587, -70.68201 -33.3…
10 Maria Pinto   13504         &lt;NA&gt;     (((-71.27576 -33.40409, -71.26337 -33.4…
# ℹ 42 more rows
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># visualizar</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_datos</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">variable</span><span class="p">)</span> <span class="o">+</span> <span class="c1">#usamos la variable que creamos como relleno de las comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_fill_manual-1.png" width="768" />




<h3 id="agregar-datos-obtenidos-desde-internet-al-mapa">Agregar datos obtenidos desde internet al mapa
  <a href="#agregar-datos-obtenidos-desde-internet-al-mapa"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Ahora, pasaremos a usar datos reales sobre nuestro mapa comunal. Pero en vez de entregarles datos copiados y pegados, obtendremos directamente los datos desde internet, 
<a href="../../../blog/tutorial_scraping_rvest/">usando el paquete <code>{rvest}</code></a> que sirve para hacer 
<a href="../../../blog/r_introduccion/web_scraping/">web scraping</a> desde páginas web; es decir, descargar datos presentes en sitios de internet para usarlos directamente en R.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tabla_comunas</span> <span class="o">&lt;-</span> <span class="nf">session</span><span class="p">(</span><span class="s">&#34;https://es.wikipedia.org/wiki/Anexo:Comunas_de_Chile&#34;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="c1"># sitio web que scrapearemos</span>
</span></span><span class="line"><span class="cl">  <span class="nf">read_html</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="c1"># leemos el contenido del sitio web </span>
</span></span><span class="line"><span class="cl">  <span class="nf">html_table</span><span class="p">()</span> <span class="c1"># extraemos las tablas del sitio web</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tabla_comunas_2</span> <span class="o">&lt;-</span> <span class="n">tabla_comunas[[1]]</span> <span class="o">|&gt;</span> <span class="c1"># elegimos la primera tabla obtenida</span>
</span></span><span class="line"><span class="cl">  <span class="nf">clean_names</span><span class="p">()</span> <span class="c1"># limpiamos los nombres de la tabla usando {janitor}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tabla_comunas_3</span> <span class="o">&lt;-</span> <span class="n">tabla_comunas_2</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">region</span> <span class="o">==</span> <span class="s">&#34;Metropolitana de Santiago&#34;</span><span class="p">)</span> <span class="c1"># filtrar la región</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">tabla_comunas_4</span> <span class="o">&lt;-</span> <span class="n">tabla_comunas_3</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># convertir los códigos comunales a texto</span>
</span></span><span class="line"><span class="cl">  <span class="nf">rename</span><span class="p">(</span><span class="n">codigo_comuna</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">codigo_comuna</span> <span class="o">=</span> <span class="nf">as.character</span><span class="p">(</span><span class="n">codigo_comuna</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">datos_comunas</span> <span class="o">&lt;-</span> <span class="n">tabla_comunas_4</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># limpiar variables numéricas para estén disponibles en formato numérico en vez de como texto</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">poblacion2020</span> <span class="o">=</span> <span class="nf">str_remove</span><span class="p">(</span><span class="n">poblacion2020</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">),</span> <span class="c1"># borrar espacios</span>
</span></span><span class="line"><span class="cl">         <span class="n">poblacion2020</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">poblacion2020</span><span class="p">))</span> <span class="o">|&gt;</span>  <span class="c1"># transformar texto a numérico</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># corregir superficie</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">superficie_km2</span> <span class="o">=</span> <span class="nf">str_remove</span><span class="p">(</span><span class="n">superficie_km2</span><span class="p">,</span> <span class="s">&#34;\\.&#34;</span><span class="p">),</span> <span class="c1"># borrar puntos separadores de miles</span>
</span></span><span class="line"><span class="cl">         <span class="n">superficie_km2</span> <span class="o">=</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">superficie_km2</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="c1"># reemplazar comas por puntos</span>
</span></span><span class="line"><span class="cl">         <span class="n">superficie_km2</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">superficie_km2</span><span class="p">))</span> <span class="o">|&gt;</span> <span class="c1"># transformar texto a numérico</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># corregir densidad</span>
</span></span><span class="line"><span class="cl">  <span class="nf">mutate</span><span class="p">(</span><span class="n">densidad_hab_km2</span> <span class="o">=</span> <span class="nf">str_remove_all</span><span class="p">(</span><span class="n">densidad_hab_km2</span><span class="p">,</span> <span class="s">&#34;\\.&#34;</span><span class="p">),</span> <span class="c1"># borrar puntos separadores de miles</span>
</span></span><span class="line"><span class="cl">         <span class="n">densidad_hab_km2</span> <span class="o">=</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">densidad_hab_km2</span><span class="p">,</span> <span class="s">&#34;,&#34;</span><span class="p">,</span> <span class="s">&#34;.&#34;</span><span class="p">),</span> <span class="c1"># reemplazar comas por puntos</span>
</span></span><span class="line"><span class="cl">         <span class="n">densidad_hab_km2</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="n">densidad_hab_km2</span><span class="p">))</span> <span class="c1"># transformar texto a numérico</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">datos_comunas</span>
</span></span></code></pre></div><pre><code># A tibble: 52 × 12
   codigo_comuna nombre      x     provincia region superficie_km2 poblacion2020
   &lt;chr&gt;         &lt;chr&gt;       &lt;lgl&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;         &lt;dbl&gt;
 1 13101         Santiago    NA    Santiago  Metro…            232        503147
 2 13102         Cerrillos   NA    Santiago  Metro…             21         88956
 3 13103         Cerro Navia NA    Santiago  Metro…             11        142465
 4 13104         Conchalí    NA    Santiago  Metro…            107        139195
 5 13105         El Bosque   NA    Santiago  Metro…            142        172000
 6 13106         Estación C… NA    Santiago  Metro…             15        206792
 7 13107         Huechuraba  NA    Santiago  Metro…            448        112528
 8 13108         Independen… NA    Santiago  Metro…              7        142065
 9 13109         La Cisterna NA    Santiago  Metro…             10        100434
10 13110         La Florida  NA    Santiago  Metro…            702        402433
# ℹ 42 more rows
# ℹ 5 more variables: densidad_hab_km2 &lt;dbl&gt;, idh_2005 &lt;chr&gt;, idh_2005_2 &lt;chr&gt;,
#   latitud &lt;chr&gt;, longitud &lt;chr&gt;
</code></pre>
<p>Así quedó el resultado de nuestro web scraping. A continuación, 
<a href="../../../blog/left_join/">usamos la función <code>left_join()</code></a> para adjuntar estas columnas nuevas a nuestro data frame que contiene los nombres y códigos de las comunas, además de la geometría o información geográfica de las comunas, usando como columna de unión los códigos comunales:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_datos_2</span> <span class="o">&lt;-</span> <span class="n">mapa</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">left_join</span><span class="p">(</span><span class="n">datos_comunas</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;codigo_comuna&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">glimpse</span><span class="p">(</span><span class="n">mapa_datos_2</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>Rows: 52
Columns: 16
$ codigo_comuna    &lt;chr&gt; &quot;13404&quot;, &quot;13402&quot;, &quot;13124&quot;, &quot;13103&quot;, &quot;13301&quot;, &quot;13303&quot;,…
$ codigo_provincia &lt;chr&gt; &quot;134&quot;, &quot;134&quot;, &quot;131&quot;, &quot;131&quot;, &quot;133&quot;, &quot;133&quot;, &quot;133&quot;, &quot;131…
$ codigo_region    &lt;chr&gt; &quot;13&quot;, &quot;13&quot;, &quot;13&quot;, &quot;13&quot;, &quot;13&quot;, &quot;13&quot;, &quot;13&quot;, &quot;13&quot;, &quot;13&quot;,…
$ geometry         &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-70.61396 -..., MULTIPOL…
$ nombre_comuna    &lt;chr&gt; &quot;Paine&quot;, &quot;Buin&quot;, &quot;Pudahuel&quot;, &quot;Cerro Navia&quot;, &quot;Colina&quot;,…
$ nombre           &lt;chr&gt; &quot;Paine&quot;, &quot;Buin&quot;, &quot;Pudahuel&quot;, &quot;Cerro Navia&quot;, &quot;Colina&quot;,…
$ x                &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ provincia        &lt;chr&gt; &quot;Maipo&quot;, &quot;Maipo&quot;, &quot;Santiago&quot;, &quot;Santiago&quot;, &quot;Chacabuco&quot;…
$ region           &lt;chr&gt; &quot;Metropolitana de Santiago&quot;, &quot;Metropolitana de Santia…
$ superficie_km2   &lt;dbl&gt; 820, 214, 197, 11, 9712, 653, 452, 448, 107, 3935, 69…
$ poblacion2020    &lt;dbl&gt; 82766, 109641, 253139, 142465, 180353, 21477, 126898,…
$ densidad_hab_km2 &lt;dbl&gt; 1009.0, 512.3, 1284.9, 12951.3, 185.7, 328.0, 280.7, …
$ idh_2005         &lt;chr&gt; &quot;0.718&quot;, &quot;0.731&quot;, &quot;0.735&quot;, &quot;0.683&quot;, &quot;0.726&quot;, &quot;0.709&quot;,…
$ idh_2005_2       &lt;chr&gt; &quot;Alto&quot;, &quot;Alto&quot;, &quot;Alto&quot;, &quot;Medio&quot;, &quot;Alto&quot;, &quot;Alto&quot;, &quot;Med…
$ latitud          &lt;chr&gt; &quot;-33°48'43.2\&quot;&quot;, &quot;-33°43'40.8\&quot;&quot;, &quot;-33°26'0\&quot;&quot;, &quot;-33°…
$ longitud         &lt;chr&gt; &quot;-70°43'22.8\&quot;&quot;, &quot;-70°44'20.4\&quot;&quot;, &quot;-70°43'0\&quot;&quot;, &quot;-70°…
</code></pre>
<p>Lo que hicimos en la operación anterior fue 
<a href="../../../blog/left_join/">unir dos tablas distintas en base a una variable común</a> que ambas tablas poseen: <code>codigo_comuna</code>. De este modo, obtenemos un nuevo data frame que contiene tanto la información geográfica como los datos comunales que necesitamos.</p>
<p>Habiendo hecho esto, ahora podemos crear gráficos comunales usando cualquier variable que queramos, siempre y cuando podamos hacer coincidir los datos con el mapa en base a los códigos comunales o los nombres de comuna.</p>




<h3 id="visualizar-datos">Visualizar datos
  <a href="#visualizar-datos"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>




<h4 id="mapa-comunal-de-población">Mapa comunal de población
  <a href="#mapa-comunal-de-poblaci%c3%b3n"></a>
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_datos_2</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">poblacion2020</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">col</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="n">viridis</span><span class="o">::</span><span class="nf">scale_fill_viridis</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="nf">label_number</span><span class="p">(</span><span class="n">big.mark</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="n">decimal.mark</span> <span class="o">=</span> <span class="s">&#34;,&#34;</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Población&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_fill_continuo-1.png" width="768" />




<h4 id="mapa-comunal-del-índice-de-desarrollo-humano">Mapa comunal del índice de desarrollo humano
  <a href="#mapa-comunal-del-%c3%adndice-de-desarrollo-humano"></a>
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_datos_2</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">              <span class="n">fill</span> <span class="o">=</span> <span class="n">idh_2005_2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">col</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Medio&#34;</span><span class="p">,</span> <span class="s">&#34;Alto&#34;</span><span class="p">,</span> <span class="s">&#34;Muy alto&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Medio&#34;</span> <span class="o">=</span> <span class="s">&#34;olivedrab4&#34;</span><span class="p">,</span> <span class="s">&#34;Alto&#34;</span> <span class="o">=</span> <span class="s">&#34;olivedrab3&#34;</span><span class="p">,</span> <span class="s">&#34;Muy alto&#34;</span> <span class="o">=</span> <span class="s">&#34;olivedrab2&#34;</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">nombre_comuna</span><span class="p">),</span> <span class="n">check_overlap</span> <span class="o">=</span> <span class="bp">T</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;IDH&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not
give correct results for longitude/latitude data
</code></pre>
<img src="index.markdown_strict_files/figure-markdown_strict/region_fill_categorico-1.png" width="768" />
<p>Sin embargo, podemos ver que estos mapas no se ajustan perfectamente a la imagen mental que tiene un ciudadano común acerca de cómo se ve la Región Metropolitana. Por ejemplo, vemos cómo la comuna de San José de Maipo abarca una superficie enorme dado que limita en la cordillera de los Andes con Argentina, o que comunas como Lo Barnechea se expanden hacia superficies cordilleranas de gran extensión.</p>
<p>Esto se debe a que ususalmente nos encontramos frente a mapas que representan el &ldquo;Gran Santiago&rdquo;, es decir, sólo la superficie urbana de las comunas urbanas de la región, omitiendo sectores rurales, cordilleranos o deshabitados.</p>
<p>Por lo tanto, a continuación veremos cómo obtener un mapa urbano de la Región Metropolitana de Santiago.</p>




<h2 id="mapa-urbano-de-la-región-metropolitana">Mapa urbano de la región Metropolitana
  <a href="#mapa-urbano-de-la-regi%c3%b3n-metropolitana"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>En los siguientes pasos, pasaremos de un mapa comunal a un mapa comunal urbano; es decir, un mapa que <strong>sólo considere la superficie urbana de las comunas</strong>, en vez de la superficie total de las comunas.</p>
<p>Usando <code>{chilemapas}</code>, podemos obtener un mapa de la Región Metropolitana con un nivel de detalle mayor, que divide internamente las comunas en superficies más pequeñas que sólo corresponden a zonas urbanas:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># obtener mapa por zonas rural/urbano</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_zonas_urbanas</span> <span class="o">&lt;-</span> <span class="n">chilemapas</span><span class="o">::</span><span class="n">mapa_zonas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># definir geometrías</span>
</span></span><span class="line"><span class="cl">  <span class="nf">st_set_geometry</span><span class="p">(</span><span class="n">chilemapas</span><span class="o">::</span><span class="n">mapa_zonas</span><span class="o">$</span><span class="n">geometry</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># filtrar región</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">codigo_region</span> <span class="o">==</span> <span class="m">13</span><span class="p">)</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># agregar nombres de comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">left_join</span><span class="p">(</span><span class="n">chilemapas</span><span class="o">::</span><span class="n">codigos_territoriales</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">              <span class="nf">select</span><span class="p">(</span><span class="nf">matches</span><span class="p">(</span><span class="s">&#34;comuna&#34;</span><span class="p">)))</span>
</span></span></code></pre></div><pre><code>Joining with `by = join_by(codigo_comuna)`
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># mapa de zonas urbanas</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_zonas_urbanas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey60&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_zonas-1.png" width="768" />
<p>Podemos mejorar esta visualización <strong>uniendo</strong> con <code>st_union()</code> las zonas urbanas intra-comunales en sus respectivas comunas, para volver a obtener un mapa comunal, pero que recorta las comunas para que sólo consideren su la superficie urbana de cada una:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># mapa de zonas urbanas</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_zonas_urbanas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># unir polígonos por comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">nombre_comuna</span><span class="p">,</span> <span class="n">codigo_comuna</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">st_union</span><span class="p">(</span><span class="n">geometry</span><span class="p">),</span> <span class="n">.groups</span> <span class="o">=</span> <span class="s">&#34;drop&#34;</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># visualizar</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey60&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_zonas_comunas-1.png" width="768" />
<p>De inmediato, podemos ver que emerge una figura más familiar de lo que es el <em>Gran Santiago,</em> pero ahora tenemos otro problema: el mapa también contiene las zonas urbanas de comunas menos céntricas de la región, tales como Buin, Curacaví, Talagante y otras. Esto se debe a que nuestro mapa aún contiene comunas que no son mayoritariamente urbanas, dado que poseen sectores despoblados o de actividad agrícola, minera u otras, y que por consiguiente dan una apariencia discontinua a nuestro mapa.</p>
<p>Para resolver esto y dejar sólo las comunas urbanas del Gran Santiago, tenemos varias opciones: podemos filtrar específicamente las comunas que queremos, o bien, podemos filtrar en base a privincias, dejando sólo las provincias Santiago y Cordillera.</p>




<h4 id="definir-contorno-urbano-por-comunas-exactas">Definir contorno urbano por comunas exactas
  <a href="#definir-contorno-urbano-por-comunas-exactas"></a>
</h4>
<p><strong>Opción 1:</strong> seleccionar específicamente las comunas que queremos incluir:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">comunas_urbanas</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;Pudahuel&#34;</span><span class="p">,</span> <span class="s">&#34;Cerro Navia&#34;</span><span class="p">,</span> <span class="s">&#34;Conchali&#34;</span><span class="p">,</span> <span class="s">&#34;La Pintana&#34;</span><span class="p">,</span> <span class="s">&#34;El Bosque&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;Estacion Central&#34;</span><span class="p">,</span> <span class="s">&#34;Pedro Aguirre Cerda&#34;</span><span class="p">,</span> <span class="s">&#34;Recoleta&#34;</span><span class="p">,</span> <span class="s">&#34;Independencia&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;La Florida&#34;</span><span class="p">,</span> <span class="s">&#34;Penalolen&#34;</span><span class="p">,</span> <span class="s">&#34;Las Condes&#34;</span><span class="p">,</span> <span class="s">&#34;Lo Barnechea&#34;</span><span class="p">,</span> <span class="s">&#34;Quinta Normal&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;Maipu&#34;</span><span class="p">,</span> <span class="s">&#34;Macul&#34;</span><span class="p">,</span> <span class="s">&#34;Nunoa&#34;</span><span class="p">,</span> <span class="s">&#34;Puente Alto&#34;</span><span class="p">,</span> <span class="s">&#34;Quilicura&#34;</span><span class="p">,</span> <span class="s">&#34;Renca&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;San Bernardo&#34;</span><span class="p">,</span> <span class="s">&#34;San Miguel&#34;</span><span class="p">,</span> <span class="s">&#34;La Granja&#34;</span><span class="p">,</span> <span class="s">&#34;Providencia&#34;</span><span class="p">,</span> <span class="s">&#34;Santiago&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;San Joaquin&#34;</span><span class="p">,</span> <span class="s">&#34;Lo Espejo&#34;</span><span class="p">,</span> <span class="s">&#34;La Reina&#34;</span><span class="p">,</span> <span class="s">&#34;San Ramon&#34;</span><span class="p">,</span> <span class="s">&#34;La Cisterna&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;Lo Prado&#34;</span><span class="p">,</span> <span class="s">&#34;Cerrillos&#34;</span><span class="p">,</span> <span class="s">&#34;Vitacura&#34;</span><span class="p">,</span> <span class="s">&#34;Huechuraba&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="s">&#34;San Jose de Maipo&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># mapa de sectores urbanos, de comunas urbanas</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_zonas_urbanas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># filtrar comunas urbanas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">nombre_comuna</span> <span class="o">%in%</span> <span class="n">comunas_urbanas</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># unir polígonos por comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">nombre_comuna</span><span class="p">,</span> <span class="n">codigo_comuna</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">st_union</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># graficar</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey60&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>`summarise()` has grouped output by 'nombre_comuna'. You can override using the
`.groups` argument.
</code></pre>
<img src="index.markdown_strict_files/figure-markdown_strict/region_urbano_opcion1-1.png" width="768" />




<h4 id="definir-contorno-urbano-en-base-a-provincias">Definir contorno urbano en base a provincias
  <a href="#definir-contorno-urbano-en-base-a-provincias"></a>
</h4>
<p><strong>Opción 2:</strong> seleccionar las dos provincias que conforman el Gran Santiago, y agregar los ajustes que sean necesarios (incluir San Bernardo, excluir Pirque)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_zonas_urbanas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># dejar solo dos provincias, incluir San Bernardo y sacar Pirque</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">codigo_provincia</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="m">131</span><span class="p">,</span> <span class="m">132</span><span class="p">)</span> <span class="o">|</span> <span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;San Bernardo&#34;</span><span class="p">,</span> <span class="n">nombre_comuna</span> <span class="o">!=</span> <span class="s">&#34;Pirque&#34;</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># unir polígonos por comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">nombre_comuna</span><span class="p">,</span> <span class="n">codigo_comuna</span><span class="p">)</span> <span class="o">%&gt;%</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">st_union</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># graficar</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey60&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>`summarise()` has grouped output by 'nombre_comuna'. You can override using the
`.groups` argument.
</code></pre>
<img src="index.markdown_strict_files/figure-markdown_strict/region_urbano_opcion2-1.png" width="768" />
<p>La decisión que tomes depende de los objetivos del usuario y de tu visualzación, pero dejo ambas aproximaciones a modo de aprendizaje.</p>




<h3 id="excluir-islas-urbanas">Excluir islas urbanas
  <a href="#excluir-islas-urbanas"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Luego de haber seleccionado las comunas urbanas que necesitamos, notamos que aún quedan algunas &ldquo;islas urbanas&rdquo; fuera de la zona principal del Gran Santiago. Usualmente vemos los mapas del Gran Santiago como una sola unidad geográfica contínua, sin separaciones ni islas a su alrededor. Por lo tanto, vamos a eliminar estos elementos externos a la superficie urbana contínua de forma manual.</p>
<p>Para identificar los polígonos que queramos remover, podemos visualizar una fracción del mapa y agregar etiquetas para dar con sus códigos geográficos, y así poder excluirlos. Por ejemplo, aquí lo haremos con Pudahuel:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mapa_zonas_urbanas</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">nombre_comuna</span> <span class="o">==</span> <span class="s">&#34;Pudahuel&#34;</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;lightblue&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">geocodigo</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>Warning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not
give correct results for longitude/latitude data
</code></pre>
<img src="index.markdown_strict_files/figure-markdown_strict/prueba_islas-1.png" width="768" />
<p>Bastaría con anotar los geocódigos para filtrarlos.</p>
<p>Entonces, en el siguiente paso removeremos estas pequeñas zonas urbanas de forma manual para obtener un mapa más contínuo.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># vector con geocódigos que deseamor remover</span>
</span></span><span class="line"><span class="cl"><span class="n">islas_urbanas</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;13124071004&#34;</span><span class="p">,</span> <span class="s">&#34;13124071005&#34;</span><span class="p">,</span> <span class="s">&#34;13124081001&#34;</span><span class="p">,</span> <span class="s">&#34;13124071001&#34;</span><span class="p">,</span> <span class="s">&#34;13124071002&#34;</span><span class="p">,</span> <span class="s">&#34;13124071003&#34;</span><span class="p">,</span> <span class="c1">#Pudahuel</span>
</span></span><span class="line"><span class="cl">                   <span class="s">&#34;13401121001&#34;</span><span class="p">,</span> <span class="c1">#San Bernardo</span>
</span></span><span class="line"><span class="cl">                   <span class="s">&#34;13119131001&#34;</span><span class="p">,</span> <span class="c1">#Maipú</span>
</span></span><span class="line"><span class="cl">                   <span class="s">&#34;13203031000&#34;</span><span class="p">,</span> <span class="s">&#34;13203031001&#34;</span><span class="p">,</span> <span class="s">&#34;13203031002&#34;</span><span class="p">,</span> <span class="s">&#34;13203011001&#34;</span><span class="p">,</span> <span class="s">&#34;13203011002&#34;</span> <span class="c1">#San José de Maipo</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># crear nuevo mapa</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_urbano</span> <span class="o">&lt;-</span> <span class="n">mapa_zonas_urbanas</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="c1"># filtrar solo comunas urbanas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="n">nombre_comuna</span> <span class="o">%in%</span> <span class="n">comunas_urbanas</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># filtrar islas urbanas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">filter</span><span class="p">(</span><span class="o">!</span><span class="n">geocodigo</span> <span class="o">%in%</span> <span class="n">islas_urbanas</span><span class="p">)</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># unir comunas</span>
</span></span><span class="line"><span class="cl">  <span class="nf">group_by</span><span class="p">(</span><span class="n">nombre_comuna</span><span class="p">,</span> <span class="n">codigo_comuna</span><span class="p">)</span> <span class="o">%&gt;%</span>
</span></span><span class="line"><span class="cl">  <span class="nf">summarise</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="nf">st_union</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span> <span class="o">|&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ungroup</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>`summarise()` has grouped output by 'nombre_comuna'. You can override using the
`.groups` argument.
</code></pre>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># simplificar bordes del mapa (opcional)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># mutate(geometry = rmapshaper::ms_simplify(geometry,  keep = 0.4))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># graficar</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_urbano</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;blueviolet&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/remover_islas-1.png" width="768" />
<p>De esta forma ya logramos graficar un mapa del Gran Santiago mucho más definido y limpio.</p>




<h3 id="visualizar-datos-en-el-mapa-urbano">Visualizar datos en el mapa urbano
  <a href="#visualizar-datos-en-el-mapa-urbano"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Teniendo este mapa, procedemos a visualizar nuestros datos tal como hicimos al principio de este tutorial:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># volvemos a adjuntar los datos que descargamos usando web scraping, esta vez al mapa nuevo</span>
</span></span><span class="line"><span class="cl"><span class="n">mapa_urbano_2</span> <span class="o">&lt;-</span> <span class="n">mapa_urbano</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">left_join</span><span class="p">(</span><span class="n">datos_comunas</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s">&#34;codigo_comuna&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mapa_urbano_2</span> <span class="o">|&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">densidad_hab_km2</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="n">viridis</span><span class="o">::</span><span class="nf">scale_fill_viridis</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="nf">label_number</span><span class="p">(</span><span class="n">big.mark</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="n">decimal.mark</span> <span class="o">=</span> <span class="s">&#34;,&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">option</span> <span class="o">=</span> <span class="s">&#34;magma&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Densidad poblacional&#34;</span><span class="p">)</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_urbana_fill_continuo-1.png" width="768" />
<p>Finalmente, podemos poner nuestro nuevo mapa urbano de la Región Metropolitana de Santiago sobre el mapa de la región completa:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey95&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa_urbano_2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">poblacion2020</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="n">viridis</span><span class="o">::</span><span class="nf">scale_fill_viridis</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="nf">label_number</span><span class="p">(</span><span class="n">big.mark</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="n">decimal.mark</span> <span class="o">=</span> <span class="s">&#34;,&#34;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                              <span class="n">option</span> <span class="o">=</span> <span class="s">&#34;mako&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Población&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">guides</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="nf">guide_colourbar</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="s">&#34;inside&#34;</span><span class="p">))</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position.inside</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">.1</span><span class="p">,</span> <span class="m">.7</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.key.width</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.key.height</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.ticks.length</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">0.4</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">))</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_urbana_fill_continuo_contexto-1.png" width="768" />
<p>También podemos recortar el mapa con <code>coord_sf()</code> para hacerle un poco de zoom a la zona urbana dentro del contexto de la región completa:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ggplot</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;grey90&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">geom_sf</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mapa_urbano_2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nf">aes</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">poblacion2020</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;white&#34;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">coord_sf</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-70.95</span><span class="p">,</span> <span class="m">-70.33</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">ylim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-33.75</span><span class="p">,</span> <span class="m">-33.2</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">           <span class="n">expand</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="n">viridis</span><span class="o">::</span><span class="nf">scale_fill_viridis</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="nf">label_number</span><span class="p">(</span><span class="n">big.mark</span> <span class="o">=</span> <span class="s">&#34;.&#34;</span><span class="p">,</span> <span class="n">decimal.mark</span> <span class="o">=</span> <span class="s">&#34;,&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">option</span> <span class="o">=</span> <span class="s">&#34;mako&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">labs</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Población&#34;</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position.inside</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">.1</span><span class="p">,</span> <span class="m">.7</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.key.width</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.key.height</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">legend.ticks.length</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="m">0.4</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">))</span>
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/region_urbana_fill_continuo_contexto_zoom-1.png" width="768" />
<hr>
<p><div style = "height: 18px;">
</div>
<div>
  <div style="display: flex;
  justify-content: center;
  align-items: center;">
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="bastimapache" data-color="#FFDD00" data-emoji="☕"  data-font="Cookie" data-text="Regálame un cafecito" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
  </div>
</p>
 
    </section>
      
    <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
    <a class="prev dtc pr2 tl v-top fw6"
    href="http://localhost:7359/blog/app_comparador_mapas_chile/">&larr; App: Comparador de mapas comunales de Chile</a>
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="http://localhost:7359/blog/app_economia_chile/">App: Indicadores económicos de Chile &rarr;</a>
  
</div>

    </footer>
    
  </article>
    
    <div class="post-comments pa0 pa4-l mt4">
  
    
      <script src="https://utteranc.es/client.js"
              repo="bastianolea/blog-bastianolea-r"
              issue-term="pathname"
              theme="github-light"
              label="comments"
              crossorigin="anonymous"
              async
              type="text/javascript">
      </script>
    
  
</div>

    
</section>
  

<section class="post-body pt5 pb4">
  
  <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Fecha de publicación:</dt>
    <dd class="fw5 ml0">June 12, 2024</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Extensión:</dt>
    <dd class="fw5 ml0">14 minute read, 2949 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categorías:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:7359/categories/tutoriales">Tutoriales</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Tags:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:7359/tags/mapas">mapas</a>  <a href="http://localhost:7359/tags/chile">Chile</a> </dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Ver también:</dt>
    
    <dd class="fw5 ml0"><a href="../../blog/app_censo_mapas/">App: visualizador de mapas comunales del Censo 2024 por manzanas</a></dd>
    
    <dd class="fw5 ml0"><a href="../../blog/mapas_censo_2024/">Visualiza datos del Censo 2024 en mapas a nivel de manzana con R</a></dd>
    
    <dd class="fw5 ml0"><a href="../../blog/grupo_usuarixs_r/">Grupo de usuarios/as de R</a></dd>
    
  </dl>
</details>

</section>
</main>


<aside class="page-sidebar" role="complementary">
   
   

  <div class="blog-info ph4 pt4 pb4 pb0-l">
    

  <h1 class="f3">Blog</h1>
  <p class="f6 lh-copy measure">Tutoriales, reseñas y consejos sobre R para análisis de datos. Usa el 
<a href="https://bastianolea-buscador.share.connect.posit.cloud" target="_blank" rel="noopener">buscador</a> para encontrar publicaciones o navega los 
<a href="../../tags/">temas</a>.</p>
  

   
<h3 style="margin-bottom: 12px;">Temas:</h3>

<div style="font-size:90%;">

<div style="font-size: 90%;">
  
   
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/chile/">Chile</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/datos/">Datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/consejos/">Consejos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/visualizaci%C3%B3n-de-datos/">Visualización de datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/gr%C3%A1ficos/">Gráficos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/blog/">Blog</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/ggplot2/">Ggplot2</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/apps/">Apps</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/shiny/">Shiny</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/web-scraping/">Web scraping</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/b%C3%A1sico/">Básico</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/mapas/">Mapas</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/limpieza-de-datos/">Limpieza de datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/procesamiento-de-datos/">Procesamiento de datos</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/curiosidades/">Curiosidades</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/quarto/">Quarto</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/dplyr/">Dplyr</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/ciencias-sociales/">Ciencias sociales</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/inteligencia-artificial/">Inteligencia artificial</a></span>
  </span>
 
  
  <span style="margin-bottom: 10px; line-height: 1.1;">
    <span style="margin: 3px; margin-left: 1px; margin-right: 1px; 
                 word-break: none;
                 display: inline-block; 
                 white-space: nowrap;
                 font-style: normal;
                 background-color: #9069C0; 
                 border-radius: 3px;
                 padding: 2px 6px;
                 padding-top: 3px;">
    <a style="color: #EAD1FA !important; text-decoration: none;" 
      href="http://localhost:7359/tags/optimizaci%C3%B3n/">Optimización</a></span>
  </span>

<a href="../../tags/" style="margin-left: 3px;">y más!</a>
</div>
</div>
  
  
   
   

</div>

  
  <div id="PageTableOfContents" style="margin-top: 24px; position: sticky; top: 108px;">
        <div class="blog-info ph4 pb4 pb0-l">
        <h3 style="margin-bottom: 12px;">Índice:</h3>
          <div class="pl2 pr0 mh0" style = "font-size: 90%; margin-top: -8px; margin-left: -22px; margin-bottom: 32px;">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#introducción">Introducción</a>
      <ul>
        <li><a href="#paquetes">Paquetes</a></li>
        <li><a href="#obtener-un-mapa-regional">Obtener un mapa regional</a></li>
      </ul>
    </li>
    <li><a href="#visualización">Visualización</a>
      <ul>
        <li><a href="#mapa-básico-de-la-región">Mapa básico de la región</a></li>
        <li><a href="#mapa-de-la-región-con-datos-ficticios">Mapa de la región con datos ficticios</a></li>
        <li><a href="#agregar-datos-obtenidos-desde-internet-al-mapa">Agregar datos obtenidos desde internet al mapa</a></li>
        <li><a href="#visualizar-datos">Visualizar datos</a></li>
      </ul>
    </li>
    <li><a href="#mapa-urbano-de-la-región-metropolitana">Mapa urbano de la región Metropolitana</a>
      <ul>
        <li></li>
        <li><a href="#excluir-islas-urbanas">Excluir islas urbanas</a></li>
        <li><a href="#visualizar-datos-en-el-mapa-urbano">Visualizar datos en el mapa urbano</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
        </div>
    </div>
  
  

</aside>

        
          <script id="partials/analytics.html" 
  data-goatcounter="https://bastimapache.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2026 Bastián Olea Herrera, Chile
      <span class="middot-divider"></span>
      Hecho con <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source" style="color:#9069C0;">Hugo Apéro</a> 
      y <a href="https://pkgs.rstudio.com/blogdown/" style="color:#9069C0;">{blogdown}</a></span>.
      <br />
      
Basado en <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source" style="color:#9069C0;">Blogophonic</a></span>, de <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL" style="color:#9069C0;">Formspree</a>.

Sitio alojado en <a href="https://www.netlify.com" style="color:#9069C0;">Netlify</a></span>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bastianolea-buscador.share.connect.posit.cloud" title="search" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-search fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/bastianolea" title="github" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://x.com/bastimapache" title="twitter" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-twitter fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.linkedin.com/in/bastianolea/" title="linkedin" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-linkedin fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.tiktok.com/@bastimapache" title="tiktok" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-tiktok fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.instagram.com/raccunnie" title="instagram" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-instagram fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.goodreads.com/user/show/53224910-basti-n-olea-herrera" title="goodreads" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-goodreads fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://www.last.fm/user/bastimapache" title="lastfm" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-lastfm fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://bsky.app/profile/bastianolea.rbind.io" title="bluesky" target="_blank" rel="me noopener"
    style="margin-bottom: 6px !important;"> 
      <i class="fab fa-bluesky fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="../../contacto/" title="envelope" 
    style="margin-bottom: 6px !important;"> 
      <i class="fas fa-envelope fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="../../about/" title="Bastián Olea: Sobre mi">Sobre mi</a>
      
      <a class="dib pv1 ph2 link" href="https://bastianolea-buscador.share.connect.posit.cloud" title="Buscador">Buscar</a>
      
      <a class="dib pv1 ph2 link" href="../../contacto/" title="Bastián Olea: Contacto">Contacto</a>
      
      <a class="dib pv1 ph2 link" href="../../tags/" title="Temas">Temas</a>
      
      <a class="dib pv1 ph2 link" href="../../clases/" title="Clases">Clases</a>
      
      <a class="dib pv1 ph2 link" href="../../code-of-conduct/" title="Bastián Olea: Código de conducta">Código de conducta</a>
      
      <a class="dib pv1 ph2 link" href="../../license/" title="Bastián Olea: Licencia">Licencia</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>

      </div>
    </body>
</html>
